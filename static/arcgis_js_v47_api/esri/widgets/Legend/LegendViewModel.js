// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.7/esri/copyright.txt for details.
//>>built
require({cache:{"esri/widgets/Legend/support/ActiveLayerInfo":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/io-query dojo/_base/lang ../../../Color ../../../request ../../../core/Accessor ../../../core/arrayUtils ../../../core/Collection ../../../core/Handles ../../../core/lang ../../../core/Logger ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../layers/support/ExportImageParameters ../../../renderers/support/jsonUtils ../../../symbols/SimpleMarkerSymbol ../../../symbols/support/gfxUtils ../../../symbols/support/symbolPreview ../../../symbols/support/symbolUtils ./colorRampUtils ./sizeRampUtils".split(" "),
function(x,f,a,e,c,d,l,q,m,t,w,z,y,h,p,g,b,k,r,v,B,C,E,n,D){function A(b){return"esri.renderers.SimpleRenderer"===b.declaredClass}function F(b){return"esri.renderers.ClassBreaksRenderer"===b.declaredClass}function I(b){return"esri.renderers.UniqueValueRenderer"===b.declaredClass}function J(b){return"esri.renderers.PointCloudClassBreaksRenderer"===b.declaredClass}function K(b){return"esri.renderers.PointCloudStretchRenderer"===b.declaredClass}function L(b){return"esri.renderers.PointCloudUniqueValueRenderer"===
b.declaredClass}var G=h.getLogger("esri.widgets.Legend.support.ActiveLayerInfo"),M=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,H=new v({size:6,outline:{color:[128,128,128,.5],width:.5}});return function(v){function h(b){b=v.call(this,b)||this;b._handles=new z;b._hasColorRamp=!1;b._hasOpacityRamp=!1;b._hasSizeRamp=!1;b._legendResponse={};b._webStyleSymbolCache=new Map;b.children=new w;b.layer=null;b.legendElements=[];b.parent=null;b.scale=null;b.title=null;return b}a(h,v);h.prototype.initialize=function(){var b=
this,a=function(){return b.notifyChange("ready")};this._handles.add([g.on(this,"children","change",function(u){var c=u.removed,d=b._handles;u.added.map(function(b){var u="activeLayerInfo-ready-watcher-"+b.layer.uid;d.add(g.init(b,"ready",a),u)});c.forEach(function(b){return d.remove(b.layer.uid)});a()})])};h.prototype.destroy=function(){this._handles.destroy();this._webStyleSymbolCache=this._legendResponse=this._handles=null};Object.defineProperty(h.prototype,"ready",{get:function(){return null===
this.layer?!0:0<this.children.length?this._isGroupActive():0<this.legendElements.length},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"isScaleDriven",{get:function(){var b=this,a=this.layer;if(null===a)return!1;if(a.renderer){var c=a.get("renderer.valueExpression");return M.test(c)?!0:(a=a.get("renderer.visualVariables"))&&a.some(function(a){return b._isScaleDrivenSizeVariable(a)})}return!0},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"version",{get:function(){return this._get("version")+
1},enumerable:!0,configurable:!0});h.prototype.buildLegendElementsForFeatureCollections=function(b){var a=this;this.legendElements=[];b.forEach(function(b){if("esri.layers.FeatureLayer"===b.declaredClass)a._buildRendererLegendElements(b.renderer,b.title,"append");else if(b.featureSet&&b.featureSet.features.length){var u=b.layerDefinition;(u=(u=u&&u.drawingInfo)&&r.fromJSON(u.renderer))?a._buildRendererLegendElements(u,b.name,"append"):G.warn("drawingInfo not available!")}})};h.prototype.buildLegendElementsForRenderer=
function(){this._buildRendererLegendElements(this.layer.renderer,null,"replace")};h.prototype.buildLegendElementsForTools=function(){var b=this,a=this.layer;"esri.layers.WMTSLayer"===a.declaredClass?this._constructLegendElementsForWMTSlayer():"esri.layers.WMSLayer"===a.declaredClass?this._constructLegendElementsForWMSSublayers():"esri.layers.MapImageLayer"===a.declaredClass?this._constructLegendElementsForSublayers():(this._handles.remove("imageryLayers-watcher"),this._getLegendLayers().then(function(u){b.legendElements=
[];u.forEach(function(u){if("esri.layers.ImageryLayer"===b.layer.declaredClass){var c=a.watch("renderingRule, bandIds",function(){b._legendResponse["default"]=null;b.buildLegendElementsForTools()});b._handles.add(c,"imageryLayers-watcher")}(u=b._generateSymbolTableElementForLegendLayer(u))&&u.infos.length&&b.legendElements.push(u);b.notifyChange("ready")});b.notifyChange("ready")}).catch(function(b){G.warn("Request to server for legend has failed!",b)}))};h.prototype._isGroupActive=function(){var b=
this.children;return b.length?b.some(function(b){return b.ready}):!1};h.prototype._isScaleDrivenSizeVariable=function(b){if(b&&"size"!==b.type)return!1;var a=b.minSize,u=b.maxSize;return"object"===typeof a&&a?this._isScaleDrivenSizeVariable(a):"object"===typeof u&&u?this._isScaleDrivenSizeVariable(u):!!b.expression||M.test(b.valueExpression)};h.prototype._buildRendererLegendElements=function(b,a,c){var u=this;this._getRendererLegendElements(b,a).then(function(b){"append"===c?Array.prototype.push.apply(u.legendElements,
b):u.legendElements=b;u.notifyChange("ready")}).catch(function(b){G.warn("error while building legend for layer!",b)})};h.prototype._constructLegendElementsForWMTSlayer=function(){this.legendElements=[];this._handles.remove("wmts-activeLayer-watcher");var b=this.layer,a=b.activeLayer;this._handles.add(g.watch(this.layer,"activeLayer",this._constructLegendElementsForWMTSlayer.bind(this)),"wmts-activeLayer-watcher");if(a.styleId&&a.styles){var c=null;a.styles.some(function(b){if(a.styleId===b.id)return c=
b.legendUrl,!0});c&&(this.legendElements=[{type:"symbol-table",title:a.title,infos:[{src:c,opacity:b.opacity}]}])}this.notifyChange("ready")};h.prototype._constructLegendElementsForWMSSublayers=function(){this.legendElements=[];this._handles.remove("wms-sublayers-watcher");var b=this.layer,a=null;if(b.customParameters||b.customLayerParameters)a=y.clone(b.customParameters||{}),d.mixin(a,b.customLayerParameters||{});this._handles.add(g.watch(this.layer,"sublayers",this._constructLegendElementsForWMSSublayers.bind(this)),
"wms-sublayers-watcher");this.legendElements=this._generateLegendElementsForWMSSublayers(b.sublayers,a);this.notifyChange("ready")};h.prototype._generateLegendElementsForWMSSublayers=function(b,a){var c=this,u=[];this._handles.add(b.on("change",this._constructLegendElementsForWMSSublayers.bind(this)),"wms-sublayers-watcher");b.forEach(function(b){var d=b.watch("title, visible, legendEnabled",function(){return c._constructLegendElementsForWMSSublayers()});c._handles.add(d,"wms-sublayers-watcher");
b.visible&&b.legendEnabled&&(b=c._generateSymbolTableElementForWMSSublayer(b,a))&&b.infos.length&&u.unshift(b)});return u};h.prototype._generateSymbolTableElementForWMSSublayer=function(b,a){return!b.legendUrl&&b.sublayers?(a=this._generateLegendElementsForWMSSublayers(b.sublayers,a).filter(function(b){return b}),{type:"symbol-table",title:b.title,infos:a}):this._generateSymbolTableElementForLegendUrl(b,a)};h.prototype._generateSymbolTableElementForLegendUrl=function(b,a){var u=b.legendUrl;if(u){var d=
{type:"symbol-table",title:b.title||b.name||b.id&&b.id+"",infos:[]};a&&(u+="?"+c.objectToQuery(a));d.infos.push({src:u,opacity:b.layer&&b.layer.opacity});return d}};h.prototype._getLegendLayers=function(b){var a=this,c=(b=b&&b.hasDynamicLayers?b.dynamicLayers:null)||"default",u=this._legendResponse&&this._legendResponse[c];return u?p.resolve(u):this._legendRequest(b).then(function(b){b=b.layers;return a._legendResponse[c]=b})};h.prototype._legendRequest=function(b){var a=this.layer;b={f:"json",dynamicLayers:b};
"esri.layers.ImageryLayer"===a.declaredClass&&(a.renderingRule&&(b.renderingRule=JSON.stringify(a.renderingRule.toJSON())),a.bandIds&&(b.bandIds=a.bandIds.join()));var c=a.url.replace(/(\/)+$/,"");if(10.01<=a.version){var u=c.indexOf("?"),c=-1<u?c.substring(0,u)+"/legend"+c.substring(u):c+"/legend";a.token&&(c+="?token\x3d"+a.token)}else a=c.toLowerCase().indexOf("/rest/"),a=c.substring(0,a)+c.substring(a+5,c.length),c="https://utility.arcgis.com/sharing/tools/legend?soapUrl\x3d"+encodeURI(a)+"\x26returnbytes\x3dtrue";
return q(c,{query:b,callbackParamName:"callback"}).then(function(b){return b.data})};h.prototype._constructLegendElementsForSublayers=function(){var b=this;this.legendElements=[];this._handles.remove("sublayers-watcher");var a=this.layer,c=new k({layer:a});this._getLegendLayers(c).then(function(c){var u={};c.forEach(function(b){u[b.layerId]=b});b._handles.add(g.watch(a,"sublayers",b._constructLegendElementsForSublayers.bind(b)),"sublayers-watcher");b.legendElements=b._generateLegendElementsForSublayers(a.sublayers,
u,a.opacity);b.notifyChange("ready")}).catch(function(b){G.warn("Request to server for legend has failed!",b)}).then(function(){return c.destroy()});this.notifyChange("ready")};h.prototype._generateLegendElementsForSublayers=function(b,a,c){var u=this,d=[];this._handles.add(b.on("change",this._constructLegendElementsForSublayers.bind(this)),"sublayers-watcher");b.forEach(function(b){var g=b.watch("renderer, opacity, title, visible",function(){return u._constructLegendElementsForSublayers()});u._handles.add(g,
"sublayers-watcher");b.visible&&b.legendEnabled&&(g=b&&null!=b.opacity?b.opacity:null,(b=u._generateSymbolTableElementForSublayer(b,a,null!=g?g*c:c))&&b.infos.length&&d.unshift(b))});return d};h.prototype._generateSymbolTableElementForSublayer=function(b,a,c){var u=a[b.id];return!u&&b.sublayers?(a=this._generateLegendElementsForSublayers(b.sublayers,a,c).filter(function(b){return b}),{type:"symbol-table",title:b.title,infos:a}):this._generateSymbolTableElementForLegendLayer(u,b,c)};h.prototype._generateSymbolTableElementForLegendLayer=
function(b,a,c){var u=this;if(b){var d=a&&a.renderer,g=a&&a.title||b.layerName;d&&(d=a&&a.title||this._getRendererTitle(d,a))&&(g&&(d.title=g),g=d);g={type:"symbol-table",title:g,infos:[]};b.legendType&&(g.legendType=b.legendType);b.legend&&this._isLegendLayerInScale(b,a)&&(a=a?this._sanitizeLegendForSublayer(b.legend.slice(),a):b.legend,g.infos=a.map(function(a){var d=a.url;if(a.imageData&&0<a.imageData.length)d="data:image/png;base64,"+a.imageData;else if(0!==d.indexOf("http")){var d=u.layer.url+
"/"+b.layerId+"/images/"+d,g=u.layer.token;g&&(d+="?token\x3d"+g)}else return null;return{label:a.label,src:d,opacity:c,width:a.width,height:a.height}}).filter(function(b){return!!b}));return g.infos.length?g:null}};h.prototype._isLegendLayerInScale=function(b,a){a=a||this.layer;var c=null,d=null,g=!0;!a.minScale&&0!==a.minScale||!a.maxScale&&0!==a.maxScale?(0===b.minScale&&a.tileInfo&&(c=a.tileInfo.lods[0].scale),0===b.maxScale&&a.tileInfo&&(d=a.tileInfo.lods[a.tileInfo.lods.length-1].scale)):(c=
Math.min(a.minScale,b.minScale)||a.minScale||b.minScale,d=Math.max(a.maxScale,b.maxScale));if(0<c&&c<this.scale||d>this.scale)g=!1;return g};h.prototype._sanitizeLegendForSublayer=function(b,a){if(10.1>this.layer.version||0===b.length)return b;a=a.renderer;var c=null,d=null;b.some(function(b){return b.values})&&b.some(function(b,a){b.values||(c=a,d=b,d.label||(d.label="others"));return null!=d});a?"unique-value"===a.type?d&&(b.splice(c,1),b.push(d)):"class-breaks"===a.type&&(d&&b.splice(c,1),b.reverse(),
d&&b.push(d)):d&&(b.splice(c,1),b.push(d));return b};h.prototype._getRendererLegendElements=function(b,a){return A(b)||F(b)||I(b)||J(b)||K(b)||L(b)?J(b)||K(b)||L(b)||"esri.renderers.PointCloudRGBRenderer"===b.declaredClass?this._constructPointCloudRendererLegendElements(b,a):this._constructRendererLegendElements(b,a):(G.warn("Renderer not supported!"),p.resolve([]))};h.prototype._getPointCloudRendererTitle=function(b){return b.legendOptions&&b.legendOptions.title||b.field};h.prototype._constructPointCloudRendererLegendElements=
function(b,a){var c=this,d=this.layer.opacity,g=[],k=null,u=null;if(J(b))k={type:"symbol-table",title:a||this._getPointCloudRendererTitle(b),infos:[]},b.colorClassBreakInfos.forEach(function(b){k.infos.unshift({label:b.label||b.minValue+" - "+b.maxValue,value:[b.minValue,b.maxValue],symbol:c._getAppliedCloneSymbol(H,b.color,d)})});else if(K(b)){var u=b.stops,r=null;if(u.length&&(1===u.length&&(r=u[0].color),!r)){var h=u[0].value,e=u[u.length-1].value;null!=h&&null!=e&&(r=n.getColorFromPointCloudStops(h+
(e-h)/2,u))}k={type:"symbol-table",title:null,infos:[{label:null,value:null,symbol:this._getAppliedCloneSymbol(H,r||H.color,d)}]};u={type:"color-ramp",title:a||this._getPointCloudRendererTitle(b),borderColor:B.getStroke(H).color,overlayColor:n.getRampOverlayColor(d),infos:n.getRampStopsForPointCloud(b.stops)}}else L(b)&&(k={type:"symbol-table",title:a||this._getPointCloudRendererTitle(b),infos:[]},b.colorUniqueValueInfos.forEach(function(b){k.infos.push({label:b.label||b.values.join(", "),value:b.values.join(", "),
symbol:c._getAppliedCloneSymbol(H,b.color,d)})}));k&&k.infos.length&&g.push(k);u&&u.infos.length&&g.push(u);b=g.reduce(function(b,a){return b.concat(a.infos)},[]).filter(function(b){return!!b.symbol}).map(function(b){return c._getSymbolPreview(b)});return p.eachAlways(b).then(function(){return g})};h.prototype._constructRendererLegendElements=function(b,a){var c=this;return this._loadRenderer(b).then(function(b){c._hasColorRamp=!1;c._hasOpacityRamp=!1;c._hasSizeRamp=!1;var d=c._getVisualVariableLegendElements(b)||
[],g={type:"symbol-table",title:a||c._getRendererTitle(b),infos:[]},k=null;if(I(b)){var u=b.field;b.uniqueValueInfos.forEach(function(b){b.symbol&&g.infos.push({label:b.label||c._getDomainName(u,b.value)||b.value,value:b.value,symbol:b.symbol})})}else F(b)?(k=c._isUnclassedRenderer(b),k&&c._hasSizeRamp||(b.classBreakInfos.forEach(function(b){b.symbol&&g.infos.unshift({label:b.label||(k?null:b.minValue+" - "+b.maxValue),value:[b.minValue,b.maxValue],symbol:b.symbol})}),k&&(g.title=null),c._updateInfosforClassedSizeRenderer(b,
g.infos))):A(b)&&b.symbol&&!c._hasSizeRamp&&g.infos.push({label:b.label,symbol:b.symbol});var r=!1,n=b.defaultLabel,h=b.defaultSymbol;h&&!k&&(g.infos.push({label:n||"others",symbol:h}),r=!0);r||A(b)||k&&!c._hasColorRamp&&!c._hasSizeRamp&&!c._hasOpacityRamp||d.push({type:"symbol-table",infos:[{label:b.defaultLabel,symbol:b.defaultSymbol}]});g.infos.length&&d.unshift(g);var e=c._getSymbolConfig(b.visualVariables),r=d.reduce(function(b,a){return b.concat(a.infos)},[]).filter(function(b){return!!b.symbol}).map(function(b){return c._getSymbolPreview(b,
e)});b=null;return p.eachAlways(r).then(function(){return d})})};h.prototype._updateInfosforClassedSizeRenderer=function(b,a){var c=b.authoringInfo&&"class-breaks-size"===b.authoringInfo.type,d=b.classBreakInfos.some(function(b){return E.isVolumetricSymbol(b.symbol)});if(c&&d){var g=D.REAL_WORLD_MAX_SIZE;b=b.classBreakInfos.length;var k=(g-D.REAL_WORLD_MIN_SIZE)/(1<b?b-1:b);a.forEach(function(b,a){b.size=g-k*a})}};h.prototype._getSymbolConfig=function(b){var a=!1,c=!1;if(b)for(var d=0;d<b.length&&
(!a||!c);d++){var g=b[d];"size"===g.type&&("height"===g.axis&&(a=!0),"width-and-depth"===g.axis&&(c=!0))}return a&&c?"tall":null};h.prototype._getSymbolPreview=function(b,a){return C.renderPreviewHTML(b.symbol,{size:b.size,opacity:this.layer.opacity,symbolConfig:a}).then(function(a){b.preview=a;return b}).catch(function(){b.preview=null;return b})};h.prototype._loadRenderer=function(b){var a=this,c=[];b=b.clone();var d=this._getMedianColor(b),g=this.layer.opacity;if(F(b)||I(b)){var k=(b.classBreakInfos||
b.uniqueValueInfos).map(function(b){return a._fetchSymbol(b.symbol,d,g).then(function(a){b.symbol=a}).catch(function(){b.symbol=null})});Array.prototype.push.apply(c,k)}c.push(this._fetchSymbol(b.symbol||b.defaultSymbol,b.defaultSymbol?null:d,g).then(function(c){a._applySymbolToRenderer(b,c,A(b))}).catch(function(){a._applySymbolToRenderer(b,null,A(b))}));return p.eachAlways(c).then(function(){return b})};h.prototype._applySymbolToRenderer=function(b,a,c){c?b.symbol=a:b.defaultSymbol=a};h.prototype._getMedianColor=
function(b){if(!b.visualVariables)return null;var a=t.find(b.visualVariables,function(b){return"color"===b.type});if(!a)return null;var c=null,d=null;if(a.colors)c=a.minDataValue,d=a.maxDataValue;else if(a.stops){if(1===a.stops.length)return a.stops[0].color;c=a.stops[0].value;d=a.stops[a.stops.length-1].value}if(null!=c&&null!=d)return b.getColor(c+(d-c)/2,{colorInfo:a})};h.prototype._fetchSymbol=function(b,a,c){var d=this;if(!b)return p.reject();if("web-style"===b.type){var g=b.portal,g=b.name+
"-"+b.styleName+"-"+b.styleUrl+"-"+(g&&g.url)+"-"+(g&&g.user&&g.user.username),k=this._webStyleSymbolCache;k.has(g)||k.set(g,b.fetchSymbol());return k.get(g).then(function(b){return d._getAppliedCloneSymbol(b,a,c)}).catch(function(){G.warn("Fetching web-style failed!");return p.reject()})}return p.resolve(this._getAppliedCloneSymbol(b,a,c))};h.prototype._getAppliedCloneSymbol=function(b,a,c){if(!b)return b;b=b.clone();var d=-1<b.type.indexOf("3d");a=a&&a.toRgba();d?this._applyColorTo3dSymbol(b,a,
c):(b.color&&(b.color=this._getOpacityAppliedColor(a||b.color.toRgba(),c)),(a=b.outline)&&a.color&&(a.color=this._getOpacityAppliedColor(a.color.toRgba(),c)));return b};h.prototype._applyColorTo3dSymbol=function(b,a,c){var d=this;b.symbolLayers.forEach(function(b){b&&(a&&(b.material||(b.material={}),b.material.color=new l(a)),null!=c&&(b.material&&b.material.color&&(b.material.color=d._getOpacityAppliedColor(b.material.color.toRgba(),c)),b.outline&&b.outline.color&&(b.outline.color=d._getOpacityAppliedColor(b.outline.color.toRgba(),
c))))})};h.prototype._getOpacityAppliedColor=function(b,a){b[3]*=a;return b};h.prototype._getVisualVariableLegendElements=function(b){var a=this,c=b.visualVariables,d=[],g=[],k=[],r=this.layer.opacity;if(!c)return null;c.forEach(function(b){"color"===b.type?d.push(b):"size"===b.type?g.push(b):"opacity"===b.type&&k.push(b)});var c=d.concat(g,k),h,e;0===d.length&&F(b)&&b.classBreakInfos&&1===b.classBreakInfos.length&&(h=(h=b.classBreakInfos[0])&&h.symbol);0===d.length&&A(b)&&(h=b.symbol);h&&(-1<h.type.indexOf("3d")?
(h=h.symbolLayers.getItemAt(0),h.get("material.color")&&(e=h.material.color)):h.url||(e=h.color),e&&(e=e.toRgba()));return c.map(function(c){if(!c.legendOptions||!1!==c.legendOptions.showLegend){var d=a._getRampTitle(c,a.layer),g=n.getRampBorderColor(b),k=n.getRampOverlayColor(r),h=null;"color"===c.type?(h={type:"color-ramp",title:d,borderColor:g,overlayColor:k,infos:n.getRampStops(b,c)},a._hasColorRamp||(a._hasColorRamp=!(null==h.infos||!h.infos.length))):"size"===c.type?(h={type:"size-ramp",title:d,
infos:D.getRampStops(b,c,a._getMedianColor(b),a.scale)},a._hasSizeRamp||(a._hasSizeRamp=!(null==h.infos||!h.infos.length))):"opacity"===c.type&&(h={type:"opacity-ramp",title:d,borderColor:g,overlayColor:k,infos:n.getRampStops(b,c,e)},a._hasOpacityRamp||(a._hasOpacityRamp=!(null==h.infos||!h.infos.length)));return h.infos&&h}}).filter(function(b){return!!b})};h.prototype._getDomainName=function(b,a){if(b&&!d.isFunction(b)){var c=this.layer;return(c=(b=c.getField&&c.getField(b))&&c.getFieldDomain?c.getFieldDomain(b.name):
null)&&c.codedValues?c.getName(a):null}return null};h.prototype._getRampTitle=function(b,a){var c=b.field,g=b.normalizationField,k=!1,h=!1,r=!1,n=null,c=d.isFunction(c)?null:c,g=d.isFunction(g)?null:g;if(void 0!==(b.legendOptions&&b.legendOptions.title))n=b.legendOptions.title;else if(b.valueExpressionTitle)n=b.valueExpressionTitle;else{if(a.renderer.authoringInfo&&a.renderer.authoringInfo.visualVariables)for(b=a.renderer.authoringInfo.visualVariables,n=0;n<b.length;n++){var e=b[n];if("color"===e.type)if("ratio"===
e.style){k=!0;break}else if("percent"===e.style){h=!0;break}else if("percentTotal"===e.style){r=!0;break}}n={field:c&&this._getFieldAlias(c,a),normField:g&&this._getFieldAlias(g,a),ratio:k,ratioPercent:h,ratioPercentTotal:r}}return n};h.prototype._getRendererTitle=function(b,a){if(b.legendOptions&&b.legendOptions.title)return b.legendOptions.title;if(b.valueExpressionTitle)return b.valueExpressionTitle;var c=this.layer,g=b.field,k=null,h=null;F(b)&&(k=b.normalizationField,h="percent-of-total"===b.normalizationType);
g=d.isFunction(g)?null:g;k=d.isFunction(k)?null:k;b=null;if(g||k)b={field:a?g:g&&this._getFieldAlias(g,c),normField:a?k:k&&this._getFieldAlias(k,c),normByPct:h};return b};h.prototype._getFieldAlias=function(b,a){var c=a.popupTemplate,c=c&&c.fieldInfos;a=d.isFunction(b)?null:a.getField&&a.getField(b);var g=null;c&&c.some(function(a){if(b===a.fieldName)return g=a,!0});var c=g||a,k=null;c&&(k=g&&g.label||a&&a.alias||c.name||c.fieldName);return k};h.prototype._isUnclassedRenderer=function(b){var a=b.visualVariables,
c=!1;F(b)&&b.classBreakInfos&&1===b.classBreakInfos.length&&a&&(c=b.field?a.some(function(a){return!(!a||b.field!==a.field||(b.normalizationField||a.normalizationField)&&b.normalizationField!==a.normalizationField)}):!!a.length);return c};e([b.property()],h.prototype,"children",void 0);e([b.property()],h.prototype,"layer",void 0);e([b.property()],h.prototype,"legendElements",void 0);e([b.property()],h.prototype,"parent",void 0);e([b.property({readOnly:!0})],h.prototype,"ready",null);e([b.property()],
h.prototype,"scale",void 0);e([b.property({dependsOn:["layer.renderer.valueExpression","layer.renderer.visualVariables"],readOnly:!0})],h.prototype,"isScaleDriven",null);e([b.property()],h.prototype,"title",void 0);e([b.property({dependsOn:["ready"],readOnly:!0,value:0})],h.prototype,"version",null);return h=e([b.subclass("esri.widgets.Legend.support.ActiveLayerInfo")],h)}(b.declared(m))})},"esri/layers/support/ExportImageParameters":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/_base/lang ../../core/Accessor ../../core/accessorSupport/decorators ./sublayerUtils".split(" "),
function(x,f,a,e,c,d,l,q){var m={visible:"visibleSublayers",definitionExpression:"layerDefs",labelsVisible:"hasDynamicLayers",labelingInfo:"hasDynamicLayers",opacity:"hasDynamicLayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};return function(d){function f(){var a=null!==d&&d.apply(this,arguments)||this;a.scale=0;return a}a(f,d);Object.defineProperty(f.prototype,"dynamicLayers",{get:function(){if(!this.hasDynamicLayers)return null;var a=this.visibleSublayers.map(function(a){return a.toExportImageJSON()});
return a.length?JSON.stringify(a):null},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"hasDynamicLayers",{get:function(){return q.isExportDynamic(this.visibleSublayers,this.layer.serviceSublayers,this.layer)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"layer",{set:function(a){var c=this;this._get("layer")!==a&&(this._set("layer",a),this._layerHandles&&(this._layerHandles.forEach(function(a){return a.remove()}),this._layerHandles.length=0),a&&(this._layerHandles=
[a.allSublayers.on("change",function(){return c.notifyChange("visibleSublayers")}),a.on("sublayer-update",function(a){return c.notifyChange(m[a.propertyName])})]))},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"layers",{get:function(){var a=this.visibleSublayers;return a?a.length?"show:"+a.map(function(a){return a.id}).join(","):"show:-1":null},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"layerDefs",{get:function(){var a=this.visibleSublayers.filter(function(a){return null!=
a.definitionExpression});return a.length?JSON.stringify(a.reduce(function(a,c){a[c.id]=c.definitionExpression;return a},{})):null},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"version",{get:function(){return(this._get("version")||0)+1},set:function(a){this._set("version",a)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"visibleSublayers",{get:function(){var a=this,c=this.layer.sublayers,d=[],e=function(c){var b=a.scale,g=0===c.minScale||b<=c.minScale,h=0===
c.maxScale||b>=c.maxScale;c.visible&&(0===b||g&&h)&&(c.sublayers?c.sublayers.forEach(e):d.unshift(c))};c&&c.forEach(e);return d},enumerable:!0,configurable:!0});f.prototype.toJSON=function(){var a=this.layer,a={dpi:a.dpi,format:a.imageFormat,transparent:a.imageTransparency,gdbVersion:a.gdbVersion||null};this.hasDynamicLayers&&this.dynamicLayers?a.dynamicLayers=this.dynamicLayers:c.mixin(a,{layers:this.layers,layerDefs:this.layerDefs});return a};e([l.property({readOnly:!0,dependsOn:["hasDynamicLayers",
"visibleSublayers"]})],f.prototype,"dynamicLayers",null);e([l.property({readOnly:!0,dependsOn:["visibleSublayers","layer.serviceSublayers","layer.capabilities"]})],f.prototype,"hasDynamicLayers",null);e([l.property()],f.prototype,"layer",null);e([l.property({readOnly:!0,dependsOn:["visibleSublayers"]})],f.prototype,"layers",null);e([l.property({readOnly:!0,dependsOn:["visibleSublayers"]})],f.prototype,"layerDefs",null);e([l.property({type:Number})],f.prototype,"scale",void 0);e([l.property({dependsOn:"layers layerDefs dynamicLayers layer.dpi layer.imageFormat layer.imageTransparency layer.gdbVersion".split(" ")})],
f.prototype,"version",null);e([l.property({readOnly:!0,dependsOn:["layer.sublayers","scale"]})],f.prototype,"visibleSublayers",null);return f=e([l.subclass("esri.layers.mixins.ExportImageParameters")],f)}(l.declared(d))})},"esri/layers/support/sublayerUtils":function(){define(["require","exports","./layerSourceUtils"],function(x,f,a){function e(a,d){function c(a){var d=a.sublayers;e.unshift(a.id);d&&d.forEach(c)}if(!a||!a.length)return!0;var e=[];d.forEach(c);if(a.length>e.length)return!1;d=0;for(var m=
e.length,f=0;f<a.length;f++){for(var w=a[f].id;d<m&&e[d]!==w;)d++;if(d>=m)return!1}return!0}Object.defineProperty(f,"__esModule",{value:!0});f.isExportDynamic=function(c,d,l){return c.some(function(c){var d=c.source;return!(!d||d.type===a.MAPLAYER&&d.mapLayerId===c.id&&(!d.gdbVersion||d.gdbVersion===l.gdbVersion))||null!=c.renderer||null!=c.labelingInfo||c.hasOwnProperty("opacity")&&null!=c.opacity||c.hasOwnProperty("labelsVisible")&&null!=c.labelsVisible})?!0:!e(c,d)};f.sameStructureAsService=function(a,
d){return d.flatten(function(a){return(a=a.sublayers)&&a.toArray().reverse()}).toArray().reverse().every(function(c,d){return(d=a[d])&&c.id===d.id&&(null==c.sublayers&&null==d.sublayers||null!=c.sublayers&&null!=d.sublayers&&c.sublayers.map(function(a){return a.id}).join(",")===d.sublayers.map(function(a){return a.id}).join(","))})}})},"esri/symbols/support/gfxUtils":function(){define("require exports dojo/_base/lang dojox/gfx/_base ../../Color ../../request ../../core/LRUMap ../../core/promiseUtils ../../core/screenUtils".split(" "),
function(x,f,a,e,c,d,l,q,m){function t(a){if(!a)return null;var b,c=a.constructor,d=m.pt2px(a.width);switch(a.type){case "simple-fill":case "picture-fill":case "simple-marker":b=t(a.outline);break;case "simple-line":a.style!==c.STYLE_NULL&&0!==d&&(b={color:a.color,style:p(a.style),width:d,cap:a.cap,join:a.join===c.JOIN_MITER?m.pt2px(a.miterLimit):a.join});break;default:b=null}return b}Object.defineProperty(f,"__esModule",{value:!0});var w=x.toUrl("../../symbols/patterns/"),z={left:"start",center:"middle",
right:"end",justify:"start"},y={top:"text-before-edge",middle:"central",baseline:"alphabetic",bottom:"text-after-edge"},h=new l(1E3);f.getSVGAlign=function(a){return a=(a=a.horizontalAlignment)&&z[a.toLowerCase()]||"middle"};f.getSVGBaseline=function(a){return(a=a.verticalAlignment)&&y[a.toLowerCase()]||"alphabetic"};f.getSVGBaselineShift=function(a){return"bottom"===a.verticalAlignment?"super":null};f.getFill=function(c){var b=c.style,d=null;if(c){var g=c.constructor;switch(c.type){case "simple-marker":b!==
g.STYLE_CROSS&&b!==g.STYLE_X&&(d=c.color);break;case "simple-fill":b===g.STYLE_SOLID?d=c.color:b!==g.STYLE_NULL&&(d=a.mixin({},e.defaultPattern,{src:w+b+".png",width:8,height:8}));break;case "picture-fill":d=a.mixin({},e.defaultPattern,{src:c.url,width:m.pt2px(c.width)*c.xscale,height:m.pt2px(c.height)*c.yscale,x:m.pt2px(c.xoffset),y:m.pt2px(c.yoffset)});break;case "text":d=c.color}}return d};f.getPatternUrlWithColor=function(a,b){var c=a+"-"+b;return h.has(c)?q.resolve(h.get(c)):d(a,{responseType:"image",
allowImageDataAccess:!0}).then(function(a){a=a.data;var d=a.naturalWidth,g=a.naturalHeight,k=document.createElement("canvas");k.width=d;k.height=g;var e=k.getContext("2d");e.fillStyle=b;e.fillRect(0,0,d,g);e.globalCompositeOperation="destination-in";e.drawImage(a,0,0);a=k.toDataURL();h.set(c,a);return a})};f.getStroke=t;var p=function(){var a={};return function(b){if(a[b])return a[b];var c=b.replace(/-/g,"");return a[b]=c}}();f.defaultThematicColor=new c([128,128,128])})},"dojox/gfx/_base":function(){define("dojo/_base/kernel dojo/_base/lang dojo/_base/Color dojo/_base/sniff dojo/_base/window dojo/_base/array dojo/dom dojo/dom-construct dojo/dom-geometry".split(" "),
function(x,f,a,e,c,d,l,q,m){var t=f.getObject("dojox.gfx",!0),w=t._base={};t._hasClass=function(b,a){return(b=b.getAttribute("className"))&&0<=(" "+b+" ").indexOf(" "+a+" ")};t._addClass=function(b,a){var c=b.getAttribute("className")||"";(!c||0>(" "+c+" ").indexOf(" "+a+" "))&&b.setAttribute("className",c+(c?" ":"")+a)};t._removeClass=function(b,a){var c=b.getAttribute("className");c&&b.setAttribute("className",c.replace(new RegExp("(^|\\s+)"+a+"(\\s+|$)"),"$1$2"))};w._getFontMeasurements=function(){var b=
{"1em":0,"1ex":0,"100%":0,"12pt":0,"16px":0,"xx-small":0,"x-small":0,small:0,medium:0,large:0,"x-large":0,"xx-large":0},a,d;e("ie")&&(d=c.doc.documentElement.style.fontSize||"",d||(c.doc.documentElement.style.fontSize="100%"));var g=q.create("div",{style:{position:"absolute",left:"0",top:"-100px",width:"30px",height:"1000em",borderWidth:"0",margin:"0",padding:"0",outline:"none",lineHeight:"1",overflow:"hidden"}},c.body());for(a in b)g.style.fontSize=a,b[a]=16*Math.round(12*g.offsetHeight/16)/12/1E3;
e("ie")&&(c.doc.documentElement.style.fontSize=d);c.body().removeChild(g);return b};var z=null;w._getCachedFontMeasurements=function(b){if(b||!z)z=w._getFontMeasurements();return z};var y=null,h={};w._getTextBox=function(b,a,d){var g,k,e=arguments.length,r;y||(y=q.create("div",{style:{position:"absolute",top:"-10000px",left:"0",visibility:"hidden"}},c.body()));g=y;g.className="";k=g.style;k.borderWidth="0";k.margin="0";k.padding="0";k.outline="0";if(1<e&&a)for(r in a)r in h||(k[r]=a[r]);2<e&&d&&(g.className=
d);g.innerHTML=b;g.getBoundingClientRect?(k=g.getBoundingClientRect(),k={l:k.left,t:k.top,w:k.width||k.right-k.left,h:k.height||k.bottom-k.top}):k=m.getMarginBox(g);g.innerHTML="";return k};w._computeTextLocation=function(b,a,c,d){var g={};switch(b.align){case "end":g.x=b.x-a;break;case "middle":g.x=b.x-a/2;break;default:g.x=b.x}g.y=b.y-c*(d?.75:1);return g};w._computeTextBoundingBox=function(b){if(!t._base._isRendered(b))return{x:0,y:0,width:0,height:0};var a;a=b.getShape();var c=b.getFont()||t.defaultFont;
b=b.getTextWidth();c=t.normalizedLength(c.size);a=w._computeTextLocation(a,b,c,!0);return{x:a.x,y:a.y,width:b,height:c}};w._isRendered=function(b){for(b=b.parent;b&&b.getParent;)b=b.parent;return null!==b};var p=0;w._getUniqueId=function(){var b;do b=x._scopeName+"xUnique"+ ++p;while(l.byId(b));return b};var g=e("pointer-events")?"touchAction":null;w._fixMsTouchAction=g?function(b){b.rawNode.style[g]="none"}:function(){};f.mixin(t,{defaultPath:{type:"path",path:""},defaultPolyline:{type:"polyline",
points:[]},defaultRect:{type:"rect",x:0,y:0,width:100,height:100,r:0},defaultEllipse:{type:"ellipse",cx:0,cy:0,rx:200,ry:100},defaultCircle:{type:"circle",cx:0,cy:0,r:100},defaultLine:{type:"line",x1:0,y1:0,x2:100,y2:100},defaultImage:{type:"image",x:0,y:0,width:0,height:0,src:""},defaultText:{type:"text",x:0,y:0,text:"",align:"start",decoration:"none",rotated:!1,kerning:!0},defaultTextPath:{type:"textpath",text:"",align:"start",decoration:"none",rotated:!1,kerning:!0},defaultStroke:{type:"stroke",
color:"black",style:"solid",width:1,cap:"butt",join:4},defaultLinearGradient:{type:"linear",x1:0,y1:0,x2:100,y2:100,colors:[{offset:0,color:"black"},{offset:1,color:"white"}]},defaultRadialGradient:{type:"radial",cx:0,cy:0,r:100,colors:[{offset:0,color:"black"},{offset:1,color:"white"}]},defaultPattern:{type:"pattern",x:0,y:0,width:0,height:0,src:""},defaultFont:{type:"font",style:"normal",variant:"normal",weight:"normal",size:"10pt",family:"serif"},getDefault:function(){var b={};return function(a){var c=
b[a];if(c)return new c;c=b[a]=new Function;c.prototype=t["default"+a];return new c}}(),normalizeColor:function(b){return b instanceof a?b:new a(b)},normalizeParameters:function(b,a){var c;if(a){var d={};for(c in b)c in a&&!(c in d)&&(b[c]=a[c])}return b},makeParameters:function(b,a){var c=null;if(!a)return f.delegate(b);var d={};for(c in b)c in d||(d[c]=f.clone(c in a?a[c]:b[c]));return d},formatNumber:function(b,a){var c=b.toString();if(0<=c.indexOf("e"))c=b.toFixed(4);else{var d=c.indexOf(".");
0<=d&&5<c.length-d&&(c=b.toFixed(4))}return 0>b?c:a?" "+c:c},makeFontString:function(b){return b.style+" "+b.variant+" "+b.weight+" "+b.size+" "+b.family},splitFontString:function(b){var a=t.getDefault("Font");b=b.split(/\s+/);if(!(5>b.length)){a.style=b[0];a.variant=b[1];a.weight=b[2];var c=b[3].indexOf("/");a.size=0>c?b[3]:b[3].substring(0,c);var d=4;0>c&&("/"==b[4]?d=6:"/"==b[4].charAt(0)&&(d=5));d<b.length&&(a.family=b.slice(d).join(" "))}return a},cm_in_pt:72/2.54,mm_in_pt:7.2/2.54,px_in_pt:function(){return t._base._getCachedFontMeasurements()["12pt"]/
12},pt2px:function(b){return b*t.px_in_pt()},px2pt:function(b){return b/t.px_in_pt()},normalizedLength:function(b){if(0===b.length)return 0;if(2<b.length){var a=t.px_in_pt(),c=parseFloat(b);switch(b.slice(-2)){case "px":return c;case "pt":return c*a;case "in":return 72*c*a;case "pc":return 12*c*a;case "mm":return c*t.mm_in_pt*a;case "cm":return c*t.cm_in_pt*a}}return parseFloat(b)},pathVmlRegExp:/([A-Za-z]+)|(\d+(\.\d+)?)|(\.\d+)|(-\d+(\.\d+)?)|(-\.\d+)/g,pathSvgRegExp:/([A-DF-Za-df-z])|([-+]?\d*[.]?\d+(?:[eE][-+]?\d+)?)/g,
equalSources:function(b,a){return b&&a&&b===a},switchTo:function(b){var a="string"==typeof b?t[b]:b;a&&(d.forEach("Group Rect Ellipse Circle Line Polyline Image Text Path TextPath EsriPath Surface createSurface fixTarget".split(" "),function(b){t[b]=a[b]}),"string"==typeof b?t.renderer=b:d.some(["svg","vml","canvas","canvasWithEvents","silverlight"],function(b){return t.renderer=t[b]&&t[b].Surface===t.Surface?b:null}))}});return t})},"esri/symbols/support/symbolPreview":function(){define(["require",
"exports","./previewSymbol2D","./previewSymbol3D","./previewWebStyleSymbol"],function(x,f,a,e,c){function d(l,q){switch(l.type){case "web-style":return c.previewWebStyleSymbol(l,d,q);case "label-3d":case "line-3d":case "mesh-3d":case "point-3d":case "polygon-3d":return e.previewSymbol3D(l,q);default:return a.previewSymbol2D(l,q)}}Object.defineProperty(f,"__esModule",{value:!0});f.renderPreviewHTML=d})},"esri/symbols/support/previewSymbol2D":function(){define("require exports dojox/gfx/_base ../../core/Error ../../core/promiseUtils ../../core/screenUtils ../SimpleMarkerSymbol ./gfxUtils ./previewUtils ./renderUtils".split(" "),
function(x,f,a,e,c,d,l,q,m,t){function w(a,c){var d=z.getContext("2d"),g=[];c&&(c.weight&&g.push(c.weight),c.size&&g.push(c.size+"px"),c.family&&g.push(c.family));d.font=g.join(" ");return d.measureText(a).width}Object.defineProperty(f,"__esModule",{value:!0});var z=document.createElement("canvas");f.previewSymbol2D=function(f,h){var p=h&&h.size?d.pt2px(h.size):null,g=h&&h.maxSize?d.pt2px(h.maxSize):null,b=q.getStroke(f),k={shape:null,fill:null,stroke:b};b&&b.width&&(b.width=Math.min(b.width,80));
var r=0,v=0,B=b&&b.width||0,y=!1,E=null;switch(f.type){case "simple-marker":var n=l.defaultProps,b=f.style,v=r=p=Math.min(p||d.pt2px(f.size||n.size),g||120);switch(b){case l.STYLE_CIRCLE:k.shape={type:"circle",cx:0,cy:0,r:.5*p};break;case l.STYLE_CROSS:k.shape={type:"path",path:[{command:"M",values:[0,.5*v]},{command:"L",values:[r,.5*v]},{command:"M",values:[.5*r,0]},{command:"L",values:[.5*r,v]},{command:"E",values:[]}]};break;case l.STYLE_DIAMOND:k.shape={type:"path",path:[{command:"M",values:[0,
.5*v]},{command:"L",values:[.5*r,0]},{command:"L",values:[r,.5*v]},{command:"L",values:[.5*r,v]},{command:"Z",values:[]}]};break;case l.STYLE_SQUARE:k.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[r,0]},{command:"L",values:[r,v]},{command:"L",values:[0,v]},{command:"Z",values:[]}]};break;case l.STYLE_X:k.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[r,v]},{command:"M",values:[r,0]},{command:"L",values:[0,v]},{command:"E",values:[]}]};break;case l.STYLE_PATH:y=
!0,k.shape={type:"path",path:f.path||""}}break;case "simple-line":B=Math.min(p||B,g||80);r=22<B?2*B:40;v=B;b.width=B;B=0;k.shape={type:"path",path:[{command:"M",values:[0,.5*v]},{command:"L",values:[r,.5*v]},{command:"E",values:[]}]};break;case "picture-fill":case "simple-fill":k.shape=m.shapes.fill[0];break;case "picture-marker":g=g||120;b=d.pt2px(f.width);n=d.pt2px(f.height);p=Math.min(p||Math.max(b,n),g);n=b/n;b=1>=n?Math.ceil(p*n):p;n=1>=n?p:Math.ceil(p/n);r=b;v=n;E=h.opacity;k.shape={type:"image",
x:-Math.round(b/2),y:-Math.round(n/2),width:b,height:n,src:f.url||""};break;case "text":var b=f.text||"Aa",n=f.font,p=Math.min(p||d.pt2px(n.size),g||120),D=w(b,{weight:n.weight,size:p,family:n.family}),r=(g=/[\uE600-\uE6FF]/.test(b))?p:D,v=p,D=.25*a.normalizedLength((n?p:0).toString());g&&(D+=5);k.shape={type:"text",text:b,x:0,y:D,align:"middle",decoration:f.decoration||n&&n.decoration,rotated:f.rotated,kerning:f.kerning};k.font=n&&{size:p,style:n.style,decoration:n.decoration,weight:n.weight,family:n.family}}if(!k.shape)return c.reject(new e("symbolPreview: renderPreviewHTML2D",
"symbol not supported."));var r=(r||22)+2*B,v=(v||22)+2*B,A=q.getFill(f),B=f.color,p=null;A&&"pattern"===A.type&&B&&"picture-fill"!==f.type?p=q.getPatternUrlWithColor(A.src,B.toCss(!0)).then(function(b){A.src=b;k.fill=A;return k}):(k.fill=A,p=c.resolve(k));return p.then(function(b){return t.renderSymbol([[b]],[r,v],{node:h&&h.node,scale:y,opacity:E})})}})},"esri/symbols/support/previewUtils":function(){define(["require","exports"],function(x,f){Object.defineProperty(f,"__esModule",{value:!0});f.shapes=
{fill:[{type:"path",path:"M -10,-10 L 10,0 L 10,10 L -10,10 L -10,-10 Z"}],pathSymbol3DLayer:[{type:"path",path:"M 3,12 L 12,0 L 11,-2 L -4,5 L -1,5 L 1,7 L 3,10 L 3,12 Z"},{type:"circle",cx:-2,cy:10,r:5}],extrudeSymbol3DLayer:[{type:"path",path:"M -7,-5 L -2,0 L -2,7 L -7,3 L -7,-5 Z"},{type:"path",path:"M -2,0 L -2,7 L 10,-3 L 10,-10 L -2,0 Z"},{type:"path",path:"M -7,-5 L -2,0 L 10,-10 L -2,-10 L -7,-5 Z"}],cone:[{type:"path",path:"M 0,-10 L -8,5 L -4,6.5 L 0,7 L 4,6.5 L 8,5 Z"}],tallCone:[{type:"path",
path:"M 0,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 0,-9 Z"}],invertedCone:[{type:"path",path:"M 0,7 L -8,-8 L 8,-8 Z"},{type:"path",path:"M -8,-8 L -4,-9.5 L 0,-10 L 4,-9.5 L 8,-8 L 4,-6.5 L 0,-6 L -4,-6.5 Z"}],cube:[{type:"path",path:"M -10,-7 L 0,-12 L 10,-7 L 0,-2 L -10,-7 Z"},{type:"path",path:"M -10,-7 L 0,-2 L 0,12 L -10,7 L -10,-7 Z"},{type:"path",path:"M 0,-2 L 10,-7 L 10,7 L 0,12 L 0,-2 Z"}],tallCube:[{type:"path",path:"M -3.5,-8.5 L 0,-9.5 L 3.5,-8.5 L 0,-7.5 L -3.5,-8.5 Z"},{type:"path",
path:"M -3.5,-8.5 L 0,-7.5 L 0,9 L -3.5,8 L -3.5,-8.5 Z"},{type:"path",path:"M 0,-7.5 L 3.5,-8.5 L 3.5,8 L 0,9 L 0,-7.5 Z"}],cylinder:[{type:"path",path:"M -8,-9 L -8,7 L -4,8.5 L 0,9 L 4,8.5 L 8,7 L 8,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:8,ry:2}],tallCylinder:[{type:"path",path:"M -3.5,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 3.5,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:3.5,ry:1}],diamond:[{type:"path",path:"M 0,-10 L 10,-1 L -1,1 L 0,-10 Z"},{type:"path",path:"M 0,-10 L -1,1 L -8,-1 L 0,-10 Z"},
{type:"path",path:"M -1,1 L 0,10 L -8,-1 L -1,1 Z"},{type:"path",path:"M -1,0 L 0,10 L 10,-1 L -1,1 Z"}],tetrahedron:[{type:"path",path:"M 0,-10 L 10,7 L 0,0 L 0,-10 Z"},{type:"path",path:"M 0,-10 L 0,0 L -8,7 L 0,-10 Z"},{type:"path",path:"M 10,7 L 0,0 L -8,7 L 10,7 Z"}]};f.getExtrudeSymbolShapes=function(a){a*=.5;return[{type:"path",path:[{command:"M",values:[0,.7*11]},{command:"L",values:[6.6,22*.7]},{command:"L",values:[6.6,22*.7+a]},{command:"L",values:[0,22*.7+a-.7*11]},{command:"Z",values:[]}]},
{type:"path",path:[{command:"M",values:[6.6,22*.7]},{command:"L",values:[6.6,22*.7+a]},{command:"L",values:[22,a]},{command:"L",values:[22,0]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[6.6,0]},{command:"L",values:[22,0]},{command:"L",values:[6.6,22*.7]},{command:"L",values:[0,.7*11]},{command:"Z",values:[]}]}]};f.getCubeShapes=function(a,e){var c=e?20:a,d=e?4:6,d=c=22>=c?c-.5*d:c-d;e=e?.35*c:.5*c;return[{type:"path",path:[{command:"M",values:[.5*d,0]},{command:"L",values:[d,
.5*e]},{command:"L",values:[.5*d,e]},{command:"L",values:[0,.5*e]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*e]},{command:"L",values:[.5*d,e]},{command:"L",values:[.5*d,a]},{command:"L",values:[0,a-.5*e]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.5*d,e]},{command:"L",values:[.5*d,a]},{command:"L",values:[d,a-.5*e]},{command:"L",values:[d,.5*e]},{command:"Z",values:[]}]}]};f.getCylinderShapes=function(a,e){var c=e?20:a;e=e?4:6;c=22>=c?c-.5*e:c-
e;e=.5*c;var d=.15*c;a-=d;return[{type:"ellipse",cx:.5*c,cy:a,rx:e,ry:d},{type:"path",path:[{command:"M",values:[0,d]},{command:"L",values:[0,a]},{command:"L",values:[c,a]},{command:"L",values:[c,d]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*c,cy:d,rx:e,ry:d}]};f.getConeShapes=function(a,e){var c=e?20:a;e=e?4:6;c=22>=c?c-.5*e:c-e;e=.15*c;var d=c;a-=e;return[{type:"ellipse",cx:.5*c,cy:a,rx:.5*c,ry:e},{type:"path",path:[{command:"M",values:[.5*d,0]},{command:"L",values:[d,a]},{command:"L",values:[0,
a]},{command:"Z",values:[]}]}]};f.getInvertedConeShapes=function(a){var e=a,e=22>e?e-3:e-6,c=.15*e,d=e;return[{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[d,0]},{command:"L",values:[.5*d,a-c]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*e,cy:0,rx:.5*e,ry:c}]};f.getDiamondShapes=function(a){var e=a,e=22>e?e-2:e-4,c=Math.floor(a/10)-1||1;return[{type:"path",path:[{command:"M",values:[.45*e,0]},{command:"L",values:[e,.5*a-c]},{command:"L",values:[.45*e-c,.5*a+c]},{command:"Z",
values:[]}]},{type:"path",path:[{command:"M",values:[.45*e,0]},{command:"L",values:[.45*e-c,.5*a+c]},{command:"L",values:[0,.5*a-c]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*a-c]},{command:"L",values:[.45*e-c,.5*a+c]},{command:"L",values:[.45*e,a]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*e,a]},{command:"L",values:[e,.5*a-c]},{command:"L",values:[.45*e-c,.5*a+c]},{command:"Z",values:[]}]}]};f.getTetrahedronShapes=function(a){var e=a,e=22>
e?e-1:e-2;return[{type:"path",path:[{command:"M",values:[.45*a,0]},{command:"L",values:[a,e]},{command:"L",values:[.45*a,.6*e]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*a,0]},{command:"L",values:[.45*a,.6*e]},{command:"L",values:[0,e]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,e]},{command:"L",values:[.45*a,.6*e]},{command:"L",values:[a,e]},{command:"Z",values:[]}]}]}})},"esri/symbols/support/renderUtils":function(){define("require exports dojo/_base/lang dojox/gfx dojox/gfx/matrix ../../kernel ../../request ../../core/colorUtils ../../core/Error ../../core/promiseUtils ../../core/sniff".split(" "),
function(x,f,a,e,c,d,l,q,m,t,w){function z(a){return a.map(function(a){return a.command+" "+a.values.join(",")}).join(" ").trim()}function y(d,g,b,k){var h=k&&k.node||document.createElement("div"),l=e.createSurface(h,g,b);null!=k.opacity&&(h.style.opacity=k.opacity.toString());try{d.forEach(function(d){var e=l.createGroup(),h=0;d.forEach(function(b){var a=b.shape,c=b.fill,d=b.stroke;h+=d&&d.width||0;var g=null;a&&("path"===a.type&&"string"!==typeof a.path&&(a.path=z(a.path)),g=e.createShape(a).setFill(c).setStroke(d?
d:{width:0}),"text"===a.type&&g.setFont(b.font))});var n=e.getBoundingBox();d=n.width;var p=n.height,A=-(n.x+d/2),f=-(n.y+p/2),r=l.getDimensions(),A={dx:A+r.width/2,dy:f+r.height/2},f=!1;if(k.scale&&0!==n.width&&0!==n.height){var f=n.width/n.height,q=(g>b?g:b)-2*h,m=1,v=1;isNaN(q)||(1<f?(m=q/n.width,v=q/f/n.height):(v=q/n.height,m=q*f/n.width));e.applyTransform(c.scaleAt(m,v,r.width/2,r.height/2));f=!0}!f&&(d>g||p>b)&&(n=d/g>p/b,d=((n?g:b)-5)/(n?d:p),a.mixin(A,{xx:d,yy:d}));e.applyTransform(A)})}catch(B){return l.clear(),
l.destroy(),null}return h}function h(a,c,b,d){return a?l(a,{responseType:"image",allowImageDataAccess:b}).then(function(a){a=a.data;var g=a.width,e=a.height,h=g/e,k=c;d&&(k=Math.min(k,Math.max(g,e)));return{image:b?a:null,width:1>=h?Math.ceil(k*h):k,height:1>=h?k:Math.ceil(k/h)}}).catch(function(g){if(b)return h(a,c,!1,d);throw g;}):t.reject(new m("renderUtils: imageDataSize","href not provided."))}Object.defineProperty(f,"__esModule",{value:!0});f.renderSymbol=function(a,c,b){var d=Math.ceil(c[0]);
c=Math.ceil(c[1]);return a.some(function(b){return!!b.length})?y(a,d,c,b):null};f.tintImageWithColor=function(a,c,b,e,l){return h(a,c,!!b,l).then(function(g){var h=g.width?g.width:c,k=g.height?g.height:c,l;if(l=g.image)l=b&&"ignore"!==e?"multiply"===e&&255===b.r&&255===b.g&&255===b.b&&1===b.a?!1:!0:!1;if(l){var n=g.image.width,f=g.image.height;(w("edge")||w("ie"))&&/\.svg$/i.test(a)&&(--n,--f);var A,p;A=Math.ceil(h);p=Math.ceil(k);l=document.createElement("canvas");l.width=A;l.height=p;l.style.width=
A+"px";l.style.height=p+"px";l=l.getContext("2d");l.clearRect(0,0,A,p);l.drawImage(g.image,0,0,n,f,0,0,h,k);g=l.getImageData(0,0,h,k);n=[b.r/255,b.g/255,b.b/255,b.a];f=q.toHSV(b);for(A=0;A<g.data.length;A+=4){p=g.data;var r=A,m=n,v=f;switch(e){case "multiply":p[r+0]*=m[0];p[r+1]*=m[1];p[r+2]*=m[2];p[r+3]*=m[3];break;default:var y=q.toHSV({r:p[r+0],g:p[r+1],b:p[r+2]});y.h=v.h;y.s=v.s;y.v=y.v/100*v.v;v=q.toRGB(y);p[r+0]=v.r;p[r+1]=v.g;p[r+2]=v.b;p[r+3]*=m[3]}}l.putImageData(g,0,0);a=l.canvas.toDataURL("image/png")}else(l=
d.id&&d.id.findCredential(a))&&l.token&&(g=-1===a.indexOf("?")?"?":"\x26",a=""+a+g+"token\x3d"+l.token);return{url:a,width:h,height:k}}).catch(function(){return{url:a,width:c,height:c}})}})},"dojox/gfx":function(){define(["dojo/_base/lang","./gfx/_base","./gfx/renderer!"],function(x,f,a){f.switchTo(a);return f})},"dojox/gfx/renderer":function(){define(["./_base","dojo/_base/lang","dojo/_base/sniff","dojo/_base/window","dojo/_base/config"],function(x,f,a,e,c){var d=null;a.add("vml",function(a,c,d){d.innerHTML=
'\x3cv:shape adj\x3d"1"/\x3e';a="adj"in d.firstChild;d.innerHTML="";return a});return{load:function(l,q,m){function t(){q(["dojox/gfx/"+w],function(a){x.renderer=w;d=a;m(a)})}if(d&&"force"!=l)m(d);else{var w=c.forceGfxRenderer;l=!w&&(f.isString(c.gfxRenderer)?c.gfxRenderer:"svg,vml,canvas,silverlight").split(",");for(var z,y;!w&&l.length;)switch(l.shift()){case "svg":"SVGAngle"in e.global&&(w="svg");break;case "vml":a("vml")&&(w="vml");break;case "silverlight":try{a("ie")?(z=new ActiveXObject("AgControl.AgControl"),
z.IsVersionSupported("1.0"))&&(y=!0):navigator.plugins["Silverlight Plug-In"]&&(y=!0)}catch(h){y=!1}finally{z=null}y&&(w="silverlight");break;case "canvas":e.global.CanvasRenderingContext2D&&(w="canvas")}"canvas"===w&&!1!==c.canvasEvents&&(w="canvasWithEvents");c.isDebug&&console.log("gfx renderer \x3d "+w);"svg"==w&&"undefined"!=typeof window.svgweb?window.svgweb.addOnLoad(t):t()}}}})},"dojox/gfx/matrix":function(){define(["./_base","dojo/_base/lang"],function(x,f){var a=x.matrix={},e={};a._degToRad=
function(a){return e[a]||(e[a]=Math.PI*a/180)};a._radToDeg=function(a){return a/Math.PI*180};a.Matrix2D=function(c){if(c)if("number"==typeof c)this.xx=this.yy=c;else if(c instanceof Array){if(0<c.length){for(var d=a.normalize(c[0]),e=1;e<c.length;++e){var q=d,m=a.normalize(c[e]),d=new a.Matrix2D;d.xx=q.xx*m.xx+q.xy*m.yx;d.xy=q.xx*m.xy+q.xy*m.yy;d.yx=q.yx*m.xx+q.yy*m.yx;d.yy=q.yx*m.xy+q.yy*m.yy;d.dx=q.xx*m.dx+q.xy*m.dy+q.dx;d.dy=q.yx*m.dx+q.yy*m.dy+q.dy}f.mixin(this,d)}}else f.mixin(this,c)};f.extend(a.Matrix2D,
{xx:1,xy:0,yx:0,yy:1,dx:0,dy:0});f.mixin(a,{identity:new a.Matrix2D,flipX:new a.Matrix2D({xx:-1}),flipY:new a.Matrix2D({yy:-1}),flipXY:new a.Matrix2D({xx:-1,yy:-1}),translate:function(c,d){return 1<arguments.length?new a.Matrix2D({dx:c,dy:d}):new a.Matrix2D({dx:c.x,dy:c.y})},scale:function(c,d){return 1<arguments.length?new a.Matrix2D({xx:c,yy:d}):"number"==typeof c?new a.Matrix2D({xx:c,yy:c}):new a.Matrix2D({xx:c.x,yy:c.y})},rotate:function(c){var d=Math.cos(c);c=Math.sin(c);return new a.Matrix2D({xx:d,
xy:-c,yx:c,yy:d})},rotateg:function(c){return a.rotate(a._degToRad(c))},skewX:function(c){return new a.Matrix2D({xy:Math.tan(c)})},skewXg:function(c){return a.skewX(a._degToRad(c))},skewY:function(c){return new a.Matrix2D({yx:Math.tan(c)})},skewYg:function(c){return a.skewY(a._degToRad(c))},reflect:function(c,d){1==arguments.length&&(d=c.y,c=c.x);var e=c*c,f=d*d,m=e+f,t=2*c*d/m;return new a.Matrix2D({xx:2*e/m-1,xy:t,yx:t,yy:2*f/m-1})},project:function(c,d){1==arguments.length&&(d=c.y,c=c.x);var e=
c*c,f=d*d,m=e+f,t=c*d/m;return new a.Matrix2D({xx:e/m,xy:t,yx:t,yy:f/m})},normalize:function(c){return c instanceof a.Matrix2D?c:new a.Matrix2D(c)},isIdentity:function(a){return 1==a.xx&&0==a.xy&&0==a.yx&&1==a.yy&&0==a.dx&&0==a.dy},clone:function(c){var d=new a.Matrix2D,e;for(e in c)"number"==typeof c[e]&&"number"==typeof d[e]&&d[e]!=c[e]&&(d[e]=c[e]);return d},invert:function(c){c=a.normalize(c);var d=c.xx*c.yy-c.xy*c.yx;return c=new a.Matrix2D({xx:c.yy/d,xy:-c.xy/d,yx:-c.yx/d,yy:c.xx/d,dx:(c.xy*
c.dy-c.yy*c.dx)/d,dy:(c.yx*c.dx-c.xx*c.dy)/d})},_multiplyPoint:function(a,d,e){return{x:a.xx*d+a.xy*e+a.dx,y:a.yx*d+a.yy*e+a.dy}},multiplyPoint:function(c,d,e){c=a.normalize(c);return"number"==typeof d&&"number"==typeof e?a._multiplyPoint(c,d,e):a._multiplyPoint(c,d.x,d.y)},multiplyRectangle:function(c,d){var e=a.normalize(c);d=d||{x:0,y:0,width:0,height:0};if(a.isIdentity(e))return{x:d.x,y:d.y,width:d.width,height:d.height};c=a.multiplyPoint(e,d.x,d.y);var f=a.multiplyPoint(e,d.x,d.y+d.height),m=
a.multiplyPoint(e,d.x+d.width,d.y);d=a.multiplyPoint(e,d.x+d.width,d.y+d.height);var e=Math.min(c.x,f.x,m.x,d.x),t=Math.min(c.y,f.y,m.y,d.y);return{x:e,y:t,width:Math.max(c.x,f.x,m.x,d.x)-e,height:Math.max(c.y,f.y,m.y,d.y)-t}},multiply:function(c){for(var d=a.normalize(c),e=1;e<arguments.length;++e){var f=d,m=a.normalize(arguments[e]),d=new a.Matrix2D;d.xx=f.xx*m.xx+f.xy*m.yx;d.xy=f.xx*m.xy+f.xy*m.yy;d.yx=f.yx*m.xx+f.yy*m.yx;d.yy=f.yx*m.xy+f.yy*m.yy;d.dx=f.xx*m.dx+f.xy*m.dy+f.dx;d.dy=f.yx*m.dx+f.yy*
m.dy+f.dy}return d},_sandwich:function(c,d,e){return a.multiply(a.translate(d,e),c,a.translate(-d,-e))},scaleAt:function(c,d,e,f){switch(arguments.length){case 4:return a._sandwich(a.scale(c,d),e,f);case 3:return"number"==typeof e?a._sandwich(a.scale(c),d,e):a._sandwich(a.scale(c,d),e.x,e.y)}return a._sandwich(a.scale(c),d.x,d.y)},rotateAt:function(c,d,e){return 2<arguments.length?a._sandwich(a.rotate(c),d,e):a._sandwich(a.rotate(c),d.x,d.y)},rotategAt:function(c,d,e){return 2<arguments.length?a._sandwich(a.rotateg(c),
d,e):a._sandwich(a.rotateg(c),d.x,d.y)},skewXAt:function(c,d,e){return 2<arguments.length?a._sandwich(a.skewX(c),d,e):a._sandwich(a.skewX(c),d.x,d.y)},skewXgAt:function(c,d,e){return 2<arguments.length?a._sandwich(a.skewXg(c),d,e):a._sandwich(a.skewXg(c),d.x,d.y)},skewYAt:function(c,d,e){return 2<arguments.length?a._sandwich(a.skewY(c),d,e):a._sandwich(a.skewY(c),d.x,d.y)},skewYgAt:function(c,d,e){return 2<arguments.length?a._sandwich(a.skewYg(c),d,e):a._sandwich(a.skewYg(c),d.x,d.y)}});x.Matrix2D=
a.Matrix2D;return a})},"esri/core/colorUtils":function(){define([],function(){var x={COEF_RGB2XYZ:[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],COEF_XYZ2RGB:[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]],matrixProduct:function(a,e){var c=[],d,f;if(a[0].length!==e.length)throw"dimensions do not match";var q=a.length,m=a[0].length,t=0;for(d=0;d<q;d++){for(f=t=0;f<m;f++)t+=a[d][f]*e[f];c.push(t)}return c},rgb2xyz:function(a){a=[a.r/255,a.g/255,a.b/255].map(function(a){return.04045>=
a?a/12.92:Math.pow((a+.055)/1.055,2.4)});a=this.matrixProduct(this.COEF_RGB2XYZ,a);return{x:100*a[0],y:100*a[1],z:100*a[2]}},xyz2rgb:function(a){a=this.matrixProduct(this.COEF_XYZ2RGB,[a.x/100,a.y/100,a.z/100]).map(function(a){return Math.min(1,Math.max(.0031308>=a?12.92*a:1.055*Math.pow(a,1/2.4)-.055,0))});return{r:Math.round(255*a[0]),g:Math.round(255*a[1]),b:Math.round(255*a[2])}},xyz2lab:function(a){a=[a.x/95.047,a.y/100,a.z/108.883].map(function(a){return a>Math.pow(6/29,3)?Math.pow(a,1/3):1/
3*Math.pow(29/6,2)*a+4/29});return{l:116*a[1]-16,a:500*(a[0]-a[1]),b:200*(a[1]-a[2])}},lab2xyz:function(a){var e=a.l;a=[(e+16)/116+a.a/500,(e+16)/116,(e+16)/116-a.b/200].map(function(a){return a>6/29?Math.pow(a,3):3*Math.pow(6/29,2)*(a-4/29)});return{x:95.047*a[0],y:100*a[1],z:108.883*a[2]}},lab2lch:function(a){var e=a.l,c=a.a,d=a.b;a=Math.sqrt(c*c+d*d);c=Math.atan2(d,c);c=0<c?c:c+2*Math.PI;return{l:e,c:a,h:c}},lch2lab:function(a){var e=a.c,c=a.h;return{l:a.l,a:e*Math.cos(c),b:e*Math.sin(c)}},rgb2lab:function(a){return this.xyz2lab(this.rgb2xyz(a))},
lab2rgb:function(a){return this.xyz2rgb(this.lab2xyz(a))},rgb2lch:function(a){return this.lab2lch(this.xyz2lab(this.rgb2xyz(a)))},lch2rgb:function(a){return this.xyz2rgb(this.lab2xyz(this.lch2lab(a)))}},f={rgb2hsv:function(a){var e=a.r,c=a.g;a=a.b;var d=Math.max(e,c,a),f=d-Math.min(e,c,a),q;0===f?q=0:d===e?q=(c-a)/f%6:d===c?q=(a-e)/f+2:d===a&&(q=(e-c)/f+4);0>q&&(q+=6);return{h:60*q,s:100*(0===f?0:f/d),v:100/255*d}},hsv2rgb:function(a){var e=a.h/60,c=a.v/100*255;a=a.s/100*c;var d=a*(1-Math.abs(e%2-
1)),f;switch(Math.floor(e)){case 0:f={r:a,g:d,b:0};break;case 1:f={r:d,g:a,b:0};break;case 2:f={r:0,g:a,b:d};break;case 3:f={r:0,g:d,b:a};break;case 4:f={r:d,g:0,b:a};break;case 5:case 6:f={r:a,g:0,b:d}}f.r=Math.round(f.r+c-a);f.g=Math.round(f.g+c-a);f.b=Math.round(f.b+c-a);return f}};return{toRGB:function(a){var e;void 0!==a.r&&void 0!==a.g&&void 0!==a.b?e=a:void 0!==a.l&&void 0!==a.c&&void 0!==a.h?e=x.lch2rgb(a):void 0!==a.l&&void 0!==a.a&&void 0!==a.b?e=x.lab2rgb(a):void 0!==a.x&&void 0!==a.y&&
void 0!==a.z?e=x.xyz2rgb(a):void 0!==a.h&&void 0!==a.s&&void 0!==a.v&&(e=f.hsv2rgb(a));return e},toHSV:function(a){if(void 0!==a.h&&void 0!==a.s&&void 0!==a.v)return a;a=this.toRGB(a);return f.rgb2hsv(a)},toLAB:function(a){return void 0!==a.l&&void 0!==a.a&&void 0!==a.b?a:x.rgb2lab(this.toRGB(a))},toLCH:function(a){return void 0!==a.l&&void 0!==a.c&&void 0!==a.h?a:x.rgb2lch(this.toRGB(a))},toXYZ:function(a){return void 0!==a.x&&void 0!==a.y&&void 0!==a.z?a:x.rgb2xyz(this.toRGB(a))}}})},"esri/symbols/support/previewSymbol3D":function(){define("require exports ../../core/Error ../../core/Logger ../../core/promiseUtils ../../core/screenUtils ./gfxUtils ./previewUtils ./renderUtils ./styleUtils ./symbolUtils".split(" "),
function(x,f,a,e,c,d,l,q,m,t,w){function z(b){var a=b.outline,c=b.get("material.color"),c=c&&c.toRgba().toString();if(!a)return"fill"===b.type&&"255,255,255,1"===c?{color:"#bdc3c7",width:.75}:null;b=d.pt2px(a.size)||0;return{color:"rgba("+(null!=a.color?a.color.toRgba():"255,255,255,1")+")",width:Math.min(b,80)}}function y(b,a){var d=a&&a.resource,d=d&&d.href;return b.thumbnail&&b.thumbnail.url?c.resolve(b.thumbnail.url):d&&"object"!==a.type?c.resolve(w.getIconHref(b,a)):b.styleOrigin&&(b.styleOrigin.styleName||
b.styleOrigin.styleUrl)?t.resolveWebStyleSymbol(b.styleOrigin,{portal:b.styleOrigin.portal}).always(function(b){return b&&b.thumbnail&&b.thumbnail.url||C}):c.resolve(C)}function h(b,a){if(!b.material||!b.material.color)return b=Math.min(Math.max(l.defaultThematicColor.r+191.25*a,0),255),[b,b,b,100];for(var c=b.material.color.toRgb(),d=0;3>d;d++)c[d]=Math.min(Math.max(c[d]+191.25*a,0),255);c.push(b.material.color.a);return c}function p(b){return b.outline?z(b):{color:"rgba(0, 0, 0, 1)",width:1.5}}
function g(b,a){if(!b.material)return{};for(var c=b.material.color.toRgb(),g="rgba(",e=0;3>e;e++)g+=Math.min(Math.max(c[e]+191.25*a,0),255)+",";g+=b.material.color.a+");";b=b.size?d.pt2px(b.size):.75;return{color:g,width:Math.min(b,80)}}function b(b,a,c){c*=.75;return{type:"linear",x1:c?.25*c:0,y1:c?.5*c:0,x2:c||4,y2:c?.5*c:4,colors:[{color:b,offset:0},{color:a,offset:1}]}}function k(b){var a=b.depth,c=b.height;return(b=b.width)&&a&&c&&b===a&&b<c}function r(a,c,d,g){var e=a&&a.type,k="object"===e,
f=[];if("icon"===e)switch(c){case "circle":f.push({shape:{type:"circle",cx:0,cy:0,r:.5*d},fill:h(a,0),stroke:z(a)});break;case "square":f.push({shape:{type:"path",path:[{command:"M",values:[0,d]},{command:"L",values:[0,0]},{command:"L",values:[d,0]},{command:"L",values:[d,d]},{command:"Z",values:[]}]},fill:h(a,0),stroke:z(a)});break;case "cross":f.push({shape:{type:"path",path:[{command:"M",values:[.5*d,0]},{command:"L",values:[.5*d,d]},{command:"M",values:[0,.5*d]},{command:"L",values:[d,.5*d]},
{command:"E",values:[]}]},stroke:p(a)});break;case "x":f.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[d,d]},{command:"M",values:[d,0]},{command:"L",values:[0,d]},{command:"E",values:[]}]},stroke:p(a)});break;case "kite":f.push({shape:{type:"path",path:[{command:"M",values:[0,.5*d]},{command:"L",values:[.5*d,0]},{command:"L",values:[d,.5*d]},{command:"L",values:[.5*d,d]},{command:"Z",values:[]}]},fill:h(a,0),stroke:z(a)})}else if(k)switch(c){case "cone":c=h(a,0);a=
h(a,-.6);a=b(c,a,g?20:d);d=q.getConeShapes(d,g);f.push({shape:d[0],fill:a});f.push({shape:d[1],fill:a});break;case "inverted-cone":g=h(a,0);a=h(a,-.6);a=b(g,a,d);d=q.getInvertedConeShapes(d);f.push({shape:d[0],fill:a});f.push({shape:d[1],fill:g});break;case "cube":d=q.getCubeShapes(d,g);f.push({shape:d[0],fill:h(a,0)});f.push({shape:d[1],fill:h(a,-.3)});f.push({shape:d[2],fill:h(a,-.5)});break;case "cylinder":c=h(a,0);e=h(a,-.6);c=b(c,e,g?20:d);d=q.getCylinderShapes(d,g);f.push({shape:d[0],fill:c});
f.push({shape:d[1],fill:c});f.push({shape:d[2],fill:h(a,0)});break;case "diamond":d=q.getDiamondShapes(d);f.push({shape:d[0],fill:h(a,-.3)});f.push({shape:d[1],fill:h(a,0)});f.push({shape:d[2],fill:h(a,-.3)});f.push({shape:d[3],fill:h(a,-.7)});break;case "sphere":g=h(a,0);a=h(a,-.6);a=b(g,a);a.x1=0;a.y1=0;a.x2=.25*d;a.y2=.25*d;f.push({shape:{type:"circle",cx:0,cy:0,r:.5*d},fill:a});break;case "tetrahedron":d=q.getTetrahedronShapes(d),f.push({shape:d[0],fill:h(a,-.3)}),f.push({shape:d[1],fill:h(a,
0)}),f.push({shape:d[2],fill:h(a,-.6)})}return f}function v(b,a){var g=a&&a.size?d.pt2px(a.size):null,e=a&&a.maxSize?d.pt2px(a.maxSize):null,f=a&&a.disableUpsampling,h=b.symbolLayers,p=[],n=0,v=0,l=h.getItemAt(h.length-1),q;l&&"icon"===l.type&&(q=l.size&&d.pt2px(l.size));h.forEach(function(h,l){if("icon"===h.type||"object"===h.type){l="icon"===h.type?h.size&&d.pt2px(h.size):0;var u=g||l?Math.ceil(Math.min(g||l,e||120)):22,B=z(h),t=B?B.width:0;if(h&&h.resource&&h.resource.href)l=y(b,h).then(function(a){var b=
h.get("material.color"),c;c="icon"===h.type?"multiply":"tint";return m.tintImageWithColor(a,u,b,c,f)}).then(function(a){var b=a.width,c=a.height;n=Math.max(n,b+2*t);v=Math.max(v,c+2*t);return[{shape:{type:"image",width:b,height:c,src:a.url},fill:null,stroke:null}]}),p.unshift(l);else{(B=h.get("resource.primitive"))||(B="icon"===h.type?"circle":"sphere");var A=u;"icon"===h.type&&q&&g&&(A=l/q*u);l=a&&"tall"===a.symbolConfig||("object"===h.type?k(h):!1);n=Math.max(n,l?20:A+2*t);v=Math.max(v,A+2*t);p.unshift(c.resolve(r(h,
B,A,l)))}}});return c.eachAlways(p).then(function(b){var c=[];b.forEach(function(a){a.value?c.push(a.value):a.error&&E.warn("error while building swatchInfo!",a.error)});return m.renderSymbol(c,[n,v],{node:a&&a.node,scale:!1})})}function B(a,b){var e=a.symbolLayers,f=[];a=w.isVolumetricSymbol(a);var k=b&&b.size?d.pt2px(b.size):null,p=(b&&b.maxSize?d.pt2px(b.maxSize):null)||80,r=0,n=0,v;e.forEach(function(a,b){var c=a&&a.type,d="line"===c;if(d||"path"===c){var e=g(a,0),m=e&&e.width||0,c=[];d?(0===
b&&(v=m),a=Math.min(k||m,p),a=0===b?a:k?m/v*a:a,n=Math.max(n,a),r=Math.max(r,22<a?2*a:40),e.width=a,c.push({shape:{type:"path",path:[{command:"M",values:[0,.5*n]},{command:"L",values:[r,.5*n]},{command:"E",values:[]}]},stroke:e})):(b=Math.min(k||22,p),e=h(a,0),d=h(a,-.2),a=g(a,-.4),a.width=1,c.push({shape:q.shapes.pathSymbol3DLayer[0],fill:d,stroke:a}),c.push({shape:q.shapes.pathSymbol3DLayer[1],fill:e,stroke:a}),r=n=Math.max(n,b+2));f.push(c)}});return c.resolve(m.renderSymbol(f,[r,n],{node:b&&b.node,
scale:a}))}Object.defineProperty(f,"__esModule",{value:!0});var C=x.toUrl("../../images/Legend/legend3dsymboldefault.png"),E=e.getLogger("esri.symbols.support.previewSymbol3D");f.previewSymbol3D=function(b,e){if(0===b.symbolLayers.length)return c.reject(new a("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));var f=null;switch(b.type){case "point-3d":f=v(b,e);break;case "line-3d":f=B(b,e);break;case "polygon-3d":case "mesh-3d":a:{f="mesh-3d"===b.type;b=b.symbolLayers;for(var k=
e&&e.size?d.pt2px(e.size):null,p=e&&e.maxSize?d.pt2px(e.maxSize):null,k=k||22,r=[],n=0,l=0,y=0;y<b.length;y++){var t=b.getItemAt(y),w=t.type,C="fill"===w,x="line"===w,u="extrude"===t.type,w=[];if(f&&!C){f=void 0;break a}var D=q.shapes.fill[0];C?(x=(C=z(t))&&C.width||0,n=Math.max(n,22+x),l=Math.max(l,22+x),w.push({shape:D,fill:h(t,0),stroke:C})):x?(t=(C=g(t,0))&&C.width||0,D={stroke:C,shape:D},n=Math.max(n,22+t),l=Math.max(l,22+t),w.push(D)):u&&(D=g(t,-.4),C=h(t,0),t=h(t,-.2),x=Math.min(k,p||120),
u=q.getExtrudeSymbolShapes(x),D.width=1,w.push({shape:u[0],fill:t,stroke:D}),w.push({shape:u[1],fill:t,stroke:D}),w.push({shape:u[2],fill:C,stroke:D}),t=22*.7+.5*x,n=Math.max(n,22+2*D.width),l=Math.max(l,t+2*D.width));r.push(w)}f=c.resolve(m.renderSymbol(r,[n,l],{node:e&&e.node,scale:!1}))}}return f?f:c.reject(new a("symbolPreview: swatchInfo3D","symbol not supported."))}})},"esri/symbols/support/symbolUtils":function(){define(["require","exports","../../core/sniff"],function(x,f,a){Object.defineProperty(f,
"__esModule",{value:!0});f.isVolumetricSymbol=function(a){return(a=a&&a.symbolLayers)?a.some(function(a){a=a.type;return"object"===a||"path"===a||"extrude"===a}):!1};f.getIconHref=function(c,d){d=d.resource.href;return!a("esri-canvas-svg-support")&&c.styleOrigin&&e.test(d)?d.replace(e,"/resource/png/$1.png"):d};var e=/\/resource\/(.*?)\.svg$/})},"esri/symbols/support/previewWebStyleSymbol":function(){define(["require","exports","../../request","../../core/screenUtils"],function(x,f,a,e){Object.defineProperty(f,
"__esModule",{value:!0});f.previewWebStyleSymbol=function(c,d,f){var l=c.thumbnail&&c.thumbnail.url;return l?a(l,{responseType:"image"}).then(function(a){a=a.data;var c=!/\\.svg$/i.test(a.src)&&f&&f.disableUpsampling,d=Math.max(a.width,a.height),l=f&&null!=f.maxSize?e.pt2px(f.maxSize):120;c&&(l=Math.min(d,l));c=Math.min(l,f&&null!=f.size?e.pt2px(f.size):d);c!==d&&(d=0!==a.width&&0!==a.height?a.width/a.height:1,1<=d?(a.width=c,a.height=c/d):(a.width=c*d,a.height=c));return f&&f.node?(f.node.appendChild(a),
f.node):a}):c.fetchSymbol().then(function(a){return d(a,f)})}})},"esri/widgets/Legend/support/colorRampUtils":function(){define("require exports ../../../Color ../../../core/numberUtils ../../../symbols/support/gfxUtils ./utils".split(" "),function(x,f,a,e,c,d){function l(a,c){var d=c-a;c=[0,.25,.5,.75,1].map(function(c){return Number((a+c*d).toFixed(6))});q(0,4,c);return c}function q(a,c,d){var g=a+(c-a)/2,b=d[0],e=d[1],f=d[2],h=Math.floor(b),p=Math.floor(e),l=Math.floor(f);h===b&&l===f&&p!==e&&
h!==p&&l!==p&&(d[g]=p);a+1!==g&&q(a,g,d);g+1!==c&&q(g,c,d)}function m(c,d){c=t(c,d);var e=c.startIndex,g=c.endIndex;if(e===g)return d[e].color;d=a.blendColors(d[e].color,d[g].color,c.weight);return new a(d)}function t(a,c){var d=0,g=c.length-1;c.some(function(b,c){if(a<b.value)return g=c,!0;d=c;return!1});return{startIndex:d,endIndex:g,weight:(a-c[d].value)/(c[g].value-c[d].value)}}Object.defineProperty(f,"__esModule",{value:!0});var w=[64,64,64],z=[255,255,255];f.getRampBorderColor=function(a){var d=
null;if("simple"===a.type)d=a.symbol;else if("unique-value"===a.type||"class-breaks"===a.type)d=(a=(a=a.classBreakInfos||a.uniqueValueInfos)&&a[0])&&a.symbol;return(a=(a=d&&-1===d.type.indexOf("line-symbol")?c.getStroke(d):null)&&a.color)&&0<a.a&&!(240<=a.r&&240<=a.g&&240<=a.b)?a:null};f.getRampOverlayColor=function(c){var d=new a(z);d.a=1-c;return d};f.getRampStops=function(c,f,p){var g=!1,b=[],k=[];if(f.colors||f.opacityValues)b=l(f.minDataValue,f.maxDataValue);else if(f.stops){var h=f.stops,b=
h.map(function(a){return a.value});(g=h.some(function(a){return!!a.label}))&&(k=h.map(function(a){return a.label}))}var v=b[0],h=b[b.length-1];if(null==v&&null==h)return null;var m=h-v;return b.map(function(h,r){var n;if("opacity"===f.type){n=p;void 0===n&&(n=w);n=new a(n);var l=c.getOpacity(h,{opacityInfo:f});null!=l&&(n.a=l)}else n=c.getColor(h,{colorInfo:f});r=g?k[r]:d.getLabelPrefix(r,b.length-1)+e.format(h);return{value:h,color:n,label:r,offset:m?1-(h-v)/m:1}}).reverse()};f.getRampStopsForPointCloud=
function(a){var c=!1,f=[],g=[],f=a.map(function(a){return a.value});(c=a.some(function(a){return!!a.label}))&&(g=a.map(function(a){return a.label}));var b=f[0],k=f[f.length-1];if(null==b&&null==k)return null;var r=k-b;return f.map(function(k,h){var p=m(k,a);h=c?g[h]:d.getLabelPrefix(h,f.length-1)+e.format(k);return{value:k,color:p,label:h,offset:r?1-(k-b)/r:1}}).reverse()};f.getColorFromPointCloudStops=m})},"esri/widgets/Legend/support/utils":function(){define(["require","exports"],function(x,f){Object.defineProperty(f,
"__esModule",{value:!0});f.getLabelPrefix=function(a,e){return 0===a?"\x3c ":a===e?"\x3e ":""}})},"esri/widgets/Legend/support/sizeRampUtils":function(){define(["require","exports","../../../core/numberUtils","../../../symbols/support/symbolUtils","./utils"],function(x,f,a,e,c){function d(a,c){var b=null,d=null;if("simple"===a.type)b=a.symbol;else if("unique-value"===a.type||"class-breaks"===a.type)b=(b=(a=a.classBreakInfos||a.uniqueValueInfos)&&a[0])&&b.symbol,d=1<a.length;if(!b||l(b))return null;
b=b.clone();if(c||d)-1<b.type.indexOf("3d")?q(b):(c=b,-1!==c.type.indexOf("line")?c.color=g:(c.color=h,"simple-marker"===c.type&&(c.outline={color:g,width:1.5})));return b}function l(a){if(a)return-1<a.type.indexOf("3d")?(a=a.symbolLayers)?a.some(function(a){return a&&"fill"===a.type}):!1:-1!==a.type.indexOf("fill")}function q(a){e.isVolumetricSymbol(a)||(-1!==a.type.indexOf("line-3d")?a.symbolLayers.forEach(function(a){a.material={color:g}}):a.symbolLayers.forEach(function(a){"icon"!==a.type||a.resource&&
a.resource.href?a.material={color:p}:(a.material={color:h},a.outline={color:g,size:1.5})}))}function m(b,c,d,g){var e=b.getSizeRangeAtScale(c,g),f=e&&t(e);if(e||f){for(var h=f.map(function(a){var b=e.minSize,d=e.maxSize,g=c.minDataValue,f=c.maxDataValue;return a<=b?g:a>=d?f:(a-b)/(d-b)*(f-g)+g}),h=a.round(h),k=1;k<h.length-1;k++){var p=w(b,c,d,h[k],h[k-1],g);p&&(h[k]=p[0],f[k]=p[1])}return h}}function t(a){var b=a.minSize;a=(a.maxSize-b)/4;for(var c=[],d=0;5>d;d++)c.push(b+a*d);return c}function w(b,
c,d,g,e,f){var h=z(b,c,d,g,f);e=z(b,c,d,e,f);var k=a.numDigits(g),p=k.fractional,l=k.integer,r=k=null;0<g&&1>g&&(k=Math.pow(10,p),g*=k,l=a.numDigits(g).integer);for(p=l-1;0<=p;p--){var m=Math.pow(10,p),l=Math.floor(g/m)*m,m=Math.ceil(g/m)*m;null!=k&&(l/=k,m/=k);var q=(l+m)/2,q=a.round([l,q,m],{indexes:[1]}),q=q[1],t=z(b,c,d,l,f),v=z(b,c,d,m,f),w=z(b,c,d,q,f),B=a.percentChange(h,t,e,null),x=a.percentChange(h,v,e,null),y=a.percentChange(h,w,e,null),C=20>=B.previous,u=20>=x.previous;C&&u&&(B.previous<=
x.previous?(C=!0,u=!1):(u=!0,C=!1));C?r=[l,t]:u?r=[m,v]:20>=y.previous&&(r=[q,w]);if(r)break}return r}function z(a,c,d,g,e){return a.getSize(g,{sizeInfo:c,scale:e,shape:-1!==d.type.indexOf("marker-symbol")?d.style:null})}function y(a,c){a=a.clone();if("esri.symbols.Symbol3D"===a.declaredClass)e.isVolumetricSymbol(a)||a.symbolLayers.forEach(function(a){"fill"!==a.type&&(a.size=c)});else if("esri.symbols.SimpleMarkerSymbol"===a.declaredClass)a.size=c;else if("esri.symbols.PictureMarkerSymbol"===a.declaredClass){var b=
a.width,d=a.height;a.height=c;a.width=b/d*c}else"esri.symbols.SimpleLineSymbol"===a.declaredClass?a.width=c:"esri.symbols.TextSymbol"===a.declaredClass&&a.font&&(a.font.size=c);return a}Object.defineProperty(f,"__esModule",{value:!0});f.REAL_WORLD_MAX_SIZE=30;f.REAL_WORLD_MIN_SIZE=12;var h=[255,255,255],p=[200,200,200],g=[128,128,128];f.getRampStops=function(b,g,h,p){var k=g.legendOptions,k=k&&k.customValues,l=d(b,h);h=null!=g.minSize&&null!=g.maxSize;var r=g.stops&&1<g.stops.length,n=!!g.target;
if(l&&(k||h||r&&!n)){var q=e.isVolumetricSymbol(l),t=null,v=null,w=null,v=q&&!r?[g.minDataValue,g.maxDataValue]:k||m(b,g,l,p);!v&&r&&(v=g.stops.map(function(a){return a.value}),(t=g.stops.some(function(a){return!!a.label}))&&(w=g.stops.map(function(a){return a.label})));k=!q||v&&2===v.length;if(!v||!k)return null;var x=[f.REAL_WORLD_MIN_SIZE,f.REAL_WORLD_MAX_SIZE];return v.map(function(d,e){var f=q?x[e]:z(b,g,l,d,p),h=y(l,f);e=t?w[e]:c.getLabelPrefix(e,v.length-1)+a.format(d);return{value:d,symbol:h,
label:e,size:f}}).reverse()}}})},"*noref":1}});
define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Collection ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators ./support/ActiveLayerInfo".split(" "),function(x,f,a,e,c,d,l,q,m,t){var w=d.ofType(t),z="esri.layers.CSVLayer esri.layers.FeatureLayer esri.layers.MapImageLayer esri.layers.MapNotesLayer esri.layers.PointCloudLayer esri.layers.TileLayer esri.layers.StreamLayer esri.layers.SceneLayer esri.layers.GeoRSSLayer esri.layers.GroupLayer esri.layers.ImageryLayer esri.layers.WMSLayer esri.layers.WMTSLayer".split(" "),y=
["view.basemapView.baseLayerViews","view.groundView.layerViews","view.layerViews","view.basemapView.referenceLayerViews"];return function(c){function d(a){a=c.call(this,a)||this;a._handles=new l;a._layerViewByLayerId={};a._layerInfosByLayerViewId={};a._activeLayerInfosByLayerViewId={};a.activeLayerInfos=new w;a.basemapLegendVisible=!1;a.groundLegendVisible=!1;a.layerInfos=[];a.view=null;return a}a(d,c);d.prototype.initialize=function(){this._handles.add(q.init(this,"view",this._viewHandles),"view")};
d.prototype.destroy=function(){this._destroyViewActiveLayerInfos();this._handles.destroy();this.view=this._handles=null};Object.defineProperty(d.prototype,"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,configurable:!0});d.prototype._viewHandles=function(){this._handles.remove("state");this.view&&this._handles.add(q.init(this,"state",this._stateHandles),"state")};d.prototype._stateHandles=function(){this._resetAll();"ready"===this.state&&this._watchPropertiesAndAllLayerViews()};
d.prototype._resetAll=function(){this._handles.remove(["all-layer-views","legend-properties"]);this._destroyViewActiveLayerInfos();this.activeLayerInfos.removeAll()};d.prototype._destroyViewActiveLayerInfos=function(){Object.keys(this._activeLayerInfosByLayerViewId).forEach(this._destroyViewActiveLayerInfo,this)};d.prototype._destroyViewActiveLayerInfo=function(a){this._handles.remove(a);delete this._activeLayerInfosByLayerViewId[a]};d.prototype._watchPropertiesAndAllLayerViews=function(){var a=this.view.allLayerViews;
a.length&&this._refresh();this._handles.add(a.on("change",this._allLayerViewsChangeHandle.bind(this)),"all-layer-views");this._handles.add(q.watch(this,"layerInfos, basemapLegendVisible, groundLegendVisible",this._propertiesChangeHandle.bind(this)),"legend-properties")};d.prototype._allLayerViewsChangeHandle=function(a){var b=this;a.removed.forEach(function(a){return b._destroyViewActiveLayerInfo(a.uid)});this._refresh()};d.prototype._propertiesChangeHandle=function(){this._destroyViewActiveLayerInfos();
this._refresh()};d.prototype._refresh=function(){this._layerInfosByLayerViewId={};this.activeLayerInfos.removeAll();this._generateLayerViews().filter(this._filterLayerViewsByLayerInfos,this).filter(this._isLayerViewSupported,this).forEach(this._generateActiveLayerInfo,this);this._sortActiveLayerInfos(this.activeLayerInfos)};d.prototype._sortActiveLayerInfos=function(a){var b={};this.view.allLayerViews.forEach(function(a,c){return b[a.layer.uid]=c});a.sort(function(a,c){return(b[c.layer.uid]||0)-(b[a.layer.uid]||
0)})};d.prototype._generateLayerViews=function(){var a=[];y.filter(this._filterLayerViews,this).map(this.get,this).filter(function(a){return null!=a}).forEach(this._collectLayerViews("layerViews",a));return a};d.prototype._filterLayerViews=function(a){var b=!this.groundLegendVisible&&"view.groundView.layerViews"===a;return!(!this.basemapLegendVisible&&("view.basemapView.baseLayerViews"===a||"view.basemapView.referenceLayerViews"===a))&&!b};d.prototype._collectLayerViews=function(a,b){var c=function(d){d&&
d.forEach(function(d){b.push(d);c(d[a])});return b};return c};d.prototype._filterLayerViewsByLayerInfos=function(a){var b=this,c=this.layerInfos;return c&&c.length?c.some(function(c){return b._hasLayerInfo(c,a)}):!0};d.prototype._hasLayerInfo=function(a,b){var c=this._isLayerUIDMatching(a.layer,b.layer.uid);c&&(this._layerInfosByLayerViewId[b.uid]=a);return c};d.prototype._isLayerUIDMatching=function(a,b){return a&&(a.uid===b||this._hasLayerUID(a.layers,b))};d.prototype._hasLayerUID=function(a,b){var c=
this;return a&&a.some(function(a){return c._isLayerUIDMatching(a,b)})};d.prototype._isLayerViewSupported=function(a){return-1<z.indexOf(a.layer.declaredClass)?(this._layerViewByLayerId[a.layer.uid]=a,!0):!1};d.prototype._generateActiveLayerInfo=function(a){var b=this;this._isLayerActive(a)?this._buildActiveLayerInfo(a):(this._handles.remove(a.uid),this._handles.add(q.watch(a,"suspended, layer.legendEnabled",function(){return b._layerActiveHandle(a)}),a.uid))};d.prototype._layerActiveHandle=function(a){this._isLayerActive(a)&&
(this._handles.remove(a.uid),this._buildActiveLayerInfo(a))};d.prototype._isLayerActive=function(a){return!a.suspended&&a.get("layer.legendEnabled")};d.prototype._buildActiveLayerInfo=function(a){var b=this,c=a.layer,d=a.uid,e=this._layerInfosByLayerViewId[d],f=this._activeLayerInfosByLayerViewId[d];f||(f=new t({layer:c,title:e&&void 0!==e.title?e.title:c.title}),this._activeLayerInfosByLayerViewId[d]=f);f.parent||(e=(e=c.parent)&&this._layerViewByLayerId[e.uid],f.parent=e&&this._activeLayerInfosByLayerViewId[e.uid]);
if(!this._handles.has(d)){var e=q.watch(c,"title",function(c){return b._titleHandle(c,f,a)}),g=q.watch(c,"legendEnabled",function(c){return b._legendEnabledHandle(c,f,a)}),c=q.watch(c,"renderer, opacity",function(){return b._constructLegendElements(f,a)}),h=q.watch(a,"suspended",function(c){return b._suspendedHandle(c,f,a)}),l=q.whenTrue(this.view,"stationary",function(){return b._scaleHandle(f,a)});this._handles.add([e,g,c,h,l],d);this._constructLegendElements(f,a)}this._addActiveLayerInfo(f,a)};
d.prototype._titleHandle=function(a,b,c){b.title=a;this._constructLegendElements(b,c)};d.prototype._legendEnabledHandle=function(a,b,c){a?this._addActiveLayerInfo(b,c):this._removeActiveLayerInfo(b)};d.prototype._suspendedHandle=function(a,b,c){a?this._removeActiveLayerInfo(b):this._addActiveLayerInfo(b,c)};d.prototype._scaleHandle=function(a,b){a.scale!==this.view.scale&&a.isScaleDriven&&this._constructLegendElements(a,b)};d.prototype._addActiveLayerInfo=function(a,b){this._isLayerActive(b)&&-1===
this.activeLayerInfos.indexOf(a)&&((b=a.parent,b)?-1===b.children.indexOf(a)&&(b.children.push(a),this._sortActiveLayerInfos(b.children)):(this.activeLayerInfos.add(a),this._sortActiveLayerInfos(this.activeLayerInfos)))};d.prototype._removeActiveLayerInfo=function(a){var b=a.parent;b?(a=b.children.indexOf(a),-1!==a&&b.children.splice(a,1)):this.activeLayerInfos.remove(a)};d.prototype._constructLegendElements=function(a,b){b=b.layer;a.scale=this.view.scale;b.featureCollections?a.buildLegendElementsForFeatureCollections(b.featureCollections):
b.renderer?a.buildLegendElementsForRenderer():b.url&&a.buildLegendElementsForTools()};e([m.property({type:w})],d.prototype,"activeLayerInfos",void 0);e([m.property()],d.prototype,"basemapLegendVisible",void 0);e([m.property()],d.prototype,"groundLegendVisible",void 0);e([m.property()],d.prototype,"layerInfos",void 0);e([m.property({dependsOn:["view.ready"],readOnly:!0})],d.prototype,"state",null);e([m.property()],d.prototype,"view",void 0);return d=e([m.subclass("esri.widgets.Legend.LegendViewModel")],
d)}(m.declared(c))});