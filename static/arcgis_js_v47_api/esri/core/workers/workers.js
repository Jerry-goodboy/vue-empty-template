// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.7/esri/copyright.txt for details.
//>>built
define("require exports dojo/sniff dojo/promise/all ../Logger ../promiseUtils ./Connection ./RemoteClient ./WorkerOwner".split(" "),function(p,b,e,q,r,h,d,t,u){function k(){if(g)return g;for(var b=l+m,c=[],e=function(b){var a=u.create(b).then(function(a){return f[b]=a});c.push(a)},d=0;d<b;d++)e(d);return g=q(c).then(function(){})}Object.defineProperty(b,"__esModule",{value:!0});b.Connection=d;b.RemoteClient=t;(d=e("host-browser")?navigator.hardwareConcurrency:0)||(d=e("safari")&&e("mac")||e("trident")?
8:2);var l=e("esri-workers-debug")?1:Math.max(1,Math.ceil(d/2)),m=e("esri-workers-debug")?1:Math.max(1,Math.floor(d/2)),v=r.getLogger("esri.core.workers"),n=0,f=[];b.initialize=function(){k()};b.open=function(a,c,d){void 0===c&&(c={});if(Array.isArray(a))return new b.Connection(a.map(function(a){return new b.RemoteClient(a,c.client)}));if("string"!==typeof a){v.warn("workers-open:signature-deprecated","DEPRECATED: workers.open() changed signature.");var e=a;a=c;c={client:e,strategy:d?"dedicated":
"distributed"}}var g=c.strategy||"distributed";return"local"===g?h.create(function(c){p([a],function(a){c(b.RemoteClient.connect(a))})}).then(function(a){return new b.Connection([new b.RemoteClient(a,c.client)])}):k().then(function(){if("dedicated"===g){var d=l+n++;n%=m;return f[d].open(a).then(function(a){return new b.Connection([new b.RemoteClient(a,c.client)])})}return h.all(f.map(function(b){return b.open(a)})).then(function(a){return new b.Connection(a.map(function(a){return new b.RemoteClient(a,
c.client)}))})})};b.terminate=function(){for(var a=0;a<f.length;a++)f[a]&&f[a].terminate();f.length=0};var g});