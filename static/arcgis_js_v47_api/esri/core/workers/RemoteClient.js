// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.7/esri/copyright.txt for details.
//>>built
require({cache:{"esri/core/workers/utils":function(){define(["require","exports","dojo/has"],function(m,b,h){function g(a){return a&&"object"===typeof a&&("result"in a||"transferList"in a)}Object.defineProperty(b,"__esModule",{value:!0});(function(a){a[a.HANDSHAKE=0]="HANDSHAKE";a[a.CONFIGURE=1]="CONFIGURE";a[a.CONFIGURED=2]="CONFIGURED";a[a.OPEN=3]="OPEN";a[a.OPENED=4]="OPENED";a[a.RESPONSE=5]="RESPONSE";a[a.INVOKE=6]="INVOKE";a[a.CANCEL=7]="CANCEL";a[a.CLOSE=8]="CLOSE";a[a.OPEN_PORT=9]="OPEN_PORT"})(b.MessageType||
(b.MessageType={}));var n=0;b.newJobId=function(){return n++};b.isTranferableResult=g;b.toInvokeError=function(a){return a?a.toJSON?JSON.stringify(a):JSON.stringify({name:a.name,message:a.message,details:a.details,stack:a.stack}):null};b.postMessage=function(a,e,c,d){2===arguments.length||void 0===c&&void 0===d?a.postMessage(e):(h("esri-workers-supports-transfer-arraybuffer")||(d?(d=d.filter(function(a){return!(a instanceof ArrayBuffer)}),d.length||(d=null)):g(c)&&c.transferList&&(c.transferList=
c.transferList.filter(function(a){return!(a instanceof ArrayBuffer)}),c.transferList.length||(c.transferList=null))),d?(e.data=c,a.postMessage(e,d)):g(c)?(e.data=c.result,c.transferList?a.postMessage(e,c.transferList):a.postMessage(e)):(e.data=c,a.postMessage(e)))};b.receiveMessage=function(a){return a?(a=a.data)?"string"===typeof a?JSON.parse(a):a:null:null}})},"esri/core/workers/request":function(){define(["require","exports","dojo/_base/lang","../global"],function(m,b,h,g){Object.defineProperty(b,
"__esModule",{value:!0});var n;b.execute=function(a,e){void 0===e&&(e={});var c=e.responseType;c?"json"!==c&&"text"!==c&&"blob"!==c&&"array-buffer"!==c&&(c="text"):c="json";return g.invokeStaticMessage("request",{url:a,options:e}).then(function(d){var b=d.data,l,g,k;if(b&&("json"===c||"text"===c||"blob"===c)&&(l=new Blob([b]),"json"===c||"text"===c)&&(n||(n=new FileReaderSync),g=n.readAsText(l),"json"===c&&(k=JSON.parse(g||null),k.error)))throw h.mixin(Error(),k.error);switch(c){case "json":b=k;break;
case "text":b=g;break;case "blob":b=l}return{data:b,requestOptions:e,ssl:d.ssl,url:a}})}})},"esri/core/global":function(){define(["require","exports"],function(m,b){return function(){if("undefined"!==typeof global)return global;if("undefined"!==typeof window)return window;if("undefined"!==typeof self)return self}()})},"*noref":1}});
define("require exports dojo/Deferred ../Error ../promiseUtils ./utils".split(" "),function(m,b,h,g,n,a){function e(a,f){a["delete"](f)}var c=a.MessageType.CLOSE,d=a.MessageType.CANCEL,u=a.MessageType.INVOKE,l=a.MessageType.RESPONSE,v=a.MessageType.OPEN_PORT,k=function(){function c(a){this._timer=null;this._cancelledJobIds=new Set;this._invokeMessages=[];this._invoke=a;this._timer=null;this._process=this._process.bind(this)}c.prototype.push=function(f){f.type===a.MessageType.CANCEL?this._cancelledJobIds.add(f.jobId):
(this._invokeMessages.push(f),null===this._timer&&(this._timer=setTimeout(this._process,0)))};c.prototype.clear=function(){this._invokeMessages.length=0;this._cancelledJobIds.clear();this._timer=null};c.prototype._process=function(){this._timer=null;for(var a=0,c=this._invokeMessages;a<c.length;a++){var p=c[a];this._cancelledJobIds.has(p.jobId)||this._invoke(p)}this._cancelledJobIds.clear();this._invokeMessages.length=0};return c}();return function(){function b(a,c,b){this._outJobs=new Map;this._inJobs=
new Map;this._queue=new k(this._onInvoke.bind(this));this._onMessage=this._onMessage.bind(this);this._client=c;this._port=a;this._port.addEventListener("message",this._onMessage);this._port.start();this._channel=b}b.connect=function(a){var c=new MessageChannel;a="function"===typeof a?new a:"default"in a&&"function"===typeof a.default?new a.default:a;a.remoteClient=new b(c.port1,a,c);return c.port2};b.prototype.close=function(){this._post({type:c});this._close()};b.prototype.isBusy=function(){return 0<
this._outJobs.size};b.prototype.invoke=function(c,b,p){var f=this,r=a.newJobId(),g=new h(function(){e(f._outJobs,r);f._post({type:d,jobId:r})});this._outJobs.set(r,g);this._post({type:u,jobId:r,methodName:c},b,p);return g.promise};b.prototype.openPort=function(){var c=this,b=a.newJobId(),p=new h(function(){e(c._outJobs,b);c._post({type:d,jobId:b})});this._outJobs.set(b,p);this._post({type:v,jobId:b});return p.promise};b.prototype._close=function(){this._channel&&(this._channel=null);this._port.removeEventListener("message",
this._onMessage);this._port.close();this._outJobs.forEach(function(a){a.cancel()});this._inJobs.clear();this._outJobs.clear();this._queue.clear();this._port=this._client=null};b.prototype._onMessage=function(b){if(b=a.receiveMessage(b))switch(b.type){case l:this._onResponse(b);break;case u:this._queue.push(b);break;case d:this._onCancel(b);break;case c:this._close();break;case v:this._onOpenPort(b)}};b.prototype._onCancel=function(a){var b=this._inJobs,c=a.jobId,f=b.get(c);this._queue.push(a);f&&
(e(b,c),f.cancel())};b.prototype._onInvoke=function(b){var c=this,f=b.methodName,d=b.jobId;b=b.data;var g=this._inJobs,h=this._client,k=h[f],q;try{if(!k&&f&&-1!==f.indexOf("."))for(var m=f.split("."),t=0;t<m.length-1;t++)h=h[m[t]],k=h[m[t+1]];if("function"!==typeof k)throw new TypeError(f+" is not a function");q=k.call(h,b,this)}catch(w){this._post({type:l,jobId:d,error:a.toInvokeError(w)});return}n.isThenable(q)?(g.set(d,q),q.then(function(a){g.has(d)&&(e(g,d),c._post({type:l,jobId:d},a))}).catch(function(b){g.has(d)&&
(e(g,d),b&&"cancel"===b.dojoType||c._post({type:l,jobId:d,error:a.toInvokeError(b||{message:"Error encountered at method "+f})}))})):this._post({type:l,jobId:d},q)};b.prototype._onOpenPort=function(a){var c=new MessageChannel;new b(c.port1,this._client);this._post({type:l,jobId:a.jobId},c.port2,[c.port2])};b.prototype._onResponse=function(a){var b=a.jobId,c=a.error;a=a.data;var d=this._outJobs;if(d.has(b)){var f=d.get(b);e(d,b);c?f.reject(g.fromJSON(JSON.parse(c))):f.resolve(a)}};b.prototype._post=
function(b,c,d){return a.postMessage(this._port,b,c,d)};return b}()});