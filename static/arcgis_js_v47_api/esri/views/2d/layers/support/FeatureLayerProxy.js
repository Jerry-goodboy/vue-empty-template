// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.7/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../../../../geometry ../../../../core/Accessor ../../../../core/Promise ../../../../core/promiseUtils ../../../../core/requireUtils ../../../../core/workers ../../../../core/accessorSupport/decorators ../../../../tasks/support/FeatureSet ./util module".split(" "),function(h,c,k,e,f,l,m,n,p,q,r,d,t,g,u){Object.defineProperty(c,"__esModule",{value:!0});
f=function(c){function b(a){return c.call(this,a)||this}k(b,c);b.prototype.initialize=function(){var a=this;this.addResolvingPromise(r.open(q.getAbsMid("../features/Pipeline",h,u),{client:this.client,strategy:"dedicated"}).then(function(b){a._connection=b;return a._getStartupOptions(a.layer,a.tileInfo)}).then(function(b){return Array.isArray(b.service.source)?a._connection.invoke("startup",b,b.service.source):a._connection.invoke("startup",b)}))};b.prototype.destroy=function(){this._connection&&this._connection.close()};
b.prototype.configure=function(a){return this._connection.invoke("configure",a)};b.prototype.registerTile=function(a){return this._connection.invoke("registerTile",a.id)};b.prototype.unregisterTile=function(a){return this._connection.invoke("unregisterTile",a.id)};b.prototype.setViewState=function(a){return this._connection.invoke("controller.setViewState",a.toJSON())};b.prototype.queryFeatures=function(a){return this._connection.invoke("controller.queryFeatures",a.toJSON()).then(function(a){return t.fromJSON(a)}).then(function(a){return a&&
a.features})};b.prototype.queryObjectIds=function(a){return this._connection.invoke("controller.queryObjectIds",a.toJSON())};b.prototype.queryFeatureCount=function(a){return this._connection.invoke("controller.queryFeatureCount",a.toJSON())};b.prototype.queryExtent=function(a){return this._connection.invoke("controller.queryExtent",a.toJSON()).then(function(a){return{count:a.count,extent:l.Extent.fromJSON(a.extent)}})};b.prototype._getStartupOptions=function(a,b){var c=a.source;return c&&"esri.layers.graphics.sources.CSVSource"===
c.declaredClass?c.openPorts().then(function(c){return{service:{capabilities:a.capabilities,fields:a.fields.map(function(a){return a.toJSON()}),fullExtent:a.fullExtent.toJSON(),geometryType:g.toJSONGeometryType(a.geometryType),objectIdField:a.objectIdField,source:c},tileInfo:b.toJSON()}}):p.resolve({service:{capabilities:a.capabilities,fields:a.fields.map(function(a){return a.toJSON()}),fullExtent:a.fullExtent.toJSON(),geometryType:g.toJSONGeometryType(a.geometryType),objectIdField:a.objectIdField,
source:a.url+"/"+a.layerId},tileInfo:b.toJSON()})};e([d.property({constructOnly:!0})],b.prototype,"client",void 0);e([d.property({constructOnly:!0})],b.prototype,"layer",void 0);e([d.property({constructOnly:!0})],b.prototype,"tileInfo",void 0);return b=e([d.subclass()],b)}(d.declared(m,n));c.default=f});