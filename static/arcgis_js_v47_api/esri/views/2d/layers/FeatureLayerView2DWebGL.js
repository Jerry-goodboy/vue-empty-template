// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.7/esri/copyright.txt for details.
//>>built
require({cache:{"esri/core/throttle":function(){define(["require","exports"],function(l,e){function c(a,b,c,f){var d=null,k=1E3;"number"===typeof b?(k=b,f=c):(d=b,k=c);var h=0,m,g=function(){h=0;a.apply(f,m)};b=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];d&&d.apply(f,a);m=a;k?h||(h=setTimeout(g,k)):g()};b.remove=function(){h&&(clearTimeout(h),h=0)};b.forceUpdate=function(){h&&(clearTimeout(h),g())};b.hasPendingUpdates=function(){return!!h};return b}Object.defineProperty(e,
"__esModule",{value:!0});e.throttle=c;e.default=c})},"esri/views/2d/engine/webgl/WGLFeatureView":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/extendsHelper ../../../../core/promiseUtils ../../../../core/promiseUtils ../../../../core/libs/gl-matrix/mat4 ../../../../core/libs/gl-matrix/vec3 ../../../../geometry/Point ../../../../renderers/support/diffUtils ../Container ../StageGL ../../engine/webgl/TileData ./enums ./GeometryUtils ./rendererInfoUtils ./rendererInfoUtils ./TextureManager ./Utils ./visualVariablesUtils ./WGLPainter ./WGLRendererInfo ./WGLTile ./passes/WGLPaintPassHeatmap".split(" "),
function(l,e,c,a,b,g,f,d,k,h,m,n,p,q,t,r,v,u,y,w,A,I,E,z){function B(a){for(var b in a.diff){var d=a.diff[b];if("collection"===d.type){if(0!==d.changed.length||0!==d.added.length||0!==d.removed.length)return!0}else if("visualVariables"!==b&&"authoringInfo"!==b)return!0}return!1}return function(m){function e(a){var b=m.call(this)||this;b._container=new n;b._displayWidth=0;b._displayHeight=0;b._pointToCallbacks=new Map;b._highlightIDs=new Set;b._highlightOptionsUpToDate=!1;b.textureManager=new u;b._domContainer=
null;b._parentLayerView=a;b._tileCoordinateScale=d.create();b._orientationVec=d.create();b._displayScale=d.create();b._orientationVec.set([0,0,1]);b._defaultTransform=f.create();b._tileInfoView=a.tileInfoView;b.wglRendererInfo=new I(b);b.highlightOptions=a.view.highlightOptions;b._container.useContextVersion(a.view?a.view.renderContext:null);return b}a(e,m);Object.defineProperty(e.prototype,"highlightOptions",{get:function(){return this._highlightOptions},set:function(a){this._highlightOptions=a;
this._highlightOptionsUpToDate=!1},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"displayWidth",{get:function(){return this._displayWidth},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"displayHeight",{get:function(){return this._displayHeight},enumerable:!0,configurable:!0});e.prototype.initialize=function(a){this._tileInfoView=a;this.wglRendererInfo=new I(this);a=new A.WGLPainterOptions;this.wglRendererInfo.heatmapParameters&&a.registerPass(z.default,A.default.allGeometryPhases());
this._painterOptions=a};e.prototype.updateHeatmapParameters=function(a){this.wglRendererInfo.updateHeatmapParameters(a);this.requestRender()};e.prototype.hitTest=function(a,d){var c=this,h=[a,d];return b.create(function(a,b){c._pointToCallbacks.set(h,{resolve:a,reject:b});c.requestRender()},function(){c._pointToCallbacks.has(h)&&c._pointToCallbacks.delete(h)})};e.prototype.setHighlight=function(a){this._highlightIDs.clear();this.addHighlight(a)};e.prototype.setVisibility=function(a){for(var b=0,d=
this.children;b<d.length;b++)d[b].setVisibility(a)};e.prototype.addHighlight=function(a){for(var b=0;b<a.length;b++)this._highlightIDs.add(a[b]);this._buildHLList()};e.prototype.removeHighlight=function(a){for(var b=0;b<a.length;b++)this._highlightIDs.delete(a[b]);this._buildHLList()};e.prototype.addChild=function(a){a=m.prototype.addChild.call(this,a);this._buildHLList();return a};e.prototype.removeChild=function(a){a=m.prototype.removeChild.call(this,a);this._buildHLList();return a};e.prototype.prepareChildrenRenderParameters=
function(a){this.wglRendererInfo.updateVisualVariables(this._visualVariablesInfo.vvRanges,a.state);var b=this._tileInfoView.getClosestInfoForScale(a.state.scale).level;return c({},a,{rendererInfo:this.wglRendererInfo,requiredLevel:b,drawPhase:q.WGLDrawPhase.NONE})};e.prototype.renderChildren=function(a){var b=this,d=a.painter;d.bindTextureManager(this.textureManager);this.wglRendererInfo.updateVisualVariables(this._visualVariablesInfo.vvRanges,a.state);this.sortChildren(function(a,b){return a.key.level-
b.key.level});d.draw(a,this.children,A.default.allGeometryPhases(),this._painterOptions);0<this._highlightIDs.size&&d.highlight(a,this.children);0!==this._pointToCallbacks.size&&(this._pointToCallbacks.forEach(function(d,c){d.resolve(b._hitTest(a,c[0],c[1]))}),this._pointToCallbacks.clear())};e.prototype.attachChild=function(a,b){return a.attach(b)};e.prototype.detachChild=function(a,b){a.detach(b)};e.prototype.renderChild=function(a,b){a.doRender(b)};e.prototype.beforeRenderChildren=function(a,b){this._updateTilesTransform(a.state,
this._tileInfoView.getClosestInfoForScale(a.state.scale).level);this._updateHighlightOptions();this._container.opacity=this._domContainer.opacity};e.prototype._hitTest=function(a,b,d){var c=a.painter,h=this._tileInfoView.getClosestInfoForScale(a.state.scale).level,f=[0,0];a.state.toMap(f,[b,d]);b=a.state.clone();d=b.viewpoint.clone();d.targetGeometry=new k(f[0],f[1],a.state.spatialReference);b.viewpoint=d;b.size=[y.C_HITTEST_SEARCH_SIZE,y.C_HITTEST_SEARCH_SIZE];this._updateTilesTransform(b,h);c.update(b,
a.pixelRatio);return c.hitTest({context:a.context,painter:c,drawPhase:q.WGLDrawPhase.HITTEST,state:b,pixelRatio:a.pixelRatio,stationary:a.stationary,rendererInfo:this.wglRendererInfo,requiredLevel:h},this.children)};e.prototype._updateTilesTransform=function(a,b){var d=1/a.width,c=1/a.height,h=[0,0];this._calculateRelativeViewProjMat(this._tileInfoView.tileInfo.lods[b].resolution,a.resolution,a.rotation,this._tileInfoView.tileInfo.size[0],a.width,a.height,this._defaultTransform);for(var k=0,f=this.children;k<
f.length;k++){var m=f[k];a.toScreen(h,m.coords);h[1]=a.height-h[1];m.tileTransform.displayCoord[0]=2*h[0]*d-1;m.tileTransform.displayCoord[1]=2*h[1]*c-1;m.key.level===b?m.tileTransform.transform.set(this._defaultTransform):this._calculateRelativeViewProjMat(this._tileInfoView.tileInfo.lods[m.key.level].resolution,a.resolution,a.rotation,this._tileInfoView.tileInfo.size[0],a.width,a.height,m.tileTransform.transform)}};e.prototype._calculateRelativeViewProjMat=function(a,b,d,c,h,k,m){a/=b;this._tileCoordinateScale.set([a,
a,1]);if(h!==this._displayWidth||k!==this._displayHeight)this._displayScale.set([2/h,-2/k,1]),this._displayWidth=h,this._displayHeight=k;f.identity(m);f.scale(m,m,this._tileCoordinateScale);f.rotate(m,m,-d*t.C_DEG_TO_RAD,this._orientationVec);f.scale(m,m,this._displayScale);f.transpose(m,m)};e.prototype._updateHighlightOptions=function(){!this._highlightOptionsUpToDate&&this._setHighlightOptions(this._highlightOptions)&&(this._highlightOptionsUpToDate=!0)};e.prototype._setHighlightOptions=function(a){if(!this.parent)return!1;
var b=this.parent.glPainter;if(!b)return!1;var d=a.color.toRgba();d[0]/=255;d[1]/=255;d[2]/=255;var c=d.slice();d[3]*=a.fillOpacity;c[3]*=a.haloOpacity;b.setHighlightOptions({fillColor:d,outlineColor:c,outlineWidth:2,outerHaloWidth:.3,innerHaloWidth:.3,outlinePosition:0});return!0};e.prototype._buildHLList=function(){for(var a=0,b=this.children;a<b.length;a++)b[a].buildHLList(this._highlightIDs);this.requestRender()};e.prototype.highlight=function(a){var b=this;b.addHighlight(a);return{remove:function(){b.removeHighlight(a)}}};
e.prototype.install=function(a){a.addChild(this._container);this._container.addChild(this);this._domContainer=a};e.prototype.uninstall=function(a){a.removeChild(this._container);this._container.removeChild(this);this._domContainer=null};e.prototype.getMaterialItems=function(a){if(a&&0!==a.length){for(var b=[],d=0;d<a.length;d++){var c=a[d];b.push(this.textureManager.rasterizeItem(c.symbol,c.glyphIds))}return g.all(b).then(function(a){return a.map(function(a,b){return{id:b,mosaicItem:a}})})}};e.prototype.getProcessorConfiguration=
function(){return{type:"symbol",renderer:this._parentLayerView.layer.renderer.toJSON(),devicePixelRatio:window.devicePixelRatio||1,definitionExpression:this._parentLayerView.layer.definitionExpression,outFields:this._parentLayerView.layer.outFields,gdbVersion:this._parentLayerView.layer.gdbVersion,historicMoment:this._parentLayerView.layer.historicMoment&&this._parentLayerView.layer.historicMoment.getTime()}};e.prototype.acquireTile=function(a){var b=this,d=[0,0,0,0];this._tileInfoView.getTileBounds(d,
a);a=new E(a,d);a.once("attach",function(){b._parentLayerView.requestUpdate()});return a};e.prototype.releaseTile=function(a){this.removeChild(a);a.once("detach",function(){a.dispose()})};e.prototype.setTileVisuals=function(a,b,d){var c=null;b&&!d&&(c=p.deserialize(b));a.setData(c,null!=this._parentLayerView.layer.renderer.visualVariables,d);a.buildHLList(this._highlightIDs);this.addChild(a);this.requestRender()};e.prototype.patchTileVisuals=function(a,b){var d=b.addOrUpdate?p.deserialize(b.addOrUpdate):
null;a.patchData({remove:b.remove||[],addOrUpdate:d});a.buildHLList(this._highlightIDs);this.requestRender()};e.prototype.renderInit=function(){this._renderer=this._parentLayerView.layer.renderer;this._renderer.requiredFields&&this._renderer.requiredFields.sort();var a=this._parentLayerView.layer,a=r.getNormalizedRenderer(a.renderer,a.spatialReference,{fields:a.fields.map(function(a){return a.toJSON()})});this._visualVariablesInfo=w.convertVisualVariables(a.visualVariables);this.requestRender()};
e.prototype.renderSwitchFrom=function(a){a=this._parentLayerView.layer.renderer;a.requiredFields&&a.requiredFields.sort();var b=h.diff(this._renderer,a);if(b){if("complete"===b.type)return this.renderInit(),!0;if("partial"===b.type){if(B(b))return this.renderInit(),!0;if(b.diff.visualVariables){var b=this._parentLayerView.layer,b=r.getNormalizedRenderer(a,b.spatialReference,{fields:b.fields.map(function(a){return a.toJSON()})}),b=w.convertVisualVariables(b.visualVariables),d=b.vvRanges;if(h.diff(this._visualVariablesInfo.vvFields,
b.vvFields))return this.renderInit(),!0;this._visualVariablesInfo.vvRanges=d;this._renderer=a;this.requestRender();return!1}}}else return!1};e.prototype.supports=function(a){return v.isRendererWebGLCompatible(a)};return e}(m)})},"esri/core/libs/gl-matrix/vec3":function(){define(["./common"],function(l){var e={create:function(){var c=new l.ARRAY_TYPE(3);c[0]=0;c[1]=0;c[2]=0;return c},clone:function(c){var a=new l.ARRAY_TYPE(3);a[0]=c[0];a[1]=c[1];a[2]=c[2];return a},fromValues:function(c,a,b){var g=
new l.ARRAY_TYPE(3);g[0]=c;g[1]=a;g[2]=b;return g},copy:function(c,a){c[0]=a[0];c[1]=a[1];c[2]=a[2];return c},set:function(c,a,b,g){c[0]=a;c[1]=b;c[2]=g;return c},add:function(c,a,b){c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];return c},subtract:function(c,a,b){c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];return c}};e.sub=e.subtract;e.multiply=function(c,a,b){c[0]=a[0]*b[0];c[1]=a[1]*b[1];c[2]=a[2]*b[2];return c};e.mul=e.multiply;e.divide=function(c,a,b){c[0]=a[0]/b[0];c[1]=a[1]/b[1];c[2]=a[2]/b[2];
return c};e.div=e.divide;e.ceil=function(c,a){c[0]=Math.ceil(a[0]);c[1]=Math.ceil(a[1]);c[2]=Math.ceil(a[2]);return c};e.floor=function(c,a){c[0]=Math.floor(a[0]);c[1]=Math.floor(a[1]);c[2]=Math.floor(a[2]);return c};e.min=function(c,a,b){c[0]=Math.min(a[0],b[0]);c[1]=Math.min(a[1],b[1]);c[2]=Math.min(a[2],b[2]);return c};e.max=function(c,a,b){c[0]=Math.max(a[0],b[0]);c[1]=Math.max(a[1],b[1]);c[2]=Math.max(a[2],b[2]);return c};e.round=function(c,a){c[0]=Math.round(a[0]);c[1]=Math.round(a[1]);c[2]=
Math.round(a[2]);return c};e.scale=function(c,a,b){c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;return c};e.scaleAndAdd=function(c,a,b,g){c[0]=a[0]+b[0]*g;c[1]=a[1]+b[1]*g;c[2]=a[2]+b[2]*g;return c};e.distance=function(c,a){var b=a[0]-c[0],g=a[1]-c[1];c=a[2]-c[2];return Math.sqrt(b*b+g*g+c*c)};e.dist=e.distance;e.squaredDistance=function(c,a){var b=a[0]-c[0],g=a[1]-c[1];c=a[2]-c[2];return b*b+g*g+c*c};e.sqrDist=e.squaredDistance;e.length=function(c){var a=c[0],b=c[1];c=c[2];return Math.sqrt(a*a+b*b+c*c)};
e.len=e.length;e.squaredLength=function(c){var a=c[0],b=c[1];c=c[2];return a*a+b*b+c*c};e.sqrLen=e.squaredLength;e.negate=function(c,a){c[0]=-a[0];c[1]=-a[1];c[2]=-a[2];return c};e.inverse=function(c,a){c[0]=1/a[0];c[1]=1/a[1];c[2]=1/a[2];return c};e.normalize=function(c,a){var b=a[0],g=a[1],f=a[2],b=b*b+g*g+f*f;0<b&&(b=1/Math.sqrt(b),c[0]=a[0]*b,c[1]=a[1]*b,c[2]=a[2]*b);return c};e.dot=function(c,a){return c[0]*a[0]+c[1]*a[1]+c[2]*a[2]};e.cross=function(c,a,b){var g=a[0],f=a[1];a=a[2];var d=b[0],
k=b[1];b=b[2];c[0]=f*b-a*k;c[1]=a*d-g*b;c[2]=g*k-f*d;return c};e.lerp=function(c,a,b,g){var f=a[0],d=a[1];a=a[2];c[0]=f+g*(b[0]-f);c[1]=d+g*(b[1]-d);c[2]=a+g*(b[2]-a);return c};e.hermite=function(c,a,b,g,f,d){var k=d*d,h=k*(2*d-3)+1,m=k*(d-2)+d,n=k*(d-1);d=k*(3-2*d);c[0]=a[0]*h+b[0]*m+g[0]*n+f[0]*d;c[1]=a[1]*h+b[1]*m+g[1]*n+f[1]*d;c[2]=a[2]*h+b[2]*m+g[2]*n+f[2]*d;return c};e.bezier=function(c,a,b,g,f,d){var k=1-d,h=k*k,m=d*d,n=h*k,h=3*d*h,k=3*m*k;d*=m;c[0]=a[0]*n+b[0]*h+g[0]*k+f[0]*d;c[1]=a[1]*n+
b[1]*h+g[1]*k+f[1]*d;c[2]=a[2]*n+b[2]*h+g[2]*k+f[2]*d;return c};e.random=function(c,a){a=a||1;var b=2*l.RANDOM()*Math.PI,g=2*l.RANDOM()-1,f=Math.sqrt(1-g*g)*a;c[0]=Math.cos(b)*f;c[1]=Math.sin(b)*f;c[2]=g*a;return c};e.transformMat4=function(c,a,b){var g=a[0],f=a[1];a=a[2];var d=b[3]*g+b[7]*f+b[11]*a+b[15],d=d||1;c[0]=(b[0]*g+b[4]*f+b[8]*a+b[12])/d;c[1]=(b[1]*g+b[5]*f+b[9]*a+b[13])/d;c[2]=(b[2]*g+b[6]*f+b[10]*a+b[14])/d;return c};e.transformMat3=function(c,a,b){var g=a[0],f=a[1];a=a[2];c[0]=g*b[0]+
f*b[3]+a*b[6];c[1]=g*b[1]+f*b[4]+a*b[7];c[2]=g*b[2]+f*b[5]+a*b[8];return c};e.transformQuat=function(c,a,b){var g=a[0],f=a[1],d=a[2];a=b[0];var k=b[1],h=b[2];b=b[3];var m=b*g+k*d-h*f,n=b*f+h*g-a*d,p=b*d+a*f-k*g,g=-a*g-k*f-h*d;c[0]=m*b+g*-a+n*-h-p*-k;c[1]=n*b+g*-k+p*-a-m*-h;c[2]=p*b+g*-h+m*-k-n*-a;return c};e.rotateX=function(c,a,b,g){var f=[],d=[];f[0]=a[0]-b[0];f[1]=a[1]-b[1];f[2]=a[2]-b[2];d[0]=f[0];d[1]=f[1]*Math.cos(g)-f[2]*Math.sin(g);d[2]=f[1]*Math.sin(g)+f[2]*Math.cos(g);c[0]=d[0]+b[0];c[1]=
d[1]+b[1];c[2]=d[2]+b[2];return c};e.rotateY=function(c,a,b,g){var f=[],d=[];f[0]=a[0]-b[0];f[1]=a[1]-b[1];f[2]=a[2]-b[2];d[0]=f[2]*Math.sin(g)+f[0]*Math.cos(g);d[1]=f[1];d[2]=f[2]*Math.cos(g)-f[0]*Math.sin(g);c[0]=d[0]+b[0];c[1]=d[1]+b[1];c[2]=d[2]+b[2];return c};e.rotateZ=function(c,a,b,g){var f=[],d=[];f[0]=a[0]-b[0];f[1]=a[1]-b[1];f[2]=a[2]-b[2];d[0]=f[0]*Math.cos(g)-f[1]*Math.sin(g);d[1]=f[0]*Math.sin(g)+f[1]*Math.cos(g);d[2]=f[2];c[0]=d[0]+b[0];c[1]=d[1]+b[1];c[2]=d[2]+b[2];return c};e.forEach=
function(){var c=e.create();return function(a,b,g,f,d,k){b||(b=3);g||(g=0);for(f=f?Math.min(f*b+g,a.length):a.length;g<f;g+=b)c[0]=a[g],c[1]=a[g+1],c[2]=a[g+2],d(c,c,k),a[g]=c[0],a[g+1]=c[1],a[g+2]=c[2];return a}}();e.angle=function(c,a){c=e.fromValues(c[0],c[1],c[2]);a=e.fromValues(a[0],a[1],a[2]);e.normalize(c,c);e.normalize(a,a);a=e.dot(c,a);return 1<a?0:Math.acos(a)};e.str=function(c){return"vec3("+c[0]+", "+c[1]+", "+c[2]+")"};e.exactEquals=function(c,a){return c[0]===a[0]&&c[1]===a[1]&&c[2]===
a[2]};e.equals=function(c,a){var b=c[0],g=c[1];c=c[2];var f=a[0],d=a[1];a=a[2];return Math.abs(b-f)<=l.EPSILON*Math.max(1,Math.abs(b),Math.abs(f))&&Math.abs(g-d)<=l.EPSILON*Math.max(1,Math.abs(g),Math.abs(d))&&Math.abs(c-a)<=l.EPSILON*Math.max(1,Math.abs(c),Math.abs(a))};return e})},"esri/views/2d/engine/webgl/TileData":function(){define("require exports ./MemoryRequirements ./TileBufferData ./TileDisplayData ./Utils ./WGLDisplayList ./WGLDisplayRecord ./util/Reader ./util/Writer".split(" "),function(l,
e,c,a,b,g,f,d,k,h){var m=new g.ValuesGetter,n=new c.default,p=new c.default;return function(){function c(){this.tileBufferData=this.tileDisplayData=null}c.prototype.reshuffle=function(){n.reset();var b=this._collectDisplayRecords(),d;for(d in b)for(var h=b[d],k=0,m=h;k<m.length;k++){var g=m[k];n.needMore(g.geometryType,g.meshData?g.meshData.vertexCount:g.vertexCount,g.meshData?g.meshData.indexData.length:g.indexCount)}k=b.length;m=new a;for(d=0;d<k;++d){m.geometries[d].indexBuffer=new Uint32Array(Math.round(1.15*
n.indicesFor(d)));var g=[],q;for(q in this.tileBufferData.geometries[d].vertexBuffer)g.push(this.tileBufferData.geometries[d].vertexBuffer[q].stride);var g=c._computeVertexAlignment(g),h=Math.round(1.15*n.verticesFor(d)),g=c._align(h,g),e;for(e in this.tileBufferData.geometries[d].vertexBuffer)h=this.tileBufferData.geometries[d].vertexBuffer[e].stride,m.geometries[d].vertexBuffer[e]={stride:h,data:new Uint32Array(Math.round(g*h/4))}}p.reset();this.tileDisplayData.displayList=new f;for(d=0;d<k;++d){h=
b[d];q=0;for(e=h;q<e.length;q++)g=e[q],g.meshData||g.readMeshDataFromBuffers(this.tileBufferData.geometries[d].vertexBuffer,this.tileBufferData.geometries[d].indexBuffer),g.writeMeshDataToBuffers(p.verticesFor(d),m.geometries[d].vertexBuffer,p.indicesFor(d),m.geometries[d].indexBuffer),g.meshData=null,p.needMore(d,g.vertexCount,g.indexCount);this.tileDisplayData.displayList.addToList(h)}this.tileBufferData=m};c.prototype.getStrides=function(){for(var a=[],b=0;b<this.tileBufferData.geometries.length;++b){var d=
this.tileBufferData.geometries[b];a[b]={};for(var c in d.vertexBuffer)a[b][c]=d.vertexBuffer[c].stride}return a};c.prototype._guessSize=function(){for(var a=this.tileDisplayData.displayObjects,b=Math.min(a.length,4),d=0,c=0;c<b;c++)d=Math.max(d,a[c].displayRecords.length);return 2*(12*a.length+a.length*d*40)};c.prototype.serialize=function(){var a=this.tileBufferData.serialize(),b=this.tileBufferData.getBuffers(),d=this.tileDisplayData.serialize(new h.default(this._guessSize())).buffer();b.push(d);
return{result:{displayData:d,bufferData:a},transferList:b}};c.deserialize=function(d){var h=b.deserialize(new k.default(d.displayData));d=a.deserialize(d.bufferData);var f=new c;f.tileDisplayData=h;f.tileBufferData=d;return f};c.bind=function(a,b){var d=new c;d.tileDisplayData=a;d.tileBufferData=b;return d};c.create=function(h,k){var f=new c;f.tileDisplayData=new b;f.tileDisplayData.displayObjects=h;for(var m=[0,0,0,0],g=[0,0,0,0],p=[[],[],[],[]],n=0;n<h.length;n++)for(var q=0,t=h[n].displayRecords;q<
t.length;q++){var e=t[q];p[e.geometryType].push(e);m[e.geometryType]+=e.meshData.vertexCount;g[e.geometryType]+=e.meshData.indexData.length}h=new a;k=[k.fill||{},k.line||{},k.icon||{},k.text||{}];for(n=0;4>n;n++){var q=new Uint32Array(g[n]),t=k[n],e=m[n],r={},l=void 0;for(l in t){var F={data:new Uint32Array(e*t[l]/4),stride:t[l]};r[l]=F}t=r;d.writeAllMeshDataToBuffers(p[n],t,q);h.geometries[n]={indexBuffer:q,vertexBuffer:t}}f.tileBufferData=h;return f};c._align=function(a,b){var d=a%b;return 0===
d?a:a+(b-d)};c._computeVertexAlignment=function(a){for(var b=!1,d=!1,c=0;c<a.length;c++){var h=a[c];2===h%4?b=!0:0!==h%4&&(d=!0)}return d?4:b?2:1};c.prototype._collectDisplayRecords=function(){for(var a=[[],[],[],[]],b=0,d=m.getValues(this.tileDisplayData.displayObjectRegistry);b<d.length;b++)for(var c=0,h=d[b].displayRecords;c<h.length;c++){var k=h[c];a[k.geometryType].push(k)}return a};return c}()})},"esri/views/2d/engine/webgl/MemoryRequirements":function(){define(["require","exports"],function(l,
e){Object.defineProperty(e,"__esModule",{value:!0});l=function(){function c(){this._byGeometryType=null}Object.defineProperty(c.prototype,"satisfied",{get:function(){return!this._byGeometryType},enumerable:!0,configurable:!0});c.prototype.reset=function(){this._byGeometryType=null};c.prototype.verticesFor=function(a){return this._byGeometryType?this._byGeometryType[a].vertices:0};c.prototype.indicesFor=function(a){return this._byGeometryType?this._byGeometryType[a].indices:0};c.prototype.needMore=
function(a,b,c){if(b||c)this._byGeometryType||(this._byGeometryType=[{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0}]),a=this._byGeometryType[a],a.vertices+=b,a.indices+=c};return c}();e.default=l})},"esri/views/2d/engine/webgl/TileBufferData":function(){define(["require","exports"],function(l,e){return function(){function c(){this.geometries=[{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},
{indexBuffer:void 0,vertexBuffer:{}}]}c.deserialize=function(a){for(var b=new c,g=0;4>g;++g){b.geometries[g].indexBuffer=new Uint32Array(a.geometries[g].indexBuffer);b.geometries[g].vertexBuffer={};for(var f in a.geometries[g].vertexBuffer)b.geometries[g].vertexBuffer[f]={data:new Uint32Array(a.geometries[g].vertexBuffer[f].data),stride:a.geometries[g].vertexBuffer[f].stride}}return b};c.prototype.serialize=function(){for(var a={geometries:[{indexBuffer:this.geometries[0].indexBuffer.buffer,vertexBuffer:{}},
{indexBuffer:this.geometries[1].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[2].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[3].indexBuffer.buffer,vertexBuffer:{}}]},b=0;4>b;++b)for(var c in this.geometries[b].vertexBuffer)a.geometries[b].vertexBuffer[c]={data:this.geometries[b].vertexBuffer[c].data.buffer,stride:this.geometries[b].vertexBuffer[c].stride};return a};c.prototype.getBuffers=function(){for(var a=[],b=0;4>b;++b){a.push(this.geometries[b].indexBuffer.buffer);
for(var c in this.geometries[b].vertexBuffer)a.push(this.geometries[b].vertexBuffer[c].data.buffer)}return a};return c}()})},"esri/views/2d/engine/webgl/TileDisplayData":function(){define(["require","exports","./WGLDisplayList","./WGLDisplayObject","./util/serializationUtils"],function(l,e,c,a,b){return function(){function g(){}Object.defineProperty(g.prototype,"displayObjectRegistry",{get:function(){if(!this._displayObjectRegistry){this._displayObjectRegistry=new Map;for(var a=0,b=this.displayObjects;a<
b.length;a++){var c=b[a];this._displayObjectRegistry.set(c.id,c)}}return this._displayObjectRegistry},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"displayList",{get:function(){if(!this._displayList){this._displayList=new c;for(var a=0,b=this.displayObjects;a<b.length;a++)for(var k=0,h=b[a].displayRecords;k<h.length;k++)this._displayList.addToList(h[k])}return this._displayList},set:function(a){this._displayList=a},enumerable:!0,configurable:!0});g.prototype.serialize=function(a){b.serializeList(a,
this.displayObjects);return a};g.prototype._deserializeObjects=function(b){for(var d=b.readInt32(),d=Array(d),k=new c,h=new Map,f=0;f<d.length;++f){var g=a.deserialize(b);d[f]=g;h.set(g.id,g);for(var p=0,g=g.displayRecords;p<g.length;p++)k.addToList(g[p])}this.displayObjects=d;this._displayList=k;this._displayObjectRegistry=h};g.deserialize=function(a){var b=new g;b._deserializeObjects(a);return b};return g}()})},"esri/views/2d/engine/webgl/WGLDisplayList":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/Logger ./enums ./MaterialInfo ./Utils ./util/serializationUtils".split(" "),
function(l,e,c,a,b,g,f,d){var k=a.getLogger("esri.views.2d.engine.webgl.WGLDisplayList");l=function(){function a(){this.symbolLevels=[]}Object.defineProperty(a.prototype,"empty",{get:function(){return!this.symbolLevels||0===this.symbolLevels.length},enumerable:!0,configurable:!0});a.prototype.addToList=function(a){var b=this;Array.isArray(a)?a.forEach(function(a){b._addToList(a)}):this._addToList(a)};a.prototype.removeFromList=function(a){var b=this;Array.isArray(a)||(a=[a]);a.forEach(function(a){b._removeFromList(a)})};
a.prototype.ofType=function(a){var b,d,h,k,f,m,g,p,n,q,t;return c(this,function(c){switch(c.label){case 0:b=0,d=this.symbolLevels,c.label=1;case 1:if(!(b<d.length))return[3,8];h=d[b];k=0;f=h.zLevels;c.label=2;case 2:if(!(k<f.length))return[3,7];m=f[k];g=m.geometryDPInfo;p=this._getDPInfoType(a);if(!g[p])return[3,6];n=0;q=g[p];c.label=3;case 3:if(!(n<q.length))return[3,6];t=q[n];return[4,t];case 4:c.sent(),c.label=5;case 5:return n++,[3,3];case 6:return k++,[3,2];case 7:return b++,[3,1];case 8:return[2]}})};
a.prototype._addToList=function(a){var b=this._getDisplayList(a.symbolLevel,a.zOrder,a.geometryType),d=0<b.length?b[b.length-1]:null;null!==d&&f.isSameMaterialInfo(d.materialInfo,a.materialInfo)&&d.indexFrom+d.indexCount===a.indexFrom?d.indexCount+=a.indexCount:(d=new h,d.indexFrom=a.indexFrom,d.indexCount=a.indexCount,d.materialInfo=a.materialInfo,d.geometryType=a.geometryType,b.push(d))};a.prototype._removeFromList=function(a){for(var b=this._getDisplayList(a.symbolLevel,a.zOrder,a.geometryType),
d=b.length,c=void 0,k=0;k<d;++k){var f=b[k];a.indexFrom+a.indexCount>f.indexFrom&&a.indexFrom<f.indexFrom+f.indexCount&&(c=k)}if(void 0!==c)if(f=b[c],a.indexFrom<f.indexFrom)f.indexCount-=a.indexCount,f.indexFrom+=a.indexCount;else if(a.indexFrom+a.indexCount>f.indexFrom+f.indexCount)f.indexCount-=a.indexCount;else{var d=f.indexFrom,k=a.indexFrom-f.indexFrom,m=a.indexCount;a=f.indexFrom+f.indexCount-(a.indexFrom+a.indexCount);f.indexCount=k;var p=new h;p.geometryType=f.geometryType;p.materialInfo=
new g.default;p.materialInfo.copy(f.materialInfo);p.indexFrom=d+k+m;p.indexCount=a;b.splice(c+1,0,p)}};a.prototype._getDisplayList=function(a,d,c){for(var h,k=this.symbolLevels.length,f=0;f<k;f++)if(this.symbolLevels[f].symbolLevel===a){h=this.symbolLevels[f];break}h||(h=new p,h.symbolLevel=a,this.symbolLevels.push(h));var g;a=h.zLevels.length;for(k=0;k<a;k++)if(h.zLevels[k].zLevel===d){g=h.zLevels[k];break}g||(g=new n,g.geometryDPInfo=new m,g.zLevel=d,h.zLevels.push(g));var q;switch(c){case b.WGLGeometryType.FILL:g.geometryDPInfo.fill||
(g.geometryDPInfo.fill=[]);q=g.geometryDPInfo.fill;break;case b.WGLGeometryType.LINE:g.geometryDPInfo.line||(g.geometryDPInfo.line=[]);q=g.geometryDPInfo.line;break;case b.WGLGeometryType.MARKER:g.geometryDPInfo.marker||(g.geometryDPInfo.marker=[]);q=g.geometryDPInfo.marker;break;case b.WGLGeometryType.TEXT:g.geometryDPInfo.text||(g.geometryDPInfo.text=[]);q=g.geometryDPInfo.text;break;default:console.error("Trying to add a record with geometry type '"+c+"'.")}return q};a.prototype.serialize=function(a){d.serializeList(a,
this.symbolLevels);return a};a.deserialize=function(b){var c=new a;c.symbolLevels=d.deserializeList(b,p);return c};a.prototype._getDPInfoType=function(a){switch(a){case b.WGLGeometryType.FILL:return"fill";case b.WGLGeometryType.LINE:return"line";case b.WGLGeometryType.MARKER:return"marker";case b.WGLGeometryType.TEXT:return"text";default:k.error("DisplayList: Tried to convert unknown geometryType: "+a)}};return a}();var h=function(){function a(){this.materialInfo=null;this.indexCount=this.indexFrom=
0}a.prototype.serialize=function(a){this.materialInfo.serialize(a);a.writeInt32(this.indexFrom);a.writeInt32(this.indexCount);return a};a.deserialize=function(b,d){var c=new a;c.geometryType=d.geometryType;c.materialInfo=g.default.deserialize(b);c.indexFrom=b.readInt32();c.indexCount=b.readInt32();return c};return a}(),m=function(){function a(){this.text=this.marker=this.line=this.fill=null}a.prototype.serialize=function(a){d.serializeList(a,this.fill);d.serializeList(a,this.line);d.serializeList(a,
this.marker);d.serializeList(a,this.text);return a};a.deserialize=function(c){var k=new a,f={geometryType:b.WGLGeometryType.FILL},g=d.deserializeList(c,h,f);g.length&&(k.fill=g);f.geometryType=b.WGLGeometryType.LINE;g=d.deserializeList(c,h,f);g.length&&(k.line=g);f.geometryType=b.WGLGeometryType.MARKER;g=d.deserializeList(c,h,f);g.length&&(k.marker=g);f.geometryType=b.WGLGeometryType.TEXT;c=d.deserializeList(c,h,f);c.length&&(k.text=c);return k};return a}(),n=function(){function a(){this.geometryDPInfo=
new m}a.prototype.serialize=function(a){a.writeInt32(this.zLevel);this.geometryDPInfo.serialize(a);return a};a.deserialize=function(b){var d=new a;d.zLevel=b.readInt32();d.geometryDPInfo=m.deserialize(b);return d};return a}(),p=function(){function a(){this.zLevels=[]}a.prototype.serialize=function(a){a.writeInt32(this.symbolLevel);d.serializeList(a,this.zLevels);return a};a.deserialize=function(b){var c=new a;c.symbolLevel=b.readInt32();c.zLevels=d.deserializeList(b,n);return c};return a}();return l})},
"esri/core/tsSupport/generatorHelper":function(){define([],function(){return function(l,e){function c(b){return function(d){return a([b,d])}}function a(a){if(g)throw new TypeError("Generator is already executing.");for(;b;)try{if(g=1,f&&(d=f[a[0]&2?"return":a[0]?"throw":"next"])&&!(d=d.call(f,a[1])).done)return d;if(f=0,d)a=[0,d.value];switch(a[0]){case 0:case 1:d=a;break;case 4:return b.label++,{value:a[1],done:!1};case 5:b.label++;f=a[1];a=[0];continue;case 7:a=b.ops.pop();b.trys.pop();continue;
default:if(!(d=b.trys,d=0<d.length&&d[d.length-1])&&(6===a[0]||2===a[0])){b=0;continue}if(3===a[0]&&(!d||a[1]>d[0]&&a[1]<d[3]))b.label=a[1];else if(6===a[0]&&b.label<d[1])b.label=d[1],d=a;else if(d&&b.label<d[2])b.label=d[2],b.ops.push(a);else{d[2]&&b.ops.pop();b.trys.pop();continue}}a=e.call(l,b)}catch(m){a=[6,m],f=0}finally{g=d=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}var b={label:0,sent:function(){if(d[0]&1)throw d[1];return d[1]},trys:[],ops:[]},g,f,d,k;return k={next:c(0),
"throw":c(1),"return":c(2)},"function"===typeof Symbol&&(k[Symbol.iterator]=function(){return this}),k}})},"esri/views/2d/engine/webgl/WGLDisplayObject":function(){define(["require","exports","./WGLDisplayRecord","./util/serializationUtils"],function(l,e,c,a){return function(){function b(a){this.displayRecords=[];this.id=a}b.prototype.serialize=function(b){b.writeInt32(this.id);a.serializeList(b,this.displayRecords);return b};b.deserialize=function(g){var f=g.readInt32(),d=new b(f);d.displayRecords=
a.deserializeList(g,c,{id:f});return d};return b}()})},"esri/views/2d/engine/webgl/WGLDisplayRecord":function(){define(["require","exports","./enums","./MaterialInfo","./MeshData"],function(l,e,c,a,b){return function(){function g(){this.id=-1;this.geometryType=c.WGLGeometryType.UNKNOWN;this.materialInfo=this.meshData=null;this.indexCount=this.indexFrom=this.vertexCount=this.vertexFrom=this.zOrder=this.symbolLevel=0}Object.defineProperty(g.prototype,"sortKey",{get:function(){void 0===this._sortKey&&
this._computeSortKey();return this._sortKey},enumerable:!0,configurable:!0});g.prototype.setData=function(a,b,c,h,g,n){this.id=a;this.geometryType=b;this.meshData=c;this.materialInfo=h;this.symbolLevel=g;this.zOrder=n};g.prototype.readMeshDataFromBuffers=function(a,d){this.meshData?this.meshData.clear():this.meshData=new b;for(var c in a){for(var h=a[c].stride,f=a[c].data,g=[],p=0;p<h*this.vertexCount/4;++p)g[p]=f[p+h*this.vertexFrom/4];this.meshData.vertexData.set(c,g)}for(p=this.meshData.indexData.length=
0;p<this.indexCount;++p)this.meshData.indexData[p]=d[p+this.indexFrom]-this.vertexFrom;this.meshData.vertexCount=this.vertexCount};g.prototype.writeMeshDataToBuffers=function(a,b,c,h){for(var d in b)for(var k=b[d].stride,f=this.meshData.vertexData.get(d),g=b[d].data,e=0;e<k*this.meshData.vertexCount/4;++e)g[e+k*a/4]=f[e];for(e=0;e<this.meshData.indexData.length;++e)h[e+c]=this.meshData.indexData[e]+a;this.vertexFrom=a;this.vertexCount=this.meshData.vertexCount;this.indexFrom=c;this.indexCount=this.meshData.indexData.length};
g.writeAllMeshDataToBuffers=function(a,b,c){for(var d=0,k=0,f=0;f<a.length;f++){var g=a[f];g.writeMeshDataToBuffers(d,b,k,c);d+=g.vertexCount;k+=g.indexCount}};g.prototype._computeSortKey=function(){this._sortKey=(this.symbolLevel&31)<<12|(this.zOrder&127)<<4|this.geometryType&7};g.prototype.serialize=function(a){a.writeInt32(this.geometryType);this.materialInfo.serialize(a);a.writeInt32(this.symbolLevel);a.writeInt32(this.zOrder);a.writeInt32(this.vertexFrom);a.writeInt32(this.vertexCount);a.writeInt32(this.indexFrom);
a.writeInt32(this.indexCount);return a};g.deserialize=function(b,d){var c=new g;c.id=d.id;c.geometryType=b.readInt32();c.materialInfo=a.default.deserialize(b);c.symbolLevel=b.readInt32();c.zOrder=b.readInt32();c.vertexFrom=b.readInt32();c.vertexCount=b.readInt32();c.indexFrom=b.readInt32();c.indexCount=b.readInt32();c.meshData=null;return c};return g}()})},"esri/views/2d/engine/webgl/MeshData":function(){define(["require","exports"],function(l,e){return function(){function c(){this.vertexData=new Map;
this.vertexCount=0;this.indexData=[]}c.prototype.clear=function(){this.vertexData.clear();this.vertexCount=0;this.indexData=[]};c.prototype.update=function(a,b,c){for(var f in a)this.vertexData.set(f,a[f]);for(f in this.vertexData)null===a[f]&&this.vertexData.delete(f);this.vertexCount=b;this.indexData=c};return c}()})},"esri/views/2d/engine/webgl/util/Reader":function(){define(["require","exports"],function(l,e){Object.defineProperty(e,"__esModule",{value:!0});l=function(){function c(a){this._pos=
0;this._buffer=a;this._view=new Int32Array(this._buffer)}c.prototype.readInt32=function(){return this._view[this._pos++]};return c}();e.default=l})},"esri/views/2d/engine/webgl/util/Writer":function(){define(["require","exports"],function(l,e){Object.defineProperty(e,"__esModule",{value:!0});l=function(){function c(a){this._pos=0;a=a?this._roundToNearest4(a):40;this._array=new ArrayBuffer(a);this._buffer=new Int32Array(this._array)}c.prototype._roundToNearest4=function(a){a=Math.round(a);return a+
(4-a%4)};c.prototype._ensureSize=function(){if(this._pos>=this._buffer.length){var a=new ArrayBuffer(this._roundToNearest4(1.5*this._array.byteLength)),b=new Int32Array(a);b.set(this._buffer,0);this._array=a;this._buffer=b}};c.prototype.writeInt32=function(a){this._ensureSize();var b=this._pos;this._buffer[this._pos++]=a;return b};c.prototype.buffer=function(){var a=this._array.slice(0,4*this._pos);this.destroy();return a};c.prototype.destroy=function(){this._buffer=this._array=null};return c}();
e.default=l})},"esri/views/2d/engine/webgl/TextureManager":function(){define("require exports ../../../../core/promiseUtils ./CIMSymbolHelper ./GlyphMosaic ./GlyphSource ./SDFHelper ./SpriteMosaic ./Utils ../../../3d/support/imageUtils".split(" "),function(l,e,c,a,b,g,f,d,k,h){function m(a){if(a.type){switch(k.normalizeSymbolType(a.type)){case "simple-marker":return"simple-marker"+a.style;case "simple-line":return"simple-line"+a.style}if(k.isPictureSymbol(a))return a.url?a.url:a.imageData+(""+a.width+
a.height)}return JSON.stringify(a)}return function(){function n(){this._spriteMosaic=new d(1024,1024,250);this._glyphSource=new g("https://basemaps.arcgis.com/v1/arcgis/rest/services/World_Basemap/VectorTileServer/resources/fonts/{fontstack}/{range}.pbf");this._glyphMosaic=new b(1024,1024,this._glyphSource)}Object.defineProperty(n.prototype,"sprites",{get:function(){return this._spriteMosaic},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"glyphs",{get:function(){return this._glyphMosaic},
enumerable:!0,configurable:!0});n.prototype.rasterizeItem=function(a,b){void 0===b&&(b=null);return a?!a.type||"text"!==a.type&&"esriTS"!==a.type?this._rasterizeSpriteSymbol(a).then(function(a){return{spriteMosaicItem:a}}):this._rasterizeTextSymbol(a,b).then(function(a){return{glyphMosaicItems:a}}):c.resolve(null)};n.prototype.bindSpritePage=function(a,b,d,c){c||(c=9729);this._spriteMosaic.bind(a,c,b,d)};n.prototype.bindGlyphsPage=function(a,b,d){this._glyphMosaic.bind(a,9729,b,d)};n.prototype._rasterizeTextSymbol=
function(a,b){return this._glyphMosaic.getGlyphItems(a,b)};n.prototype._rasterizeSpriteSymbol=function(a){var b=this;if((k.isFillSymbol(a)||k.isLineSymbol(a))&&("solid"===a.style||"esriSFSSolid"===a.style||"esriSLSSolid"===a.style||"none"===a.style))return c.resolve(null);var d=m(a);if(this._spriteMosaic.has(d))return c.resolve(this._spriteMosaic.getSpriteItem(d));if(a.url||a.imageData)return h.requestImage(a.imageData?"data:"+a.contentType+";base64,"+a.imageData:a.url).then(function(c){c=b._rasterizeResource(c);
return b._addItemToMosaic(d,c.size,c.anchor,c.image,!k.isMarkerSymbol(a),c.sdf)});var f=this._rasterizeResource(a);return c.resolve(this._addItemToMosaic(d,f.size,f.anchor,f.image,!k.isMarkerSymbol(a),f.sdf))};n.prototype._rasterizeResource=function(a){if(a instanceof HTMLImageElement){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));this._rasterizationCanvas.width=a.width;this._rasterizationCanvas.height=a.height;var b=this._rasterizationCanvas.getContext("2d");
b.drawImage(a,0,0,a.width,a.height);for(var b=b.getImageData(0,0,a.width,a.height),b=new Uint8Array(b.data),d=void 0,c=0;c<b.length;c+=4)d=b[c+3]/255,b[c]*=d,b[c+1]*=d,b[c+2]*=d;return{size:[a.width,a.height],anchor:[0,0],image:new Uint32Array(b.buffer),sdf:!1}}return this._rasterizeJSON(a)};n.prototype._addItemToMosaic=function(a,b,d,c,k,h){return this._spriteMosaic.addSpriteItem(a,b,d,c,k,h)};n.prototype._rasterizeJSON=function(b){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));
if("simple-fill"===b.type||"esriSFS"===b.type){var d=a.SymbolHelper.rasterizeSimpleFill(this._rasterizationCanvas,b.style);b=d[0];var c=d[1],d=d[2];return{size:[c,d],anchor:[0,0],image:new Uint32Array(b.buffer),sdf:!1}}if("simple-line"===b.type||"esriSLS"===b.type)return d=a.SymbolHelper.rasterizeSimpleLine(this._rasterizationCanvas,b.style),b=d[0],c=d[1],d=d[2],{size:[c,d],anchor:[0,0],image:new Uint32Array(b.buffer),sdf:!0};"simple-marker"===b.type||"esriSMS"===b.type?(b=a.CIMSymbolHelper.fromSimpleMarker(b),
c=!0):c=f.SDFHelper.checkSDF(b);if(c)return c=(new f.SDFHelper).buildSDF(b),b=c[0],{size:[c[1],c[2]],anchor:[0,0],image:new Uint32Array(b.buffer),sdf:!0};var k=a.CIMSymbolHelper.rasterize(this._rasterizationCanvas,b);b=k[0];c=k[1];d=k[2];return{size:[c,d],anchor:[k[3],k[4]],image:new Uint32Array(b.buffer),sdf:!1}};return n}()})},"esri/views/2d/engine/webgl/CIMSymbolHelper":function(){define(["require","exports","./CIMSymbolDrawHelper","./SDFHelper","../../../vectorTiles/GeometryUtils"],function(l,
e,c,a,b){Object.defineProperty(e,"__esModule",{value:!0});l=function(){function a(){}a.getEnvelope=function(a){if("CIMPointSymbol"!==a.type)return null;var b=new c.EnvDrawHelper;b.drawSymbol(a,{type:"point",x:0,y:0});return b.envelope()};a.rasterize=function(a,b){var d=this.getEnvelope(b);if(!d||0>=d.width||0>=d.height)return[null,0,0,0,0];var h=96/72,f=(d.x+.5*d.width)*h,g=-(d.y+.5*d.height)*h;a.width=d.width*h+2;a.height=d.height*h+2;d=a.getContext("2d");h=c.Transformation.createScale(h,-h);h.translate(.5*
a.width-f,.5*a.height-g);(new c.CanvasDrawHelper(d,h)).drawSymbol(b,{type:"point",x:0,y:0});b=d.getImageData(0,0,a.width,a.height);b=new Uint8Array(b.data);for(d=0;d<b.length;d+=4)h=b[d+3]/255,b[d]*=h,b[d+1]*=h,b[d+2]*=h;return[b,a.width,a.height,f/a.width,g/a.height]};a.fromSimpleMarker=function(a){var d,c,h=a.style;if("circle"===h||"esriSMSCircle"===h){d=Math.acos(.995);c=Math.ceil(b.C_PI/d/4);0===c&&(c=1);d=b.C_PI_BY_2/c;c*=4;h=[];h.push([50,0]);for(var f=1;f<c;f++)h.push([50*Math.cos(f*d),-50*
Math.sin(f*d)]);h.push([50,0]);d={rings:[h]};c={xmin:-50,ymin:-50,xmax:50,ymax:50}}else if("cross"===h||"esriSMSCross"===h)d=10,d={rings:[[[d,50],[d,d],[50,d],[50,-d],[d,-d],[d,-50],[-d,-50],[-d,-d],[-50,-d],[-50,d],[-d,d],[-d,50],[d,50]]]},c={xmin:-50,ymin:-50,xmax:50,ymax:50};else if("diamond"===h||"esriSMSDiamond"===h)d={rings:[[[-50,0],[0,50],[50,0],[0,-50],[-50,0]]]},c={xmin:-50,ymin:-50,xmax:50,ymax:50};else if("square"===h||"esriSMSSquare"===h)d={rings:[[[-50,-50],[-50,50],[50,50],[50,-50],
[-50,-50]]]},c={xmin:-50,ymin:-50,xmax:50,ymax:50};else if("x"===h||"esriSMSX"===h)d=14.142135623730951,d={rings:[[[0,d],[50-d,50],[50,50-d],[d,0],[50,d-50],[50-d,-50],[0,-d],[d-50,-50],[-50,d-50],[-d,0],[-50,50-d],[d-50,50],[0,d]]]},c={xmin:-50,ymin:-50,xmax:50,ymax:50};else if("triangle"===h||"esriSMSTriangle"===h)c=2/3*100,h=c-100,d={rings:[[[-57.735026918962575,h],[0,c],[57.735026918962575,h],[-57.735026918962575,h]]]},c={xmin:-57.735026918962575,ymin:h,xmax:57.735026918962575,ymax:c};var g;d&&
c&&(g=[{type:"CIMSolidFill",enable:!0,color:a.color}],a.outline&&g.push({type:"CIMSolidStroke",enable:!0,width:a.outline.width,color:a.outline.color}),g={type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:a.angle,size:a.size,offsetX:a.xoffset,offsetY:a.yoffset,frame:c,markerGraphics:[{type:"CIMMarkerGraphic",geometry:d,symbol:{type:"CIMPolygonSymbol",symbolLayers:g}}]}]});return g};return a}();e.CIMSymbolHelper=l;l=function(){function b(){}b.rasterizeSimpleFill=function(a,
b){"solid"!==b&&"none"!==b&&"esriSFSSolid"!==b&&"esriSFSNull"!==b||console.error("Unexpected: style does not require rasterization");a.width=8;a.height=8;var c=a.getContext("2d");c.strokeStyle="#FFFFFF";c.beginPath();if("vertical"===b||"cross"===b||"esriSFSCross"===b||"esriSFSVertical"===b)c.moveTo(0,0),c.lineTo(0,8);if("horizontal"===b||"cross"===b||"esriSFSCross"===b||"esriSFSHorizontal"===b)c.moveTo(0,0),c.lineTo(8,0);if("forward-diagonal"===b||"diagonal-cross"===b||"esriSFSDiagonalCross"===b||
"esriSFSForwardDiagonal"===b)c.moveTo(0,0),c.lineTo(8,8);if("backward-diagonal"===b||"diagonal-cross"===b||"esriSFSBackwardDiagonal"===b||"esriSFSDiagonalCross"===b)c.moveTo(8,0),c.lineTo(0,8);c.stroke();b=c.getImageData(0,0,a.width,a.height);b=new Uint8Array(b.data);for(var d=0;d<b.length;d+=4)c=b[d+3]/255,b[d]*=c,b[d+1]*=c,b[d+2]*=c;return[b,a.width,a.height]};b.rasterizeSimpleLine=function(b,c){var d;switch(c){case "dash":case "esriSLSDash":d=[3,2];break;case "dash-dot":case "esriSLSDashDot":d=
[2,2,0,2];break;case "dot":case "esriSLSDot":d=[0,3];break;case "long-dash":case "esriSLSLongDash":d=[6,3];break;case "long-dash-dot":case "esriSLSLongDashDot":d=[6,3,0,3];break;case "long-dash-dot-dot":case "esriSLSLongDashDotDot":d=[2,2,0,2,0,2];break;case "short-dash":case "esriSLSShortDash":d=[2,2];break;case "short-dash-dot":case "esriSLSShortDashDot":d=[2,2,0,2];break;case "short-dash-dot-dot":case "esriSLSShortDashDotDot":d=[2,2,0,2,0,2];break;case "short-dot":case "esriSLSShortDot":d=[0,2];
break;case "solid":case "esriSLSSolid":throw Error("Unexpected: style does not require rasterization");case "none":throw Error("Unexpected: style does not require rasterization");}c=b=0;for(var h=d;c<h.length;c++){var g=h[c];b+=g}b*=16;h=31*b;c=new Float32Array(h);for(g=0;g<h;++g)c[g]=257;for(var f=h=.5,e=!0,q=0;q<d.length;q++){for(var g=d[q],h=f,f=f+16*g,t=h;t<f;){for(var r=.5;31>r;){var g=(31-r+1.5)*b+t-.5,v=(r-15.5)*(r-15.5);c[g]=e?v:Math.min((t-h)*(t-h)+v,(t-f)*(t-f)+v);r++}t++}e=!e}d=c.length;
h=new Uint8Array(4*d);for(g=0;g<d;++g)a.packFloat(Math.sqrt(c[g])/15,h,4*g);return[h,b,31]};return b}();e.SymbolHelper=l})},"esri/views/2d/engine/webgl/CIMSymbolDrawHelper":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ./GeometryUtils ./Rect".split(" "),function(l,e,c,a,b,g){Object.defineProperty(e,"__esModule",{value:!0});var f=function(){function a(a){this._t=a}a.createIdentity=function(){return new a([1,0,0,0,1,0])};a.prototype.clone=
function(){return new a(this._t.slice())};a.prototype.transform=function(a){var b=this._t;return[b[0]*a[0]+b[1]*a[1]+b[2],b[3]*a[0]+b[4]*a[1]+b[5]]};a.createScale=function(b,c){return new a([b,0,0,0,c,0])};a.prototype.scale=function(a,b){var c=this._t;c[0]*=a;c[1]*=a;c[2]*=a;c[3]*=b;c[4]*=b;c[5]*=b;return this};a.prototype.scaleRatio=function(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])};a.createTranslate=function(b,c){return new a([0,0,b,0,0,c])};a.prototype.translate=function(a,
b){var c=this._t;c[2]+=a;c[5]+=b;return this};a.createRotate=function(b){var c=Math.cos(b);b=Math.sin(b);return new a([c,-b,0,b,c,0])};a.prototype.rotate=function(b){return this.multiply(a.createRotate(b))};a.prototype.multiply=function(a){var b=this._t;a=a._t;var c=b[1]*a[0]+b[4]*a[1],d=b[2]*a[0]+b[5]*a[1]+a[2],g=b[0]*a[3]+b[3]*a[4],f=b[1]*a[3]+b[4]*a[4],k=b[2]*a[3]+b[5]*a[4]+a[5];b[0]=b[0]*a[0]+b[3]*a[1];b[1]=c;b[2]=d;b[3]=g;b[4]=f;b[5]=k;return this};return a}();e.Transformation=f;l=function(){function a(a){this._transfos=
[];this._sizeTransfos=[];this._transfos.push(a||f.createIdentity());this._sizeTransfos.push(a?a.scaleRatio():1)}a.prototype.transformPt=function(a){return this._transfos[this._transfos.length-1].transform(a)};a.prototype.transformSize=function(a){return a*this._sizeTransfos[this._sizeTransfos.length-1]};a.prototype.back=function(){return this._transfos[this._transfos.length-1]};a.prototype.push=function(a){var b=a.scaleRatio();a.multiply(this.back());this._transfos.push(a);this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-
1]*b)};a.prototype.pop=function(){this._transfos.splice(-1,1);this._sizeTransfos.splice(-1,1)};a.prototype.drawSolidFill=function(a,b){};a.prototype.drawSolidStroke=function(a,b,c){};a.prototype.drawSymbol=function(a,b){if(a)switch(a.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":this.drawMultiLayerSymbol(a,b)}};a.prototype.drawMultiLayerSymbol=function(a,b){if(a&&(a=a.symbolLayers))for(var c=a.length;c--;){var d=a[c];if(d&&d.enable)switch(d.type){case "CIMSolidFill":this.drawSolidFill(b,
d.color);break;case "CIMSolidStroke":this.drawSolidStroke(b,d.color,d.width);break;case "CIMVectorMarker":this.drawVectorMarker(d,b)}}};a.prototype.drawVectorMarker=function(a,c){if(a){var d=a.markerGraphics;if(d){var g=a.size,h=a.frame,k=h?h.ymax-h.ymin:0,k=g&&k?g/k:1,e=f.createIdentity();h&&e.translate(.5*-(h.xmax+h.xmin),.5*-(h.ymax+h.ymin));var r=a.anchorPt;if(r){var v=r.x,r=r.y;"relative"===a.anchorPtUnits&&h&&(v*=(h.xmax-h.xmin)*k,r*=g);e.translate(-v,-r)}1!==k&&e.scale(k,k);a.rotation&&e.rotate(a.rotation*
b.C_DEG_TO_RAD);e.translate(a.offsetX||0,a.offsetY||0);e.translate(c.x,c.y);this.push(e);for(a=0;a<d.length;a++)(c=d[a])&&this.drawSymbol(c.symbol,c.geometry);this.pop()}}};return a}();e.CIMSymbolDrawHelper=l;a=function(a){function b(){var b=a.call(this)||this;b._xmin=b._ymin=Infinity;b._xmax=b._ymax=-Infinity;return b}c(b,a);b.prototype.envelope=function(){return new g(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)};b.prototype._merge=function(a,b){a[0]-b<this._xmin&&(this._xmin=
a[0]-b);a[0]+b>this._xmax&&(this._xmax=a[0]+b);a[1]-b<this._ymin&&(this._ymin=a[1]-b);a[1]+b>this._ymax&&(this._ymax=a[1]+b)};b.prototype.drawSolidFill=function(a,b){b=0;for(a=a.rings;b<a.length;b++){var c=a[b],d=c?c.length:0;if(2<d){this._merge(this.transformPt(c[0]),0);for(var g=1;g<d;++g)this._merge(this.transformPt(c[g]),0)}}};b.prototype.drawSolidStroke=function(a,b,c){b=.5*this.transformSize(c);c=0;for(a=a.rings||a.paths;c<a.length;c++){var d=a[c],g=d?d.length:0;if(1<g){this._merge(this.transformPt(d[0]),
b);for(var f=1;f<g;++f)this._merge(this.transformPt(d[f]),b)}}};return b}(l);e.EnvDrawHelper=a;l=function(a){function b(b,c){c=a.call(this,c)||this;c._ctx=b;return c}c(b,a);b.prototype.drawSolidFill=function(a,b){var c=this._ctx;c.fillStyle="rgba("+Math.round(b[0])+","+Math.round(b[1])+","+Math.round(b[2])+","+b[3]/255+")";c.beginPath();b=0;for(a=a.rings;b<a.length;b++){var d=a[b],g=d?d.length:0;if(2<g){var f=this.transformPt(d[0]);c.moveTo(f[0],f[1]);for(var h=1;h<g;++h)f=this.transformPt(d[h]),
c.lineTo(f[0],f[1]);c.closePath()}}c.fill("evenodd")};b.prototype.drawSolidStroke=function(a,b,c){var d=this._ctx;d.strokeStyle="rgba("+Math.round(b[0])+","+Math.round(b[1])+","+Math.round(b[2])+","+b[3]/255+")";d.lineWidth=this.transformSize(c)+.5;d.beginPath();b=!!a.rings;c=0;for(a=a.rings||a.paths;c<a.length;c++){var g=a[c],f=g?g.length:0;if(1<f){var h=this.transformPt(g[0]);d.moveTo(h[0],h[1]);for(var k=1;k<f;++k)h=this.transformPt(g[k]),d.lineTo(h[0],h[1]);b&&d.closePath()}}d.stroke()};return b}(l);
e.CanvasDrawHelper=l})},"esri/views/2d/engine/webgl/Rect":function(){define(["require","exports"],function(l,e){return function(){function c(a,b,c,f){void 0===a&&(a=0);void 0===b&&(b=0);void 0===c&&(c=0);void 0===f&&(f=0);this.x=a;this.y=b;this.width=c;this.height=f}Object.defineProperty(c.prototype,"isEmpty",{get:function(){return 0>=this.width||0>=this.height},enumerable:!0,configurable:!0});return c}()})},"esri/views/2d/engine/webgl/SDFHelper":function(){define(["require","exports","./Geometry",
"./Rect"],function(l,e,c,a){function b(a){return a-Math.floor(a)}function g(a,c,g){0>a?a=0:.9999991<a&&(a=.9999991);var h=b(a*f[0]),k=b(a*f[1]),e=b(a*f[2]);a=b(a*f[3]);c[g+0]=256*(h-h*d[0]);c[g+1]=256*(k-h*d[1]);c[g+2]=256*(e-k*d[2]);c[g+3]=256*(a-e*d[3])}Object.defineProperty(e,"__esModule",{value:!0});var f=[16777216,65536,256,1],d=[0,1/256,1/256,1/256];e.packFloat=g;l=function(){function b(){}b.checkSDF=function(a){return!0};b.prototype._extractGeometry=function(a){if(!a)return null;a=a.symbolLayers;
if(!a||1!==a.length)return null;a=a[0];if(!a)return null;a=a.markerGraphics;if(!a||1!==a.length)return null;a=a[0];if(!a)return null;var b=a.geometry;if(!b||!b.rings)return null;a=[];for(var d=0,b=b.rings;d<b.length;d++){for(var g=[],f=0,h=b[d];f<h.length;f++){var k=h[f];g.push(new c.Point(k[0],k[1]))}a.push(g)}return a};b.prototype._getEnvelope=function(b){for(var c=Infinity,d=-Infinity,g=Infinity,f=-Infinity,h=0;h<b.length;h++)for(var k=0,e=b[h];k<e.length;k++){var u=e[k];u.x<c&&(c=u.x);u.x>d&&
(d=u.x);u.y<g&&(g=u.y);u.y>f&&(f=u.y)}return new a(c,g,d-c,f-g)};b.prototype.buildSDF=function(a){a=this._extractGeometry(a);if(!a)return null;var b=this._getEnvelope(a);if(0>=b.width||0>=b.height)return null;for(var c=Math.floor(31.5),d=(128-2*(c+0+1))/Math.max(b.width,b.height),g=Math.round(b.width*d),f=Math.round(b.height*d),h=g+2*c,k=f+2*c,e=0;e<a.length;e++)for(var l=0,w=a[e];l<w.length;l++){var A=w[l];A.x-=b.x;A.y-=b.y;A.x*=d;A.y*=d;A.x+=c-.5;A.y+=c-.5}b=this._dist_map(a,h,k,c);this._sign_dist_map(a,
h,k,c,b);return[this._encodeDistMap(b,c),h,k,g,f,d]};b.prototype._dist_map=function(a,b,c,d){for(var g=b*c,f=new Float32Array(g),h=d*d+1,k=0;k<g;++k)f[k]=h;for(h=0;h<a.length;h++)for(var e=a[h],m=e.length,k=1;k<m;++k){var n=e[k-1],p=e[k],l=void 0,E=void 0;n.x<p.x?(l=n.x,E=p.x):(l=p.x,E=n.x);var z=void 0,B=void 0;n.y<p.y?(z=n.y,B=p.y):(z=p.y,B=n.y);var x=Math.floor(l)-d,E=Math.floor(E)+d,z=Math.floor(z)-d,B=Math.floor(B)+d;0>x&&(x=0);E>b&&(E=b);0>z&&(z=0);B>c&&(B=c);for(var l=p.x-n.x,F=p.y-n.y,J=l*
l+F*F;x<E;x++)for(var H=z;H<B;H++){var D=(x-n.x)*l+(H-n.y)*F,C=void 0,G=void 0;0>D?(C=n.x,G=n.y):D>J?(C=p.x,G=p.y):(D/=J,C=n.x+D*l,G=n.y+D*F);D=(x-C)*(x-C)+(H-G)*(H-G);C=(c-H-1)*b+x;D<f[C]&&(f[C]=D)}}for(k=0;k<g;++k)f[k]=Math.sqrt(f[k]);return f};b.prototype._sign_dist_map=function(a,b,c,d,g){for(var f=0;f<a.length;f++)for(var h=a[f],k=h.length,e=1;e<k;++e){var m=h[e-1],n=h[e],p=void 0,q=void 0;m.x<n.x?(p=m.x,q=n.x):(p=n.x,q=m.x);var l=void 0,z=void 0;m.y<n.y?(l=m.y,z=n.y):(l=n.y,z=m.y);p=Math.floor(p);
q=Math.floor(q)+1;l=Math.floor(l);z=Math.floor(z)+1;p<d&&(p=d);q>b-d&&(q=b-d);l<d&&(l=d);for(z>c-d&&(z=c-d);l<z;++l)if(m.y>l!==n.y>l){for(var B=(c-l-1)*b,x=p;x<q;++x)x<(n.x-m.x)*(l-m.y)/(n.y-m.y)+m.x&&(g[B+x]=-g[B+x]);for(x=d;x<p;++x)g[B+x]=-g[B+x]}}};b.prototype._encodeDistMap=function(a,b){b*=2;for(var c=a.length,d=new Uint8Array(4*c),f=0;f<c;++f)g(.5-a[f]/b,d,4*f);return d};return b}();e.SDFHelper=l})},"esri/views/2d/engine/webgl/Geometry":function(){define(["require","exports"],function(l,e){Object.defineProperty(e,
"__esModule",{value:!0});l=function(){function c(a,b){this.x=a;this.y=b}c.prototype.clone=function(){return new c(this.x,this.y)};c.prototype.equals=function(a,b){return a===this.x&&b===this.y};c.prototype.isEqual=function(a){return a.x===this.x&&a.y===this.y};c.prototype.setCoords=function(a,b){this.x=a;this.y=b};c.prototype.normalize=function(){var a=this.x,b=this.y,a=Math.sqrt(a*a+b*b);this.x/=a;this.y/=a};c.prototype.rightPerpendicular=function(){var a=this.x;this.x=this.y;this.y=-a};c.prototype.move=
function(a,b){this.x+=a;this.y+=b};c.prototype.assign=function(a){this.x=a.x;this.y=a.y};c.prototype.assignAdd=function(a,b){this.x=a.x+b.x;this.y=a.y+b.y};c.prototype.assignSub=function(a,b){this.x=a.x-b.x;this.y=a.y-b.y};c.prototype.rotate=function(a,b){var c=this.x,f=this.y;this.x=c*a-f*b;this.y=c*b+f*a};c.prototype.scale=function(a){this.x*=a;this.y*=a};c.prototype.length=function(){var a=this.x,b=this.y;return Math.sqrt(a*a+b*b)};c.distance=function(a,b){var c=b.x-a.x;a=b.y-a.y;return Math.sqrt(c*
c+a*a)};c.add=function(a,b){return new c(a.x+b.x,a.y+b.y)};c.sub=function(a,b){return new c(a.x-b.x,a.y-b.y)};return c}();e.Point=l})},"esri/views/vectorTiles/GeometryUtils":function(){define(["require","exports"],function(l,e){function c(a,c){a%=c;return 0<=a?a:a+c}Object.defineProperty(e,"__esModule",{value:!0});e.C_INFINITY=Number.POSITIVE_INFINITY;e.C_PI=Math.PI;e.C_2PI=2*e.C_PI;e.C_PI_BY_2=e.C_PI/2;e.C_RAD_TO_256=128/e.C_PI;e.C_256_TO_RAD=e.C_PI/128;e.C_DEG_TO_256=256/360;e.C_DEG_TO_RAD=e.C_PI/
180;e.C_SQRT2=1.414213562;e.C_SQRT2_INV=1/e.C_SQRT2;var a=1/Math.LN2;e.positiveMod=c;e.radToByte=function(a){return c(a*e.C_RAD_TO_256,256)};e.degToByte=function(a){return c(a*e.C_DEG_TO_256,256)};e.log2=function(b){return Math.log(b)*a};e.sqr=function(a){return a*a};e.clamp=function(a,c,f){return Math.min(Math.max(a,c),f)};e.interpolate=function(a,c,f){return a*(1-f)+c*f};e.between=function(a,c,f){return a>=c&&a<=f||a>=f&&a<=c}})},"esri/views/2d/engine/webgl/GlyphMosaic":function(){define("require exports dojo/has dojo/promise/all ./fontUtils ./Rect ./RectangleBinPack ../../../webgl/Texture".split(" "),
function(l,e,c,a,b,g,f,d){var k;c("stable-symbol-rendering")&&(k=new Set);return function(){function h(a,b,c){this.height=this.width=0;this._dirties=[];this._glyphData=[];this._currentPage=0;this._glyphIndex={};this._textures=[];this._rangePromises=new Map;(0>=a||0>=b)&&console.error("Glyph mosaic width and height must be greater than zero!");this.width=a;this.height=b;this._glyphSource=c;this._binPack=new f(a-4,b-4);this._glyphData.push(new Uint8Array(a*b));this._dirties.push(!0);this._textures.push(void 0)}
h.prototype.getGlyphItems=function(d,h){var e=this,m=b.getFullyQualifiedFontName(d),n=[],l=this._glyphSource,v=new Set;d=1/256;for(var u=0;u<h.length;u++)v.add(Math.floor(h[u]*d));var y=[];v.forEach(function(a){if(256>=a){var b=m+a;e._rangePromises.has(b)?y.push(e._rangePromises.get(b)):(a=l.getRange(m,a).always(function(){e._rangePromises["delete"](b)}),e._rangePromises.set(b,a),y.push(a))}});return a(y).then(function(a){a=e._glyphIndex[m];a||(a={},e._glyphIndex[m]=a);var b;if(c("stable-symbol-rendering")){k.clear();
for(var d=0;d<h.length;d++)b=h[d],k.add(b);var p=[];v.forEach(function(a){p.push(a)});p.sort();b=[];for(d=0;d<p.length;d++)for(var q=p[d],u=0;256>u;++u)b.push(256*q+u)}else b=h;d=0;for(q=b;d<q.length;d++)if(b=q[d],u=a[b]){if(!c("stable-symbol-rendering")||k.has(b))n[b]={rect:u.rect,metrics:u.metrics,page:u.page}}else{var t=l.getGlyph(m,b);if(t&&t.metrics){var u=t.metrics,r=void 0;if(0===u.width)r=new g(0,0,0,0);else{var y=u.width+6,w=u.height+6,D=y%4?4-y%4:4,C=w%4?4-w%4:4;1===D&&(D=5);1===C&&(C=5);
r=e._binPack.allocate(y+D,w+C);r.isEmpty&&(e._dirties[e._currentPage]||(e._glyphData[e._currentPage]=null),e._currentPage=e._glyphData.length,e._glyphData.push(new Uint8Array(e.width*e.height)),e._dirties.push(!0),e._textures.push(void 0),e._binPack=new f(e.width-4,e.height-4),r=e._binPack.allocate(y+D,w+C));var D=e._glyphData[e._currentPage],t=t.bitmap,G=C=void 0;if(t)for(var K=0;K<w;K++)for(var C=y*K,G=e.width*(r.y+K+1)+r.x,L=0;L<y;L++)D[G+L+1]=t[C+L]}a[b]={rect:r,metrics:u,tileIDs:null,page:e._currentPage};
if(!c("stable-symbol-rendering")||k.has(b))n[b]={rect:r,metrics:u,page:e._currentPage};e._dirties[e._currentPage]=!0}}return n})};h.prototype.bind=function(a,b,c,f){this._textures[c]||(this._textures[c]=new d(a,{pixelFormat:6406,dataType:5121,width:this.width,height:this.height},new Uint8Array(this.width*this.height)));var g=this._textures[c];g.setSamplingMode(b);this._dirties[c]&&g.setData(this._glyphData[c]);a.bindTexture(g,f);this._dirties[c]=!1};h.prototype.dispose=function(){this._binPack=null;
for(var a=0,b=this._textures;a<b.length;a++){var c=b[a];c&&c.dispose()}this._textures.length=0};return h}()})},"esri/views/2d/engine/webgl/fontUtils":function(){define(["require","exports"],function(l,e){Object.defineProperty(e,"__esModule",{value:!0});e.getFullyQualifiedFontName=function(c){c=c.font;var a;a:{switch(c.weight.toLowerCase()){case "bold":case "bolder":a=" Bold";break a}a=""}var b;a:{switch(c.style.toLowerCase()){case "italic":case "oblic":b=" Italic";break a}b=""}a+=b;a:{switch(c.decoration.toLowerCase()){case "underline":b=
" Underline";break a;case "line-through":b=" Strikethrough";break a}b=""}a+=b;return c.family.charAt(0).toUpperCase()+c.family.slice(1)+(0<a.length?a:" Regular")}})},"esri/views/2d/engine/webgl/RectangleBinPack":function(){define(["require","exports","./Rect"],function(l,e,c){return function(){function a(a,g){this._height=this._width=0;this._free=[];this._width=a;this._height=g;this._free.push(new c(0,0,a,g))}Object.defineProperty(a.prototype,"width",{get:function(){return this._width},enumerable:!0,
configurable:!0});Object.defineProperty(a.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0});a.prototype.allocate=function(a,g){if(a>this._width||g>this._height)return new c;for(var b=null,d=-1,k=0;k<this._free.length;++k){var h=this._free[k];a<=h.width&&g<=h.height&&(null===b||h.y<=b.y&&h.x<=b.x)&&(b=h,d=k)}if(null===b)return new c;this._free.splice(d,1);b.width<b.height?(b.width>a&&this._free.push(new c(b.x+a,b.y,b.width-a,g)),b.height>g&&this._free.push(new c(b.x,
b.y+g,b.width,b.height-g))):(b.width>a&&this._free.push(new c(b.x+a,b.y,b.width-a,b.height)),b.height>g&&this._free.push(new c(b.x,b.y+g,a,b.height-g)));return new c(b.x,b.y,a,g)};a.prototype.release=function(a){for(var b=0;b<this._free.length;++b){var c=this._free[b];if(c.y===a.y&&c.height===a.height&&c.x+c.width===a.x)c.width+=a.width;else if(c.x===a.x&&c.width===a.width&&c.y+c.height===a.y)c.height+=a.height;else if(a.y===c.y&&a.height===c.height&&a.x+a.width===c.x)c.x=a.x,c.width+=a.width;else if(a.x===
c.x&&a.width===c.width&&a.y+a.height===c.y)c.y=a.y,c.height+=a.height;else continue;this._free.splice(b,1);this.release(a)}this._free.push(a)};return a}()})},"esri/views/2d/engine/webgl/GlyphSource":function(){define(["require","exports","../../../../request","../../../../core/pbf","../../../../core/promiseUtils"],function(l,e,c,a,b){var g=function(){function a(a){this._metrics=[];for(this._bitmaps=[];a.next();)switch(a.tag()){case 1:for(var b=a.getMessage();b.next();)switch(b.tag()){case 3:for(var c=
b.getMessage(),d=void 0,g=void 0,f=void 0,k=void 0,e=void 0,l=void 0,u=void 0;c.next();)switch(c.tag()){case 1:d=c.getUInt32();break;case 2:g=c.getBytes();break;case 3:f=c.getUInt32();break;case 4:k=c.getUInt32();break;case 5:e=c.getSInt32();break;case 6:l=c.getSInt32();break;case 7:u=c.getUInt32();break;default:c.skip()}d&&(this._metrics[d]={width:f,height:k,left:e,top:l,advance:u},this._bitmaps[d]=g);break;default:b.skip()}break;default:a.skip()}}a.prototype.getMetrics=function(a){return this._metrics[a]};
a.prototype.getBitmap=function(a){return this._bitmaps[a]};return a}(),f=function(){function a(){this._ranges=[]}a.prototype.getRange=function(a){return this._ranges[a]};a.prototype.addRange=function(a,b){this._ranges[a]=b};return a}();return function(){function d(a){this._glyphInfo={};this._baseURL=a}d.prototype.getRange=function(d,f){var h=this._getFontStack(d);if(h.getRange(f))return b.resolve();var e=256*f,k=e+255;d=this._baseURL.replace("{fontstack}",d).replace("{range}",e+"-"+k);return c(d,
{callbackParamName:"callback",responseType:"array-buffer"}).then(function(b){h.addRange(f,new g(new a(new Uint8Array(b.data),new DataView(b.data))))})};d.prototype.getGlyph=function(a,b){if(a=this._getFontStack(a)){var c=Math.floor(b/256);if(!(256<c)&&(a=a.getRange(c)))return{metrics:a.getMetrics(b),bitmap:a.getBitmap(b)}}};d.prototype._getFontStack=function(a){var b=this._glyphInfo[a];b||(b=this._glyphInfo[a]=new f);return b};return d}()})},"esri/core/pbf":function(){define(["require","exports"],
function(l,e){return function(){function c(a,b,c,f){this._tag=0;this._dataType=99;this._data=a;this._dataView=b;this._pos=c||0;this._end=f||a.byteLength}c.prototype.clone=function(){return new c(this._data,this._dataView,this._pos,this._end)};c.prototype.next=function(a){for(;;){if(this._pos===this._end)return!1;var b=this._decodeVarint();this._tag=b>>3;this._dataType=b&7;if(!a||a===this._tag)break;this.skip()}return!0};c.prototype.empty=function(){return this._pos>=this._end};c.prototype.tag=function(){return this._tag};
c.prototype.getInt32=function(){return this._decodeVarint()};c.prototype.getInt64=function(){return this._decodeVarint()};c.prototype.getUInt32=function(){var a=4294967295,a=(this._data[this._pos]&127)>>>0;if(128>this._data[this._pos++])return a;a=(a|(this._data[this._pos]&127)<<7)>>>0;if(128>this._data[this._pos++])return a;a=(a|(this._data[this._pos]&127)<<14)>>>0;if(128>this._data[this._pos++])return a;a=(a|(this._data[this._pos]&127)<<21)>>>0;if(128>this._data[this._pos++])return a;a=(a|(this._data[this._pos]&
15)<<28)>>>0;if(128>this._data[this._pos++])return a};c.prototype.getUInt64=function(){return this._decodeVarint()};c.prototype.getSInt32=function(){var a=this.getUInt32();return a>>>1^-(a&1)|0};c.prototype.getSInt64=function(){return this._decodeSVarint()};c.prototype.getBool=function(){var a=0!==this._data[this._pos];this._skip(1);return a};c.prototype.getEnum=function(){return this._decodeVarint()};c.prototype.getFixed64=function(){var a=this._dataView,b=this._pos,a=a.getUint32(b,!0)+4294967296*
a.getUint32(b+4,!0);this._skip(8);return a};c.prototype.getSFixed64=function(){var a=this._dataView,b=this._pos,a=a.getUint32(b,!0)+4294967296*a.getInt32(b+4,!0);this._skip(8);return a};c.prototype.getDouble=function(){var a=this._dataView.getFloat64(this._pos,!0);this._skip(8);return a};c.prototype.getFixed32=function(){var a=this._dataView.getUint32(this._pos,!0);this._skip(4);return a};c.prototype.getSFixed32=function(){var a=this._dataView.getInt32(this._pos,!0);this._skip(4);return a};c.prototype.getFloat=
function(){var a=this._dataView.getFloat32(this._pos,!0);this._skip(4);return a};c.prototype.getString=function(){var a=this._getLength(),b=this._pos,b=this._toString(this._data,b,b+a);this._skip(a);return b};c.prototype.getBytes=function(){var a=this._getLength(),b=this._pos,b=this._toBytes(this._data,b,b+a);this._skip(a);return b};c.prototype.getMessage=function(){var a=this._getLength(),b=this._pos,b=new c(this._data,this._dataView,b,b+a);this._skip(a);return b};c.prototype.skip=function(){switch(this._dataType){case 0:this._decodeVarint();
break;case 1:this._skip(8);break;case 2:this._skip(this._getLength());break;case 5:this._skip(4);break;default:throw Error("Invalid data type!");}};c.prototype._skip=function(a){if(this._pos+a>this._end)throw Error("Attempt to skip past the end of buffer!");this._pos+=a};c.prototype._decodeVarint=function(){var a=this._data,b=this._pos,c=0,f;if(10<=this._end-b){if(f=a[b++],c|=f&127,0!==(f&128)&&(f=a[b++],c|=(f&127)<<7,0!==(f&128)&&(f=a[b++],c|=(f&127)<<14,0!==(f&128)&&(f=a[b++],c|=(f&127)<<21,0!==
(f&128)&&(f=a[b++],c+=268435456*(f&127),0!==(f&128)&&(f=a[b++],c+=34359738368*(f&127),0!==(f&128)&&(f=a[b++],c+=4398046511104*(f&127),0!==(f&128)&&(f=a[b++],c+=562949953421312*(f&127),0!==(f&128)&&(f=a[b++],c+=72057594037927936*(f&127),0!==(f&128)&&(f=a[b++],c+=0x7fffffffffffffff*(f&127),0!==(f&128)))))))))))throw Error("Varint too long!");}else{for(var d=1;b!==this._end;){f=a[b];if(0===(f&128))break;++b;c+=(f&127)*d;d*=128}if(b===this._end)throw Error("Varint overrun!");++b;c+=f*d}this._pos=b;return c};
c.prototype._decodeSVarint=function(){var a=this._decodeVarint();return a%2?-(a+1)/2:a/2};c.prototype._getLength=function(){if(2!==this._dataType)throw Error("Not a delimited data type!");return this._decodeVarint()};c.prototype._toString=function(a,b,c){var g="",d="";for(c=Math.min(this._end,c);b<c;++b){var e=a[b];e&128?d+="%"+e.toString(16):(g+=decodeURIComponent(d)+String.fromCharCode(e),d="")}d.length&&(g+=decodeURIComponent(d));return g};c.prototype._toBytes=function(a,b,c){c=Math.min(this._end,
c);return new Uint8Array(a.buffer,b,c-b)};return c}()})},"esri/views/2d/engine/webgl/SpriteMosaic":function(){define("require exports ./GeometryUtils ./Rect ./RectangleBinPack ../../../webgl/Texture".split(" "),function(l,e,c,a,b,g){return function(){function f(a,c,g){void 0===g&&(g=0);this._size=[];this._mosaicsData=[];this._textures=[];this._dirties=[];this._pageHeight=this._pageWidth=this._currentPage=this._maxItemSize=0;this._mosaicRects=new Map;this._spriteCopyQueue=[];this.pixelRatio=1;(0>=
a||0>=c)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!");this._pageWidth=a;this._pageHeight=c;0<g&&(this._maxItemSize=g);this.pixelRatio=window.devicePixelRatio|1;this._binPack=new b(this._pageWidth,this._pageHeight);this._mosaicsData[0]=new Uint32Array(Math.floor(this._pageWidth)*Math.floor(this._pageHeight));this._dirties.push(!0);this._size.push([this._pageWidth,this._pageHeight]);this._textures.push(void 0)}f.prototype.getWidth=function(a){return a>=
this._size.length?-1:this._size[a][0]};f.prototype.getHeight=function(a){return a>=this._size.length?-1:this._size[a][1]};f.prototype.getPage=function(a){return a<this._textures.length?this._textures[a]:null};f.prototype.has=function(a){return this._mosaicRects.has(a)};Object.defineProperty(f.prototype,"itemCount",{get:function(){return this._mosaicRects.size},enumerable:!0,configurable:!0});f.prototype.getSpriteItem=function(a){return this._mosaicRects.get(a)};f.prototype.addSpriteItem=function(a,
b,c,g,f,e){if(this._mosaicRects.has(a))return this._mosaicRects.get(a);var d=this._allocateImage(b[0],b[1]),h=d[0],k=d[1],d=d[2];if(0>=h.width||0>=h.height)return null;c={rect:h,width:b[0],height:b[1],anchorX:c[0],anchorY:c[1],sdf:e,pixelRatio:1,page:k};this._mosaicRects.set(a,c);this._copy({rect:h,spriteSize:b,spriteData:g,page:k,pageSize:d,repeat:f,sdf:e});return c};f.prototype.hasItemsToProcess=function(){return 0!==this._spriteCopyQueue.length};f.prototype.processNextItem=function(){var a=this._spriteCopyQueue.pop();
a&&this._copy(a)};f.prototype.getSpriteItems=function(a){for(var b={},c=0;c<a.length;c++){var d=a[c];b[d]=this.getSpriteItem(d)}return b};f.prototype.getMosaicItemPosition=function(a,b){b=(a=this.getSpriteItem(a))&&a.rect;if(!b)return null;b.width=a.width;b.height=a.height;return{size:[a.width,a.height],tl:[(b.x+1)/this._size[a.page][0],(b.y+1)/this._size[a.page][1]],br:[(b.x+1+a.width)/this._size[a.page][0],(b.y+1+a.height)/this._size[a.page][1]],page:a.page}};f.prototype.bind=function(a,b,c,f){void 0===
c&&(c=0);void 0===f&&(f=0);this._textures[c]||(this._textures[c]=new g(a,{pixelFormat:6408,dataType:5121,width:this._size[c][0],height:this._size[c][1]},new Uint8Array(this._mosaicsData[c].buffer)));var d=this._textures[c];d.setSamplingMode(b);this._dirties[c]&&(d.setData(new Uint8Array(this._mosaicsData[c].buffer)),d.generateMipmap());a.bindTexture(d,f);this._dirties[c]=!1};f._copyBits=function(a,b,c,g,f,e,q,l,r,v,u){var d=g*b+c;q=l*e+q;if(u)for(q-=e,u=-1;u<=v;u++,d=((u+v)%v+g)*b+c,q+=e)for(l=-1;l<=
r;l++)f[q+l]=a[d+(l+r)%r];else for(u=0;u<v;u++){for(l=0;l<r;l++)f[q+l]=a[d+l];d+=b;q+=e}};f.prototype._copy=function(a){if(!(a.page>=this._mosaicsData.length)){var b=a.spriteData,c=this._mosaicsData[a.page];c&&b||console.error("Source or target images are uninitialized!");f._copyBits(b,a.spriteSize[0],0,0,c,a.pageSize[0],a.rect.x+1,a.rect.y+1,a.spriteSize[0],a.spriteSize[1],a.repeat);this._dirties[a.page]=!0}};f.prototype._allocateImage=function(d,g){d+=2;g+=2;var f=Math.max(d,g);if(this._maxItemSize&&
this._maxItemSize<f){var f=Math.pow(2,Math.ceil(c.log2(d))),e=Math.pow(2,Math.ceil(c.log2(g)));d=new a(0,0,d,g);this._mosaicsData.push(new Uint32Array(f*e));this._dirties.push(!0);this._size.push([f,e]);this._textures.push(void 0);return[d,this._mosaicsData.length-1,[f,e]]}f=this._binPack.allocate(d+(d%4?4-d%4:0),g+(g%4?4-g%4:0));return 0>=f.width?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*
this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new b(this._pageWidth,this._pageHeight),this._allocateImage(d,g)):[f,this._currentPage,[this._pageWidth,this._pageHeight]]};f.prototype._dispose=function(){this._binPack=null;this._mosaicRects.clear()};return f}()})},"esri/views/3d/support/imageUtils":function(){define(["require","exports","../../../request"],function(l,e,c){Object.defineProperty(e,"__esModule",{value:!0});
e.dataURItoBlob=function(a){var b=atob(a.split(",")[1]);a=a.split(",")[0].split(":")[1].split(";")[0];for(var c=new ArrayBuffer(b.length),f=new Uint8Array(c),d=0;d<b.length;d++)f[d]=b.charCodeAt(d);return new Blob([c],{type:a})};e.requestImage=function(a){return c(a,{responseType:"image",allowImageDataAccess:!0}).then(function(a){return a.data})}})},"esri/views/2d/engine/webgl/WGLRendererInfo":function(){define("require exports ../../../../core/screenUtils ../../../../geometry/support/scaleUtils ../../../../renderers/support/utils ./color ./Utils".split(" "),
function(l,e,c,a,b,g,f){function d(a,b){var c=b.length;if(a<b[0].value||1===c)return b[0].size;for(var d=1;d<c;d++)if(a<b[d].value)return b[d-1].size+(a-b[d-1].value)/(b[d].value-b[d-1].value)*(b[d].size-b[d-1].size);return b[c-1].size}return function(){function e(a){this.symbolLevels=[];this.vvColorValues=new Float32Array(8);this.vvColors=new Float32Array(32);this.vvOpacityValues=new Float32Array(8);this.vvOpacities=new Float32Array(8);this.vvSizeMinMaxValue=new Float32Array(4);this.vvSizeFieldStopsValues=
new Float32Array(6);this.vvSizeFieldStopsSizes=new Float32Array(6);this._vvMaterialParameters={vvSizeEnabled:!1,vvColorEnabled:!1,vvRotationEnabled:!1,vvRotationType:"geographic",vvOpacityEnabled:!1};this.symbolLevels.push(0)}Object.defineProperty(e.prototype,"vvMaterialParameters",{get:function(){return this._vvMaterialParameters},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"heatmapParameters",{get:function(){return this._heatmapParameters},enumerable:!0,configurable:!0});e.prototype.updateHeatmapParameters=
function(a){var b=a.blurRadius,c=Math.round(4.5*a.blurRadius),d=2*c+1;this._heatmapParameters||(this._heatmapParameters={radius:b,blurRadius:c,kernelSize:d,refreshIntensityKernel:!0,intensityKernel:null,color:null,maxPixelIntensity:a.maxPixelIntensity,minPixelIntensity:a.minPixelIntensity});for(var f=this._heatmapParameters,e=a.colorStops,h=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],k=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0],u,l=0;16>l;l++){var w=e[Math.min(l,e.length-1)];h[l]=w.ratio;u=4*l;k[u+0]=w.color[0]/255;k[u+1]=w.color[1]/255;k[u+2]=w.color[2]/255;k[u+3]=1<w.color[3]?w.color[3]/255:w.color[3];g.premultiplyAlpha(k,u,!0)}f.color={values:h,colors:k,refreshColorRamp:!0};1E-6<Math.abs(f.radius-a.radius)&&(f.radius=b,f.blurRadius=c,f.kernelSize=d,f.refreshIntensityKernel=!0);f.maxPixelIntensity=a.maxPixelIntensity;f.minPixelIntensity=a.minPixelIntensity};e.prototype.updateVisualVariables=function(g,e){var h=
this._vvMaterialParameters;h.vvOpacityEnabled=!1;h.vvSizeEnabled=!1;h.vvColorEnabled=!1;h.vvRotationEnabled=!1;if(g){var k=g.size;if(k){h.vvSizeEnabled=!0;if(k.minMaxValue){var m=k.minMaxValue,l=void 0,r=void 0;f.isDefined(m.minSize)&&f.isDefined(m.maxSize)&&(f.isNumber(m.minSize)&&f.isNumber(m.maxSize)?(l=c.pt2px(m.minSize),r=c.pt2px(m.maxSize)):(r=e.scale,l=c.pt2px(d(r,m.minSize.stops)),r=c.pt2px(d(r,m.maxSize.stops))));this.vvSizeMinMaxValue.set([m.minDataValue,m.maxDataValue,l,r])}k.scaleStops&&
(this.vvSizeScaleStopsValue=c.pt2px(d(e.scale,k.scaleStops.stops)));k.unitValue&&(this.vvSizeUnitValueToPixelsRatio=a.getMetersPerUnitForSR(e.spatialReference)/b.meterIn[k.unitValue.unit]/e.resolution);k.fieldStops&&(this.vvSizeFieldStopsValues.set(k.fieldStops.values),this.vvSizeFieldStopsSizes.set(k.fieldStops.sizes))}if(e=g.color)h.vvColorEnabled=!0,this.vvColorValues.set(e.values),this.vvColors.set(e.colors);if(e=g.opacity)h.vvOpacityEnabled=!0,this.vvOpacityValues.set(e.values),this.vvOpacities.set(e.opacities);
if(g=g.rotation)h.vvRotationEnabled=!0,h.vvRotationType=g.type}};return e}()})},"esri/views/2d/engine/webgl/WGLTile":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix/mat4 ../../../../core/libs/gl-matrix/vec2 ../DisplayObject ./DisplayRecordStore ./enums ./WGLBuffers ./WGLDisplayList ./WGLDisplayObject ./WGLDisplayRecord ../../tiling/TileKey".split(" "),function(l,e,c,a,b,g,f,d,k,h,m,n,p){function q(a,b){return a.sortKey-b.sortKey}var t=new Set;
return function(g){function e(c,f){var e=g.call(this)||this;e.tileStatus=d.TileStatus.INITIALIZED;e._data=null;e.hlDisplayList=null;e._wglBuffers=null;e.coords=[0,0];e.bounds=[0,0,0,0];e.tileTransform={transform:Float32Array[16],displayCoord:Float32Array[2]};e._hasVisualVariables=!1;e.tileTransform.transform=a.create();e.tileTransform.displayCoord=b.create();e.key=p.pool.acquire(c);e.coords[0]=f[0];e.coords[1]=f[3];e.bounds=f;return e}c(e,g);Object.defineProperty(e.prototype,"iconGeometry",{get:function(){return this.getGeometry(d.WGLGeometryType.MARKER)},
enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"textGeometry",{get:function(){return this.getGeometry(d.WGLGeometryType.TEXT)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"fillGeometry",{get:function(){return this.getGeometry(d.WGLGeometryType.FILL)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"lineGeometry",{get:function(){return this.getGeometry(d.WGLGeometryType.LINE)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,
"canDisplay",{get:function(){return!!this.attached&&!!this._data},enumerable:!0,configurable:!0});e.prototype.getGeometry=function(a){return this._wglBuffers&&this._wglBuffers.has(a)?this._wglBuffers.get(a):null};e.prototype.getDisplayList=function(a){switch(a){case d.WGLDrawPhase.HIGHLIGHT:return this.hlDisplayList;default:return this._data&&this._data.tileDisplayData.displayList}};Object.defineProperty(e.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0});e.prototype.setData=
function(a,b,c){c?(this.clear(),this.tileStatus=d.TileStatus.INVALID):a&&a.tileDisplayData?(this._dispRecStore=f.default.fromTileData(a),this._hasVisualVariables=b,this._geometryTypes=[d.WGLGeometryType.FILL,d.WGLGeometryType.LINE,d.WGLGeometryType.MARKER,d.WGLGeometryType.TEXT],this._data=a,this.tileStatus=this.tileStatus===d.TileStatus.READY||this.tileStatus===d.TileStatus.NO_DATA||this.tileStatus===d.TileStatus.INVALID?d.TileStatus.MODIFIED:d.TileStatus.READY):(this.clear(),this.tileStatus=d.TileStatus.NO_DATA)};
e.prototype.patchData=function(a){this._data&&(this.tileStatus=d.TileStatus.MODIFIED,this._patchData(a)||(this._data.reshuffle(),this._dispRecStore=f.default.fromTileData(this._data)),this.requestRender())};e.prototype.commitChanges=function(a){this._data&&this.tileStatus===d.TileStatus.MODIFIED&&(this._wglBuffers&&(35048!==this._wglBuffers.usage&&(this._wglBuffers.dispose(),this._wglBuffers=new k.default(35048)),this._wglBuffers.ensureBuffers(a.context,this._geometryTypes,this._hasVisualVariables),
this._wglBuffers.upload(this._data.tileBufferData,this._geometryTypes,["geometry","visibility"],!0)),this.tileStatus=d.TileStatus.READY)};e.prototype.setVisibility=function(a){if(this._data){t.clear();for(var b=0;b<a.length;b++){var c=a[b],d=this._data.tileDisplayData.displayObjectRegistry.get(c.id);if(d)for(var g=0,d=d.displayRecords;g<d.length;g++){var f=d[g];t.add(f.geometryType);var e=this._data.tileBufferData.geometries[f.geometryType];if(e.vertexBuffer.visibility)for(var e=e.vertexBuffer.visibility,
h=0;h<f.vertexCount;++h)e.data[(f.vertexFrom+h)*e.stride/4]=c.visibility?4294967295:0}}if(this._wglBuffers){var k=[];t.forEach(function(a){k.push(a)});this._wglBuffers.upload(this._data.tileBufferData,k,["visibility"],!1);this.requestRender()}}};e.prototype.clear=function(){this._data=null;this._wglBuffers&&(this._wglBuffers.dispose(),this._wglBuffers=null);this.hlDisplayList&&(this.hlDisplayList=null)};e.prototype.dispose=function(){this.clear()};e.prototype.attach=function(a){if(this.attached||
this.tileStatus===d.TileStatus.INVALID)return!0;if(this.tileStatus===d.TileStatus.INITIALIZED)return!1;this._wglBuffers||(this._wglBuffers=new k.default(35044));this._data&&(this._wglBuffers.ensureBuffers(a.context,this._geometryTypes,this._hasVisualVariables),this._wglBuffers.upload(this._data.tileBufferData,this._geometryTypes,["geometry","visibility"],!0));return!0};e.prototype.detach=function(a){g.prototype.detach.call(this,a)};e.prototype.doRender=function(a){var b=this;this.commitChanges(a);
a.context.setStencilTestEnabled(!0);a.context.setStencilFunction(514,this.stencilRef,255);a.painter.getBrushes(a.drawPhase).forEach(function(c){return c.draw(a,b)})};e.prototype.buildHLList=function(a){var b=this;this.hlDisplayList=new h;a.forEach(function(a){b._addToHLDisplayList(b.hlDisplayList,a)})};e.prototype._addToHLDisplayList=function(a,b){if(this._data){var c=this._data.tileDisplayData.displayObjectRegistry.get(b);if(c){b=[];for(var d=0,c=c.displayRecords;d<c.length;d++){var g=c[d],f=new n;
f.id=g.id;f.geometryType=g.geometryType;f.vertexFrom=g.vertexFrom;f.vertexCount=g.vertexCount;f.indexFrom=g.indexFrom;f.indexCount=g.indexCount;f.materialInfo=g.materialInfo;f.meshData=null;f.symbolLevel=0;f.zOrder=0;b.push(f)}b.sort(q);a.addToList(b)}}};e.prototype._patchData=function(a){for(var b=!0,c=0,d=a.remove||[];c<d.length;c++){var g=d[c],f=this._data.tileDisplayData.displayObjectRegistry.get(g);if(f){this._data.tileDisplayData.displayList.removeFromList(f.displayRecords);t.clear();for(var e=
0,f=f.displayRecords;e<f.length;e++){var h=f[e];t.add(h.geometryType);this._dispRecStore.delete(h)}this._data.tileDisplayData.displayObjectRegistry.delete(g)}}var k=[];a.addOrUpdate.tileDisplayData.displayObjectRegistry.forEach(function(a){k.push(a)});for(c=0;c<k.length;c++){d=k[c];if(f=this._data.tileDisplayData.displayObjectRegistry.get(d.id)){for(g=0;g<f.displayRecords.length;++g)if(e=f.displayRecords[g],h=d.displayRecords[g],g>=d.displayRecords.length||e.geometryType!==h.geometryType||e.symbolLevel!==
h.symbolLevel||e.zOrder!==h.zOrder||e.materialInfo.materialKey!==h.materialInfo.materialKey)this._dispRecStore.delete(f.displayRecords[g]),g<d.displayRecords.length&&(f.displayRecords[g]=void 0);f.displayRecords.length=d.displayRecords.length}else f=new m(d.id),this._data.tileDisplayData.displayObjectRegistry.set(d.id,f);for(g=0;g<d.displayRecords.length;++g){var h=d.displayRecords[g],e=f.displayRecords[g],p=h.geometryType;h.readMeshDataFromBuffers(a.addOrUpdate.tileBufferData.geometries[p].vertexBuffer,
a.addOrUpdate.tileBufferData.geometries[p].indexBuffer);if(e)e.meshData=h.meshData,e.materialInfo=h.materialInfo;else{var e=new n,l;for(l in h)e[l]=h[l];e.vertexFrom=void 0;e.indexFrom=void 0;f.displayRecords[g]=e}b=b&&this._dispRecStore.commit(e)}}return b};return e}(g)})},"esri/core/libs/gl-matrix/vec2":function(){define(["./common"],function(l){var e={create:function(){var c=new l.ARRAY_TYPE(2);c[0]=0;c[1]=0;return c},clone:function(c){var a=new l.ARRAY_TYPE(2);a[0]=c[0];a[1]=c[1];return a},fromValues:function(c,
a){var b=new l.ARRAY_TYPE(2);b[0]=c;b[1]=a;return b},copy:function(c,a){c[0]=a[0];c[1]=a[1];return c},set:function(c,a,b){c[0]=a;c[1]=b;return c},add:function(c,a,b){c[0]=a[0]+b[0];c[1]=a[1]+b[1];return c},subtract:function(c,a,b){c[0]=a[0]-b[0];c[1]=a[1]-b[1];return c}};e.sub=e.subtract;e.multiply=function(c,a,b){c[0]=a[0]*b[0];c[1]=a[1]*b[1];return c};e.mul=e.multiply;e.divide=function(c,a,b){c[0]=a[0]/b[0];c[1]=a[1]/b[1];return c};e.div=e.divide;e.ceil=function(c,a){c[0]=Math.ceil(a[0]);c[1]=Math.ceil(a[1]);
return c};e.floor=function(c,a){c[0]=Math.floor(a[0]);c[1]=Math.floor(a[1]);return c};e.min=function(c,a,b){c[0]=Math.min(a[0],b[0]);c[1]=Math.min(a[1],b[1]);return c};e.max=function(c,a,b){c[0]=Math.max(a[0],b[0]);c[1]=Math.max(a[1],b[1]);return c};e.round=function(c,a){c[0]=Math.round(a[0]);c[1]=Math.round(a[1]);return c};e.scale=function(c,a,b){c[0]=a[0]*b;c[1]=a[1]*b;return c};e.scaleAndAdd=function(c,a,b,g){c[0]=a[0]+b[0]*g;c[1]=a[1]+b[1]*g;return c};e.distance=function(c,a){var b=a[0]-c[0];
c=a[1]-c[1];return Math.sqrt(b*b+c*c)};e.dist=e.distance;e.squaredDistance=function(c,a){var b=a[0]-c[0];c=a[1]-c[1];return b*b+c*c};e.sqrDist=e.squaredDistance;e.length=function(c){var a=c[0];c=c[1];return Math.sqrt(a*a+c*c)};e.len=e.length;e.squaredLength=function(c){var a=c[0];c=c[1];return a*a+c*c};e.sqrLen=e.squaredLength;e.negate=function(c,a){c[0]=-a[0];c[1]=-a[1];return c};e.inverse=function(c,a){c[0]=1/a[0];c[1]=1/a[1];return c};e.normalize=function(c,a){var b=a[0],g=a[1],b=b*b+g*g;0<b&&
(b=1/Math.sqrt(b),c[0]=a[0]*b,c[1]=a[1]*b);return c};e.dot=function(c,a){return c[0]*a[0]+c[1]*a[1]};e.cross=function(c,a,b){a=a[0]*b[1]-a[1]*b[0];c[0]=c[1]=0;c[2]=a;return c};e.lerp=function(c,a,b,g){var f=a[0];a=a[1];c[0]=f+g*(b[0]-f);c[1]=a+g*(b[1]-a);return c};e.random=function(c,a){a=a||1;var b=2*l.RANDOM()*Math.PI;c[0]=Math.cos(b)*a;c[1]=Math.sin(b)*a;return c};e.transformMat2=function(c,a,b){var g=a[0];a=a[1];c[0]=b[0]*g+b[2]*a;c[1]=b[1]*g+b[3]*a;return c};e.transformMat2d=function(c,a,b){var g=
a[0];a=a[1];c[0]=b[0]*g+b[2]*a+b[4];c[1]=b[1]*g+b[3]*a+b[5];return c};e.transformMat3=function(c,a,b){var g=a[0];a=a[1];c[0]=b[0]*g+b[3]*a+b[6];c[1]=b[1]*g+b[4]*a+b[7];return c};e.transformMat4=function(c,a,b){var g=a[0];a=a[1];c[0]=b[0]*g+b[4]*a+b[12];c[1]=b[1]*g+b[5]*a+b[13];return c};e.forEach=function(){var c=e.create();return function(a,b,g,f,d,e){b||(b=2);g||(g=0);for(f=f?Math.min(f*b+g,a.length):a.length;g<f;g+=b)c[0]=a[g],c[1]=a[g+1],d(c,c,e),a[g]=c[0],a[g+1]=c[1];return a}}();e.str=function(c){return"vec2("+
c[0]+", "+c[1]+")"};e.exactEquals=function(c,a){return c[0]===a[0]&&c[1]===a[1]};e.equals=function(c,a){var b=c[0];c=c[1];var g=a[0];a=a[1];return Math.abs(b-g)<=l.EPSILON*Math.max(1,Math.abs(b),Math.abs(g))&&Math.abs(c-a)<=l.EPSILON*Math.max(1,Math.abs(c),Math.abs(a))};return e})},"esri/views/2d/engine/webgl/DisplayRecordStore":function(){define(["require","exports","dojo/has","./FreeList"],function(l,e,c,a){function b(a){a=a.getStrides();var b={},c;for(c in a)b[g[c]]=a[c];return b}Object.defineProperty(e,
"__esModule",{value:!0});var g=["FILL","LINE","MARKER","TEXT"];l=function(){function f(b,c,g){this._strides=b;this._displayList=c;this._vertexAlignments={};this._freeListsAndStorage={};for(var d in b){var f=c=!1;this._freeListsAndStorage[d]={vtxFreeList:g?new a.FreeList(g):null,idxFreeList:g?new a.FreeList(g):null,vertexBuffers:{},indexBuffer:g?new Uint32Array(g):null};for(var e in b[d])this._freeListsAndStorage[d].vertexBuffers[e]={data:g?new Uint32Array(Math.floor(g*b[d][e]/4)):null,stride:b[d][e]},
2===b[d][e]%4?c=!0:0!==b[d][e]%4&&(f=!0);this._vertexAlignments[d]=f?4:c?2:1}}f.fromTileData=function(c){var d=b(c),e=[0,0,0,0],m=[0,0,0,0],n=[];c.tileDisplayData.displayObjectRegistry.forEach(function(a){n.push(a)});for(var l=0;l<n.length;l++)for(var q=0,t=n[l].displayRecords;q<t.length;q++){var r=t[q];e[r.geometryType]=Math.max(e[r.geometryType],r.vertexFrom+r.vertexCount);m[r.geometryType]=Math.max(m[r.geometryType],r.indexFrom+r.indexCount)}d=new f(d,c.tileDisplayData.displayList,null);for(l=
0;l<c.tileBufferData.geometries.length;++l){var q=e[l],v=m[l],r=c.tileBufferData.geometries[l],t=d._storageFor(g[l]),u=c.tileBufferData.geometries[l].indexBuffer;t.indexBuffer=u;t.idxFreeList=new a.FreeList(u.length);t.idxFreeList.allocate(v);var v=void 0,y;for(y in r.vertexBuffer)r=c.tileBufferData.geometries[l].vertexBuffer[y],t.vertexBuffers[y].data=r.data,t.vertexBuffers[y].stride=r.stride,v=4*r.data.length/r.stride;t.vtxFreeList=new a.FreeList(v);t.vtxFreeList.allocate(q)}return d};f.prototype.delete=
function(a){var b=g[a.geometryType];this._freeVertices(b,a.vertexFrom,a.vertexCount);this._freeIndices(b,a.indexFrom,a.indexCount);this._displayList.removeFromList(a);a.vertexFrom=void 0;a.indexFrom=void 0};f.prototype.commit=function(a){var b=g[a.geometryType];if(!a.meshData)return!0;var c=a.meshData.vertexCount,d=a.meshData.indexData.length,f=a.vertexFrom,e=a.indexFrom,l=0,l=0,t=!1;void 0===a.vertexFrom?(l=this._align(b,c),f=this._allocateVertices(b,l),a.meshData.vertexCount=l,-1!==f&&(a.vertexFrom=
f,a.vertexCount=l)):c>a.vertexCount?(this._freeVertices(b,a.vertexFrom,a.vertexCount),l=this._align(b,c),f=this._allocateVertices(b,l),a.meshData.vertexCount=l,-1!==f&&(a.vertexFrom=f,a.vertexCount=l)):c!==a.vertexCount&&(this._freeVertices(b,a.vertexFrom+c,a.vertexCount-c),a.vertexCount=c);void 0===a.indexFrom?(t=!0,l=d,e=this._allocateIndices(b,l),-1!==e&&(a.indexFrom=e,a.indexCount=l)):d>a.indexCount?(t=!0,this._displayList.removeFromList(a),this._freeIndices(b,a.indexFrom,a.indexCount),l=d,e=
this._allocateIndices(b,l),-1!==e&&(a.indexFrom=e,a.indexCount=l)):d!==a.indexCount&&(t=!0,this._displayList.removeFromList(a),this._freeIndices(b,a.indexFrom+d,a.indexCount-d),a.indexCount=d);return-1!==f&&-1!==e?(b=this._storageFor(b),a.writeMeshDataToBuffers(a.vertexFrom,b.vertexBuffers,a.indexFrom,b.indexBuffer),a.meshData=null,t&&this._displayList.addToList(a),!0):!1};f.prototype._allocateVertices=function(a,b){a=this._storageFor(a);b=a.vtxFreeList.allocate(b);return-1===b||.5<a.vtxFreeList.fragmentation?
-1:b};f.prototype._freeVertices=function(a,b,g){var d=this._storageFor(a);d.vtxFreeList.free(b,g);if(c("esri-feature-tiles-debug"))for(var f in d.vertexBuffers)for(var e=d.vertexBuffers[f].data,h=this._stridesFor(a,f),k=b*h/4,h=g*h/4,l=k;l<k+h;++l)e[l]=0};f.prototype._freeIndices=function(a,b,g){a=this._storageFor(a);a.idxFreeList.free(b,g);if(c("esri-feature-tiles-debug")){a=a.indexBuffer;for(var d=b;d<b+g;++d)a[d]=0}};f.prototype._align=function(a,b){var c=b%this._vertexAlignments[a];return 0===
c?b:b+(this._vertexAlignments[a]-c)};f.prototype._allocateIndices=function(a,b){a=this._storageFor(a);b=a.idxFreeList.allocate(b);return-1===b||.5<a.idxFreeList.fragmentation?-1:b};f.prototype._storageFor=function(a){return this._freeListsAndStorage[a]};f.prototype._stridesFor=function(a,b){return this._strides[a][b]};return f}();e.default=l})},"esri/views/2d/engine/webgl/FreeList":function(){define(["require","exports"],function(l,e){Object.defineProperty(e,"__esModule",{value:!0});var c=function(){function a(a){this._largestRange=
null;this._parent=a;this._updateLargestRange()}Object.defineProperty(a.prototype,"largestRange",{get:function(){return this._largestRange},enumerable:!0,configurable:!0});a.prototype.rangeCreated=function(a){if(!this._largestRange||a.count>this._largestRange.count)this._largestRange=a};a.prototype.rangeResized=function(a,c,f){if(a===this._largestRange)a.count<f&&this._updateLargestRange();else if(!this._largestRange||a.count>this._largestRange.count)this._largestRange=a};a.prototype.findBestRange=
function(a){for(var b=this._parent._freeHead,c=null;null!==b;)b.count>=a&&(!c||b.count-a<c.count-a)&&(c=b),b=b.next;return c};a.prototype.findAdjacentRanges=function(a,c){for(var b=!0,d=!1,g=null,e=this._parent._freeHead;b&&!d;){var l=null!==e?e.from:this._parent._size;a>=(null!==g?g.from+g.count:0)&&a+c<=l?(b=!1,d=!0):null!==e?(g=e,e=e.next):b=!1}return[g,e]};a.prototype._updateLargestRange=function(){for(var a=null,c=this._parent._freeHead;null!==c;){if(!a||c.count>a.count)a=c;c=c.next}this._largestRange=
a};return a}();l=function(){function a(a,g){this._allocated=0;this._size=a;this._freeHead=0<a?{from:0,count:a,prev:null,next:null}:null;this._bookKeeper=g||new c(this);this._freeHead&&this._bookKeeper.rangeCreated(this._freeHead)}a.prototype.allocate=function(b){var c=this._bookKeeper.findBestRange(b);if(null===c)return-1;var f=c.from,d=c.count;c.from+=b;c.count-=b;this._bookKeeper.rangeResized(c,f,d);this._allocated+=b;0===c.count&&(b=null!==c.prev?this._freeHead:c.next,a._removeRange(c),this._freeHead=
b);return f};a.prototype.free=function(b,c){var f=this._bookKeeper.findAdjacentRanges(b,c),d=f[0],f=f[1];b={from:b,count:c,prev:d,next:f};null!==d&&(d.next=b);null!==f&&(f.prev=b);this._bookKeeper.rangeCreated(b);this._allocated-=c;if(null!==f&&b.from+b.count===f.from){c=b.from;var g=b.count;a._fuse(b,f);a._removeRange(f);this._bookKeeper.rangeResized(b,c,g);this._bookKeeper.rangeResized(f,void 0,0)}null!==d&&d.from+d.count===b.from&&(c=d.from,g=d.count,a._fuse(d,b),a._removeRange(b),this._bookKeeper.rangeResized(d,
c,g),this._bookKeeper.rangeResized(b,void 0,0));this._freeHead=null!==b.prev?this._freeHead:b};Object.defineProperty(a.prototype,"fragmentation",{get:function(){var a=this._size-this._allocated;return 0===a?0:1-this._bookKeeper.largestRange.count/a},enumerable:!0,configurable:!0});a._removeRange=function(a){null!==a.prev?null!==a.next?(a.prev.next=a.next,a.next.prev=a.prev):a.prev.next=null:null!==a.next&&(a.next.prev=null)};a._fuse=function(a,c){a.count+=c.count;a.next=c.next;c.from+=c.count;c.count=
0;null!==c.next&&(c.next.prev=a)};return a}();e.FreeList=l})},"esri/views/2d/engine/webgl/WGLBuffers":function(){define(["require","exports","./enums","./Utils","../../../webgl/BufferObject"],function(l,e,c,a,b){Object.defineProperty(e,"__esModule",{value:!0});var g=new a.KeysGetter;l=function(){function f(a){this._usage=a;this.geometryMap=new Map}f.prototype.dispose=function(){for(var a=0,b=g.getKeys(this.geometryMap);a<b.length;a++){var c=this.geometryMap.get(b[a]);c.vao&&c.vao.dispose();c.indexBuffer&&
c.indexBuffer.dispose();for(var f in c.vertexBufferMap)c.vertexBufferMap[f]&&c.vertexBufferMap[f].dispose()}this.geometryMap.clear()};Object.defineProperty(f.prototype,"usage",{get:function(){return this._usage},enumerable:!0,configurable:!0});f.prototype.ensureBuffers=function(d,f,e){for(var h=0,k=g.getKeys(this.geometryMap);h<k.length;h++){var l=k[h];if(-1===f.indexOf(l)){var q=this.geometryMap.get(l);q.vao&&q.vao.dispose();q.indexBuffer&&q.indexBuffer.dispose();for(var t in q.vertexBufferMap)q.vertexBufferMap[t]&&
q.vertexBufferMap[t].dispose()}this.geometryMap["delete"](l)}for(h=0;h<f.length;h++){l=f[h];k=void 0;this.geometryMap.has(l)?(k=this.geometryMap.get(l),k.vao&&(k.vao.dispose(),k.vao=null)):(k={vertexBufferMap:{},indexBuffer:null,vao:null},this.geometryMap.set(l,k));q=void 0;l===c.WGLGeometryType.FILL?q=e?a.C_FILL_VERTEX_NAMES_VV:a.C_FILL_VERTEX_NAMES:l===c.WGLGeometryType.LINE?q=e?a.C_LINE_VERTEX_NAMES_VV:a.C_LINE_VERTEX_NAMES:l===c.WGLGeometryType.MARKER?q=e?a.C_ICON_VERTEX_NAMES_VV:a.C_ICON_VERTEX_NAMES:
l===c.WGLGeometryType.TEXT&&(q=e?a.C_TEXT_VERTEX_NAMES_VV:a.C_TEXT_VERTEX_NAMES);for(var r in k.vertexBufferMap)-1===q.indexOf(r)&&k.vertexBufferMap[r]&&(k.vertexBufferMap[r].dispose(),k.vertexBufferMap[r]=null);for(l=0;l<q.length;l++)t=q[l],k.vertexBufferMap[t]||(k.vertexBufferMap[t]=b.createVertex(d,this._usage));k.indexBuffer||(k.indexBuffer=b.createIndex(d,this._usage))}};f.prototype.get=function(a){return this.geometryMap.get(a)};f.prototype.has=function(a){return this.geometryMap.has(a)};f.prototype.upload=
function(a,b,c,f){for(var d=0;d<b.length;d++){var e=b[d],g=this.geometryMap.get(e);if(g){if(f){var h=a.geometries[e].indexBuffer.buffer;g.indexBuffer&&0<h.byteLength&&g.indexBuffer.setData(h)}for(var h=0,k=c;h<k.length;h++){var l=k[h],m=a.geometries[e].vertexBuffer[l];m&&(m=m.data.buffer,g.vertexBufferMap[l]&&0<m.byteLength&&g.vertexBufferMap[l].setData(m))}}}};return f}();e.default=l})},"esri/views/2d/engine/webgl/passes/WGLPaintPassHeatmap":function(){define("require exports dojo/text!../shaders/heatmapShaders.xml ../../../../webgl/BufferObject ../../../../webgl/FramebufferObject ../../../../webgl/Program ../../../../webgl/ShaderSnippets ../../../../webgl/Texture ../../../../webgl/VertexArrayObject".split(" "),
function(l,e,c,a,b,g,f,d,k){Object.defineProperty(e,"__esModule",{value:!0});l=function(){function e(){this._initWGLExtensions=this._initialized=!1}e.prototype.preRender=function(a,b){console.log("Heatmap: Running prerender");a=a.context;b=a.getViewport();this._bindHeatmapSurface(a,b.width,b.height)};e.prototype.postRender=function(a,b){console.log("Heatmap: Running postrender");this._drawHeatmap(a.context,a.rendererInfo,1)};e.prototype._bindHeatmapSurface=function(a,c,e){if(!this._initWGLExtensions){var f=
a.gl.getSupportedExtensions();if(-1===f.indexOf("OES_texture_float_linear")||-1===f.indexOf("WEBGL_color_buffer_float"))throw Error("Required WebGL extensions needed for the heatmap drawing are not available!");a.gl.getExtension("OES_texture_float_linear");a.gl.getExtension("WEBGL_color_buffer_float");this._initWGLExtensions=!0}c=Math.round(c/4);e=Math.round(e/4);this._intensityFBO&&this._intensityFBO.width===c&&this._intensityFBO.height===e||(this._intensityFBO&&this._intensityFBO.dispose(),f=new d(a,
{target:3553,internalFormat:34836,pixelFormat:6408,dataType:5126,samplingMode:9729,wrapMode:33071,width:c,height:e}),this._intensityFBO=b.createWithAttachments(a,f,{colorTarget:0,depthStencilTarget:3,width:c,height:e,multisampled:!1}));this._boundFBO=a.getBoundFramebufferObject();a.bindFramebuffer(this._intensityFBO);this._prevVP=a.getViewport();a.setViewport(0,0,c,e);a.setStencilWriteMask(255);a.setClearColor(0,0,0,0);a.setClearStencil(0);a.clear(a.gl.COLOR_BUFFER_BIT|a.gl.STENCIL_BUFFER_BIT)};e.prototype._drawHeatmap=
function(a,b,c){a.bindFramebuffer(this._boundFBO);this._boundFBO=null;a.setViewport(this._prevVP.x,this._prevVP.y,this._prevVP.width,this._prevVP.height);this._initialized||(this._initialized=this._initialize(a));a.setBlendFunctionSeparate(1,771,1,771);a.setBlendingEnabled(!0);a.bindVAO(this._vertexArrayObject);a.bindProgram(this._program);a.bindTexture(this._intensityFBO.colorTexture,2);this._program.setUniform1i("u_texture",2);this._program.setUniform1f("u_opacity",c);b=b.heatmapParameters;this._updateGradient(a,
b);this._program.setUniform2f("u_minmax",b.minPixelIntensity,b.maxPixelIntensity);a.setActiveTexture(5);a.bindTexture(this._gradientTex,5);this._program.setUniform1i("u_gradient",5);a.drawArrays(5,0,4);a.bindVAO()};e.prototype._initialize=function(b){if(this._initialized)return!0;var d={a_pos:0,a_tex:1};this._shaderSnippets=new f;f.parse(c,this._shaderSnippets);var e=new g(b,this._shaderSnippets.heatmapVS,this._shaderSnippets.heatmapFS,d);if(!e)return!1;var h=new Int8Array(16);h[0]=-1;h[1]=-1;h[2]=
0;h[3]=0;h[4]=1;h[5]=-1;h[6]=1;h[7]=0;h[8]=-1;h[9]=1;h[10]=0;h[11]=1;h[12]=1;h[13]=1;h[14]=1;h[15]=1;b=new k(b,d,{geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:4,normalized:!1,divisor:0},{name:"a_tex",count:2,type:5120,offset:2,stride:4,normalized:!1,divisor:0}]},{geometry:a.createVertex(b,35044,h)});this._program=e;this._vertexArrayObject=b;return this._initialized=!0};e.prototype._updateGradient=function(a,b){if(!this._gradientTex||b.color.refreshColorRamp){this._gradientTex&&(this._gradientTex.dispose(),
this._gradientTex=null);this._gradientTex=new d(a,{target:3553,internalFormat:6408,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:1,height:512});a=document.createElement("CANVAS");a.width=1;a.height=512;for(var c=a.getContext("2d"),e=b.color,f=[],g=0;g<e.values.length;++g)f.push({ratio:e.values[g],color:"rgba("+Math.floor(255*e.colors[4*g+0])+", "+Math.floor(255*e.colors[4*g+1])+", "+Math.floor(255*e.colors[4*g+2])+", "+e.colors[4*g+3]+")"});e=c.createLinearGradient(0,0,0,512);
for(g=0;g<f.length;g++){var h=f[g];e.addColorStop(h.ratio,h.color)}c.fillStyle=e;c.fillRect(0,0,1,512);this._gradientTex.setData(a);b.color.refreshColorRamp=!1}};return e}();e.default=l})},"esri/views/2d/layers/support/FeatureLayerProxy":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../../../../geometry ../../../../core/Accessor ../../../../core/Promise ../../../../core/promiseUtils ../../../../core/requireUtils ../../../../core/workers ../../../../core/accessorSupport/decorators ../../../../tasks/support/FeatureSet ./util module".split(" "),
function(l,e,c,a,b,g,f,d,k,h,m,n,p,q,t){Object.defineProperty(e,"__esModule",{value:!0});b=function(b){function d(a){return b.call(this,a)||this}c(d,b);d.prototype.initialize=function(){var a=this;this.addResolvingPromise(m.open(h.getAbsMid("../features/Pipeline",l,t),{client:this.client,strategy:"dedicated"}).then(function(b){a._connection=b;return a._getStartupOptions(a.layer,a.tileInfo)}).then(function(b){return Array.isArray(b.service.source)?a._connection.invoke("startup",b,b.service.source):
a._connection.invoke("startup",b)}))};d.prototype.destroy=function(){this._connection&&this._connection.close()};d.prototype.configure=function(a){return this._connection.invoke("configure",a)};d.prototype.registerTile=function(a){return this._connection.invoke("registerTile",a.id)};d.prototype.unregisterTile=function(a){return this._connection.invoke("unregisterTile",a.id)};d.prototype.setViewState=function(a){return this._connection.invoke("controller.setViewState",a.toJSON())};d.prototype.queryFeatures=
function(a){return this._connection.invoke("controller.queryFeatures",a.toJSON()).then(function(a){return p.fromJSON(a)}).then(function(a){return a&&a.features})};d.prototype.queryObjectIds=function(a){return this._connection.invoke("controller.queryObjectIds",a.toJSON())};d.prototype.queryFeatureCount=function(a){return this._connection.invoke("controller.queryFeatureCount",a.toJSON())};d.prototype.queryExtent=function(a){return this._connection.invoke("controller.queryExtent",a.toJSON()).then(function(a){return{count:a.count,
extent:g.Extent.fromJSON(a.extent)}})};d.prototype._getStartupOptions=function(a,b){var c=a.source;return c&&"esri.layers.graphics.sources.CSVSource"===c.declaredClass?c.openPorts().then(function(c){return{service:{capabilities:a.capabilities,fields:a.fields.map(function(a){return a.toJSON()}),fullExtent:a.fullExtent.toJSON(),geometryType:q.toJSONGeometryType(a.geometryType),objectIdField:a.objectIdField,source:c},tileInfo:b.toJSON()}}):k.resolve({service:{capabilities:a.capabilities,fields:a.fields.map(function(a){return a.toJSON()}),
fullExtent:a.fullExtent.toJSON(),geometryType:q.toJSONGeometryType(a.geometryType),objectIdField:a.objectIdField,source:a.url+"/"+a.layerId},tileInfo:b.toJSON()})};a([n.property({constructOnly:!0})],d.prototype,"client",void 0);a([n.property({constructOnly:!0})],d.prototype,"layer",void 0);a([n.property({constructOnly:!0})],d.prototype,"tileInfo",void 0);return d=a([n.subclass()],d)}(n.declared(f,d));e.default=b})},"esri/core/requireUtils":function(){define(["require","exports","dojo/Deferred"],function(l,
e,c){function a(b,e){if(Array.isArray(e)){var f=new c;b(e,function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];f.resolve(a)});return f.promise}return a(b,[e]).then(function(a){return a[0]})}Object.defineProperty(e,"__esModule",{value:!0});e.when=a;e.getAbsMid=function(a,c,e){return c.toAbsMid?c.toAbsMid(a):e.id.replace(/\/[^\/]*$/ig,"/")+a}})},"esri/views/2d/layers/support/util":function(){define(["require","exports","../../../../core/kebabDictionary","./StaticControllerConfigurator"],
function(l,e,c,a){Object.defineProperty(e,"__esModule",{value:!0});e.createDefaultControllerConfigurator=function(b){return new a(b)};var b=c({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});e.toJSONGeometryType=function(a){return b.toJSON(a)}})},"esri/views/2d/layers/support/StaticControllerConfigurator":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Error ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators".split(" "),
function(l,e,c,a,b,g,f,d){return function(b){function e(){return null!==b&&b.apply(this,arguments)||this}c(e,b);e.prototype.updateControllerConfiguration=function(){var a=this,b=this.layerView.layer,c=b.source;return c&&"esri.layers.graphics.sources.CSVSource"===c.declaredClass?f.resolve().then(function(){a._set("controllerConfiguration",{type:"memory",processing:b.processing&&b.processing.toWorker()||null})}):this._checkSupport().then(function(){a._set("controllerConfiguration",{type:"on-demand",
gdbVersion:b.gdbVersion,historicMoment:b.historicMoment&&b.historicMoment.getTime(),processing:b.processing&&b.processing.toWorker()||null})})};e.prototype._checkSupport=function(){var a=this;return this.layerView.layer.source.parsedUrl?this.layerView.layer.when(function(){a._verifyCapabilities()}):f.reject()};e.prototype._verifyCapabilities=function(){if(!this.layerView.layer.capabilities.operations.supportsQuery)throw new g("graphicscontroller:query-capability-required","Service requires query capabilities to be used as a feature layer",
{layer:this.layerView.layer});};a([d.property()],e.prototype,"layerView",void 0);a([d.property({readOnly:!0})],e.prototype,"controllerConfiguration",void 0);return e=a([d.subclass("esri.views.2d.layers.support.StaticControllerConfigurator")],e)}(d.declared(b))})},"url:esri/views/2d/engine/webgl/shaders/heatmapShaders.xml":'\x3csnippets\x3e\r\n  \x3csnippet name\x3d"heatmapVS"\x3e\r\n  \x3c![CDATA[\r\n    attribute vec2 a_pos;\r\n    attribute vec2 a_tex;\r\n\r\n    uniform mediump vec2 u_minmax;\r\n\r\n    varying mediump vec2 v_uv;\r\n    varying mediump float v_slope;\r\n\r\n    void main(void) {\r\n      gl_Position \x3d vec4(a_pos, 0.0, 1.0);\r\n      v_uv \x3d a_tex;\r\n      v_slope \x3d 1.0 / (u_minmax.y - u_minmax.x);\r\n    }\r\n  ]]\x3e\r\n  \x3c/snippet\x3e\r\n\r\n  \x3csnippet name\x3d"heatmapFS"\x3e\r\n  \x3c![CDATA[\r\n    \tprecision mediump float;\r\n\r\n      uniform lowp sampler2D u_texture;\r\n      uniform lowp float u_opacity;\r\n      uniform mediump vec2 u_minmax;\r\n      uniform lowp sampler2D u_gradient;\r\n\r\n      varying mediump vec2 v_uv;\r\n      varying mediump float v_slope;\r\n\r\n      vec4 getColor(float intensity) {\r\n        float normalizedIntensity \x3d clamp((intensity - u_minmax.x) * v_slope, 0.0, 1.0);\r\n\r\n        return texture2D(u_gradient, vec2(0.5, normalizedIntensity));\r\n      }\r\n\r\n      void main() {\r\n      // sample the intnsity value\r\n        lowp vec4 color \x3d texture2D(u_texture, v_uv);\r\n\r\n        // interpolate the color from the ramp using the intensity value\r\n        gl_FragColor \x3d getColor(color.r) *  u_opacity;\r\n      }\r\n  ]]\x3e\r\n  \x3c/snippet\x3e\r\n\x3c/snippets\x3e\r\n',
"*noref":1}});
define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/paramHelper dojo/has ../../../Graphic ../../../core/Collection ../../../core/Error ../../../core/Handles ../../../core/promiseUtils ../../../core/throttle ../../../core/accessorSupport/decorators ../../../core/accessorSupport/ensureType ../../../layers/support/TileInfo ../../../tasks/support/Query ../engine/DOMContainer ../engine/webgl/rendererInfoUtils ../engine/webgl/WGLFeatureView ./LayerView2D ./support/FeatureLayerProxy ./support/util ../tiling/TileInfoView ../tiling/TileKey ../tiling/TileStrategy ../../layers/RefreshableLayerView".split(" "),function(l,
e,c,a,b,g,f,d,k,h,m,n,p,q,t,r,v,u,y,w,A,I,E,z,B,x){function F(a){return a&&a.highlight}var J=q.ensureType(r);return function(b){function e(){var a=null!==b&&b.apply(this,arguments)||this;a._handles=new h;a._tiles=new Map;a._autoConf=I.createDefaultControllerConfigurator({layerView:a});a._pipelineIsUpdating=!0;a._setViewStateThrottled=n.throttle(a._setViewState,50,a);a.container=new v;return a}c(e,b);e.prototype.destroy=function(){this._proxy.destroy();this._tiles.clear()};e.prototype.initialize=function(){var a=
this,b=this._tileInfo=t.create({spatialReference:this.view.spatialReference,size:512});this._tileInfoView=new E(b);this._tileStrategy=new B({cachePolicy:"purge",acquireTile:function(b){return a._acquireTile(b)},releaseTile:function(b){return a._releaseTile(b)},tileInfoView:this._tileInfoView});this._proxy=new A.default({layer:this.layer,tileInfo:b,client:{setTileVisuals:function(b){var c=a._tiles.get(b.tileKey);c&&(a.featuresView.setTileVisuals(c,b.data,b.error),a.requestUpdate())},patchTileVisuals:function(b){var c=
a._tiles.get(b.tileKey);c&&(a.featuresView.patchTileVisuals(c,b.data),a.requestUpdate());return m.resolve({data:{},transferList:[]})},executeProcessing:function(b){var c=a.layer.processing;return c?(b=c.process(b.featureSet,b.query,c.options))?b:m.reject(new k("FeatureLayer","invalid processing.process() method, returns nothing")):b.featureSet},setUpdating:function(b){a._pipelineIsUpdating=b;a.notifyChange("updating")},getMaterialItems:function(b){return a.featuresView.getMaterialItems(b)}}});this.addResolvingPromise(this._proxy.when())};
Object.defineProperty(e.prototype,"numFeatures",{get:function(){var a=0;this.attached?this._tileStrategy.tiles.forEach(function(b){a+=b.iconDisplayRecords?b.iconDisplayRecords.length:0}):0;return a},enumerable:!0,configurable:!0});e.prototype.highlight=function(a,b){var c=this,e;a instanceof f?e=[a.getAttribute(this.layer.objectIdField)]:"number"===typeof a?e=[a]:d.isCollection(a)?e=a.map(function(a){return a&&a.getAttribute(c.layer.objectIdField)}).toArray():Array.isArray(a)&&0<a.length&&(e="number"===
typeof a[0]?a:a.map(function(a){return a&&a.getAttribute(c.layer.objectIdField)}));return(e=e.filter(function(a){return null!=a}))&&e.length&&F(this.featuresView)?this.featuresView.highlight(e):{remove:function(){}}};e.prototype.hitTest=function(a,b){var c=this;return this.suspended||!this.featuresView?m.resolve(null):this.featuresView.hitTest(a,b).then(function(a){return 0===a.length?null:c._proxy.queryFeatures(new r({objectIds:a,outSpatialReference:c.view.spatialReference,returnGeometry:!0})).then(function(a){a=
a[0];a.layer=c.layer;a.sourceLayer=c.layer;a.geometry&&(a.geometry.spatialReference=c.view.spatialReference);return a})})};e.prototype.queryFeatures=function(a){var b=this;return this._proxy.queryFeatures(this._cleanUpQuery(a)).then(function(a){a.forEach(function(a){a.layer=b.layer;a.sourceLayer=b.layer});return a})};e.prototype.queryObjectIds=function(a){return this._proxy.queryObjectIds(this._cleanUpQuery(a))};e.prototype.queryFeatureCount=function(a){return this._proxy.queryFeatureCount(this._cleanUpQuery(a))};
e.prototype.queryExtent=function(a){return this._proxy.queryExtent(this._cleanUpQuery(a))};e.prototype.update=function(a){this.attached&&this._tileStrategy&&this.featuresView&&this._tileStrategy.update(a);var b=this.featuresView;b&&b.update&&this.featuresView.update(a);this._setViewStateThrottled(a);this.notifyChange("numFeatures");this.notifyChange("updating")};e.prototype.attach=function(){this._watchForChanges()};e.prototype.detach=function(){this._setViewStateThrottled.remove();this.container.removeAllChildren();
this._handles.removeAll();this.featuresView&&(this.featuresView.uninstall(this.container),this.featuresView=null);this._tileStrategy&&(this._tileStrategy.destroy(),this._tileStrategy=null)};e.prototype.moveStart=function(){this.requestUpdate()};e.prototype.viewChange=function(){this.requestUpdate()};e.prototype.moveEnd=function(){this.requestUpdate()};e.prototype.doRefresh=function(){var a=this;this._reconfigure().then(function(){a.requestUpdate()})};e.prototype.isUpdating=function(){var a=!0;this._tiles.forEach(function(b){a=
a&&b.attached});return this._pipelineIsUpdating||!a};e.prototype._cleanUpQuery=function(a){a=a?J(a):new r;a.outSpatialReference||(a.outSpatialReference=this.view.spatialReference);return a};e.prototype._watchForChanges=function(){var a=this;this._autoConf.updateControllerConfiguration().then(function(){var b=a._createFeatureView(a.layer.renderer);a._switchFeatureView(b,!0)});var b=this.layer.renderer,c=this.layer.definitionExpression,d=this.layer.outFields;this._handles.add(this.layer.watch("renderer,definitionExpression,outFields,historicMoment",
function(){var e=b!==a.layer.renderer,f=c!==a.layer.definitionExpression,g;a:if(g=a.layer.outFields,d.length!==g.length)g=!1;else{for(var h=d.length,k=0;k<h;++k)if(d[k]!==g[k]){g=!1;break a}g=!0}f||!g?e?a._handleRendererChangeAndPossiblyReconfigureController(a.layer.renderer,b,!0):a._reconfigure():e&&a._handleRendererChangeAndPossiblyReconfigureController(a.layer.renderer,b,!1);b=a.layer.renderer;c=a.layer.definitionExpression;d=a.layer.outFields}))};e.prototype._acquireTile=function(a){var b=this.featuresView.acquireTile(a);
this._tiles.set(a.id,b);this._proxy.registerTile(a);return b};e.prototype._releaseTile=function(a){this._proxy.unregisterTile(a.key);this._tiles.delete(a.key.id);this.featuresView.releaseTile(a)};e.prototype._canUseWebGL=function(){return g("esri-featurelayer-webgl")&&g("esri-webgl")&&u.isRendererWebGLCompatible(this.layer.renderer)&&(this.layer.capabilities.query.supportsQuantization&&("polygon"!==this.layer.geometryType||this.layer.capabilities.query.supportsCentroid)||this.layer.source&&"esri.layers.graphics.sources.CSVSource"===
this.layer.source.declaredClass)};e.prototype._handleRendererChangeAndPossiblyReconfigureController=function(a,b,c){var d=this;if(this.featuresView)if(this.featuresView.supports(a))this.featuresView.renderSwitchFrom(b)?(this._tiles.forEach(function(a,b){d.featuresView.setTileVisuals(a,null,null);d.featuresView.removeChild(a);a.attached=!1;d.featuresView.addChild(a)}),c?this._reconfigure().then(function(){d.requestUpdate()}):this._reconfigureProcessor().then(function(){d.requestUpdate()})):c?this._reconfigureController().then(function(){d.requestUpdate()}):
this.requestUpdate();else{var e=this._createFeatureView(a);this._tiles.forEach(function(a,b){d.featuresView.releaseTile(a);a=e.acquireTile(new z(b));d._tiles.set(b,a)});this._switchFeatureView(e,c)}else c&&this._reconfigureController().then(function(){d.requestUpdate()})};e.prototype._createFeatureView=function(a){var b=this;return this._canUseWebGL()?new y({tileInfoView:this._tileInfoView,layer:this.layer,view:this.view,requestUpdate:function(){return b.requestUpdate()}}):null};e.prototype._switchFeatureView=
function(a,b){var c=this;this.featuresView&&(this.featuresView.uninstall(this.container),this.featuresView=null);b=b?{controller:this._autoConf.controllerConfiguration,processor:a.getProcessorConfiguration()}:{processor:a.getProcessorConfiguration()};this._proxy.configure(b).then(function(){a.install(c.container);c.featuresView=a;c.featuresView.renderInit();c.requestUpdate()})};e.prototype._setViewState=function(a){this._proxy.setViewState(a.state)};e.prototype._reconfigure=function(){var a={controller:this._autoConf.controllerConfiguration,
processor:this.featuresView.getProcessorConfiguration()};return this._proxy.configure(a).then(function(){})};e.prototype._reconfigureProcessor=function(){var a={processor:this.featuresView.getProcessorConfiguration()};return this._proxy.configure(a).then(function(){})};e.prototype._reconfigureController=function(){return this._proxy.configure({controller:this._autoConf.controllerConfiguration}).then(function(){})};a([p.property()],e.prototype,"numFeatures",null);a([p.property()],e.prototype,"updating",
void 0);a([p.property()],e.prototype,"featuresView",void 0);return e=a([p.subclass("esri.views.2d.layers.AutoFeatureLayerView2D")],e)}(p.declared(w,x))});