// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.7/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../../core/SetPool"],function(x,y,w){return function(){function p(a,e,f,c,h,b,m,l){this._glyphItems=a;this._maxWidth=e;this._lineHeight=f;this._letterSpacing=c;this._offset=h;this._hAnchor=b;this._vAnchor=m;this._justify=l}p.prototype.getShaping=function(a,e){for(var f=this._letterSpacing,c=this._offset[0],h=this._offset[1],b=[],m=w.acquire(),l=a.length,d=0;d<l;d++){var g=a.charCodeAt(d);if(10===g)m.add(b.length);else{for(var k=void 0,t=0,n=this._glyphItems;t<n.length&&
!(k=n[t][g]);t++);k&&(b.push({codePoint:g,x:c,y:h,glyphMosaicItem:k}),c+=k.metrics.advance+f)}}if(0<b.length){k=this._maxWidth;a=this._lineHeight;c=this._justify;h=b.length;g=l=f=0;if(0!==k||0<m.size)for(var q=0,d=t=0;d<h;d++){n=b[d];n.x-=t;n.y=e?n.y-a*f:n.y+a*f;var p=m.has(d);if(k&&n.x>k&&0<q||p){for(var u=p?d:q+1,v=b[u].x,g=Math.max(v,g),r=u;r<=d;r++)b[r].y=e?b[r].y-a:b[r].y+a,b[r].x-=v;c&&(q=p?d-1:q-1,0<=q&&this._applyJustification(b,l,q));l=u;q=0;t+=v;f++}32===n.codePoint&&(q=d)}d=b[h-1];g=Math.max(g,
d.x+d.glyphMosaicItem.metrics.advance);c&&this._applyJustification(b,l,h-1);d=(c-this._hAnchor)*g;c=(-this._vAnchor*(f+1)+.5)*a;e&&f&&(c+=f*a);for(e=0;e<b.length;e++)a=b[e],a.x+=d,a.y+=c}w.release(m);return b};p.getBox=function(a,e){var f=a.length;if(0!==f){for(var c=a[0].x,h=c,b=a[0].y,m=b,l=b,d=1;d<f;d++){var g=a[d],k=g.x;k<c&&(c=k);k>h&&(h=k);g=g.y;g<b&&(b=g);g>m&&(m=g);g!==l&&(l=this._glyphWidth(a[d-1].codePoint,e),h=Math.max(h,a[d-1].x+l),l=g)}e=this._glyphWidth(a[f-1].codePoint,e);h=Math.max(h,
a[f-1].x+e);b+=17;return{x:c,y:b,width:h-c,height:m+7-b}}};p.prototype._applyJustification=function(a,e,f){for(var c=a[f],c=(c.x+c.glyphMosaicItem.metrics.advance)*this._justify;e<=f;e++)a[e].x-=c};p._glyphWidth=function(a,e){for(var f,c=0;c<e.length&&!(f=e[c][a]);c++);return f?f.metrics.advance:0};return p}()});