// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.7/esri/copyright.txt for details.
//>>built
define("require exports ./color ./LineTess ./MeshData ./number ./TileClipper ./Utils ./visualVariablesUtils".split(" "),function(ga,X,ba,a,ca,J,da,ea,fa){function Y(r,g,h,K,z){"butt"===z?q.buttCap(r,g,h):"round"===z?q.roundCap(r,g,h,K,a.getNumberOfSlices(Math.PI),K===a.CapPosition.START?-1:1):"square"===z?q.squareCap(r,g,h,K):(q.buttCap(r,g,h),console.error("Unknown cap type!"))}function U(a,g,h,q,z,x,F,c,G,k,C,H){var r=0,d;for(d=0;d<C.vectors.count;++d){var D=C.vectors.items[d].vector[0],A=C.vectors.items[d].vector[1],
t=C.vectors.items[d].texCoords[0],v=C.vectors.items[d].texCoords[1],n=C.vectors.items[d].direction[0],p=C.vectors.items[d].direction[1],f=G+r;++r;H.push(J.i1616to32(a,g),F,q,J.i8888to32(Math.round(31*D),Math.round(31*A),Math.round(31*t),Math.round(31*v)),J.i1616to32(h,31*c),J.i1616to32(z[0],z[1]),J.i1616to32(x[0],x[1]),J.i8888to32(Math.round(31*n),Math.round(31*p),0,0));k&&H.push(k.size,k.color,k.opacity);C.vectors.items[d].base={index:f,point:[a,g]}}return r}function Z(a,g,h){q.bridge(Q,a,g);for(a=
0;a<Q.count;++a)g=Q.items[a],h.push(g.v1.base.index,g.v2.base.index,g.v3.base.index)}Object.defineProperty(X,"__esModule",{value:!0});var q=new a.Tessellator({distanceAlongCorrection:!0}),R=new Float32Array(1),V=new Uint32Array(R.buffer),S=[a.allocExtrudeVectors(),a.allocExtrudeVectors()],aa=a.allocExtrudeVectors(),Q=a.allocTriangles(20),W=a.allocTriangles(20),N=new da.TileClipper(0,0,0,1,8);N.setExtent(512);X.createLineMeshData=function(r,g,h,K,z,x,F){var c=null!=K?K.spriteMosaicItem:null,G=x.geometry,
k=!ea.isPictureSymbol(F)&&F.color?ba.copyAndPremultiply(F.color):[255,255,255,1];K=J.numTo32(r);z=0<F.width?.5*(F.width+1/z):0;F=null!=c;var C=h.vvColor||h.vvOpacity||h.vvSizeMinMaxValue||h.vvSizeScaleStops||h.vvSizeFieldStops||h.vvSizeUnitValue,H=0,M=0,d=0;C&&(d=g.vvFields,H=d.opacity?g.getValue(x,d.opacity):0,M=d.color?g.getValue(x,d.color):0,d=d.size&&!h.vvSizeScaleStops?g.getValue(x,d.size):0,h.vvSizeUnitValue&&(d=fa.getVisualVariableSizeValueRepresentationRatio(d,g.vvRanges.size.unitValue.valueRepresentation)),
isNaN(d)&&(d=1),isNaN(H)&&(H=1),isNaN(M)&&(M=1),R[0]=d,d=V[0],R[0]=H,H=V[0],R[0]=M,M=V[0]);g=J.i8888to32(k[0],k[1],k[2],k[3]);h=[0,0];x=[0,0];if(c){var k=c.rect.x,D=c.rect.y,A=c.width,c=c.height;h[0]=k+1;h[1]=D+1;x[0]=k+1+A;x[1]=D+1+c}for(var k=G.rings||G.paths,G=[],D=k.length,A=0,t=!1;A<D;){var v=k[A],c=[];N.reset(2);var n=v[0][0],p=v[0][1];if(t)N.moveTo(n,p);else{if(-8>n||520<n||-8>p||520<p){t=!0;continue}c.push({x:n,y:p})}for(var f=!1,L=v.length,u=1;u<L;++u)if(n+=v[u][0],p+=v[u][1],t)N.lineTo(n,
p);else{if(-8>n||520<n||-8>p||520<p){f=!0;break}c.push({x:n,y:p})}if(f)t=!0;else{if(t){if(t=N.resultWithStarts())for(c=0;c<t.length;c++)G.push(t[c])}else G.push({line:c,start:0});A++;t=!1}}k=0;D=[];A=[];for(t=0;t<G.length;t++)if(p=G[t],c=p.line,!(2>c.length))for(var v=c.length,f=c[0],L=c[v-1],n=L.x-f.x,f=L.y-f.y,n=1E-6>n*n+f*f,I=p.start%65535,p=S[1],f=void 0,L=C?{size:d,color:M,opacity:H}:null,f=0;f<v;++f){var E=c[f],u=p===S[f%2]?S[(f+1)%2]:S[f%2];if(f<v-1||!n||F){a:{var l=u,m=f,y=c,w=v,T=n,B=y[m],
b=[void 0,void 0],e=[void 0,void 0];if(0<m&&m<w-1){var O=y[(m+w-1)%w],P=y[(m+1)%w];a.normalize(b,[B.x-O.x,B.y-O.y]);a.normalize(e,[P.x-B.x,P.y-B.y])}else if(0===m)P=y[(m+1)%w],a.normalize(e,[P.x-B.x,P.y-B.y]),T?(y=y[w-2],a.normalize(b,[B.x-y.x,B.y-y.y])):b=e;else if(m===w-1)O=y[(m+w-1)%w],a.normalize(b,[B.x-O.x,B.y-O.y]),T?(y=y[1],a.normalize(e,[y.x-B.x,y.y-B.y])):e=b;else{console.error("Vertex index 'i' out of range.");break a}T||0!==m?T||m!==w-1?(m=a.getRads(b,e),m>Math.PI-.05?q.rectJoin(l,b,e):
.1>m?.05>m?q.fastMiterJoin(l,b,e):m<a.MITER_SAFE_RADS?q.miterJoin(l,b,e):q.bevelJoin(l,b,e,a.SYSTEM_MAG_LIMIT):(w=a.getNumberOfSlices(m),2.3>m?2>w||.5>m?q.bevelJoin(l,b,e,1):q.roundJoin(l,b,e,w):q.unitRoundJoin(l,b,e,w))):Y(l,b,e,a.CapPosition.END,"round"):Y(l,b,e,a.CapPosition.START,"round")}k+=U(E.x,E.y,I,g,h,x,K,z,k,L,u,D);if(u.capCenter&&(!n||f!==v-1))for(e=A,q.pie(W,u),b=void 0,b=0;b<W.count;++b)l=W.items[b],e.push(l.v1.base.index,l.v2.base.index,l.v3.base.index);n&&0===f&&!F&&a.copyExtrudeVectors(aa,
u)}else a.copyExtrudeVectors(u,aa);0<f&&Z(p,u,A);f<v-1&&(b=c[f+1],e=[b.x-E.x,b.y-E.y],l=a.length(e),e=[e[0]/l,e[1]/l],l=I+l,65535<l?(m=(65535-I)/(l-I),I=E.x+(b.x-E.x)*m,E=E.y+(b.y-E.y)*m,b=p,q.buttCap(b,e,e),k+=U(I,E,65535,g,h,x,r,z,k,L,b,D),q.bridge(Q,u,b),Z(u,b,A),q.buttCap(b,e,e),k+=U(I,E,0,g,h,x,r,z,k,L,b,D),I=l-65535):(I=l,p=u))}r=new ca;r.update({geometry:D},k,A);return r}});