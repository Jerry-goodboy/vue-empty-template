// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.7/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/screenUtils ./color ./enums ./Geometry ./MaterialInfoUtils ./MeshData ./number ./SymbolProperties ./TextShaping ./visualVariablesUtils ./WGLDisplayRecord".split(" "),function(U,L,G,M,N,x,J,O,c,R,S,T,P){Object.defineProperty(L,"__esModule",{value:!0});var B=[],Q=c.i8888to32(255,255,255,255);L.createTextDisplayRecords=function(g,C,K,m,q,r){B.length=0;var h=C.symbol;q=q.get(h);if(!q.glyphMosaicItems||0===q.glyphMosaicItems.length)return B;var u=h.text;q=(new S([q.glyphMosaicItems],
240,24,0,[24*r.offsetX,24*r.offsetY],r.hAnchor,r.vAnchor,.5)).getShaping(u,!1);if(!q||0===q.length)return B;C=C.vv;var u=c.numTo32(K),k=J.createTextMaterialInfo(q[0].glyphMosaicItem,C).materialKeyInfo,b=0,f=0,p=0,d=0,v=k.vvColor||k.vvOpacity||k.vvRotation||k.vvSizeMinMaxValue||k.vvSizeScaleStops||k.vvSizeFieldStops||k.vvSizeUnitValue;v&&(b=m.vvFields,p=b.rotation?m.getValue(g,b.rotation):0,f=b.opacity?m.getValue(g,b.opacity):0,d=b.color?m.getValue(g,b.color):0,b=b.size&&!k.vvSizeScaleStops?m.getValue(g,
b.size):0,k.vvSizeUnitValue&&(b=T.getVisualVariableSizeValueRepresentationRatio(b,m.vvRanges.size.unitValue.valueRepresentation)),isNaN(b)&&(b=1),isNaN(p)&&(p=1),isNaN(f)&&(f=1),isNaN(d)&&(d=1),b=c.toUint32(b),f=c.toUint32(f),p=c.toUint32(p),d=c.toUint32(d));m=[b,d,f,p];g=g.centroid||g.geometry;var k=g.x,d=g.y,y,D,E;g=M.copyAndPremultiply(h.color);b=M.copyAndPremultiply(h.haloColor);g=c.i8888to32(g[0],g[1],g[2],g[3]);var H=c.i8888to32(b[0],b[1],b[2],b[3]),b=[G.pt2px(h.xoffset),G.pt2px(h.yoffset)],
k=k+b[0],d=d+b[1],b=h.font.size,h=10*(null!=h.haloSize?G.pt2px(G.toPt(h.haloSize)):0);if(0<h)for(var I=c.i1616to32(2*k+1,2*d),p=0;p<q.length;p++){var e=q[p],a=[],F=[],n=e.glyphMosaicItem,f=Math.round(n.rect.x/4);y=Math.round(n.rect.y/4);D=f+Math.round(n.rect.width/4);E=y+Math.round(n.rect.height/4);var l=e.x+0+n.metrics.left,e=e.y+-17-n.metrics.top,l=new x.Point(l-4,e-4),e=new x.Point(l.x+n.rect.width,l.y+n.rect.height),z=new x.Point(l.x,e.y),A=new x.Point(e.x,l.y);if(0!==r.angle){var t=Math.cos(r.angle),
w=Math.sin(r.angle);l.rotate(t,w);e.rotate(t,w);z.rotate(t,w);A.rotate(t,w)}t=J.createTextMaterialInfo(n,C);n=new O;a.push(I);a.push(u);a.push(H);a.push(c.i1616to32(32*l.x,32*l.y));a.push(c.i8888to32(f,y,b,h));v&&a.push.apply(a,m);a.push(I);a.push(u);a.push(H);a.push(c.i1616to32(32*A.x,32*A.y));a.push(c.i8888to32(D,y,b,h));v&&a.push.apply(a,m);a.push(I);a.push(u);a.push(H);a.push(c.i1616to32(32*z.x,32*z.y));a.push(c.i8888to32(f,E,b,h));v&&a.push.apply(a,m);a.push(I);a.push(u);a.push(H);a.push(c.i1616to32(32*
e.x,32*e.y));a.push(c.i8888to32(D,E,b,h));v&&a.push.apply(a,m);F.push(Q);n.update({geometry:a,visibility:F},4,[0,1,2,1,3,2]);f=new P;f.setData(K,N.WGLGeometryType.TEXT,n,t,0,0);B.push(f)}k=c.i1616to32(2*k,2*d);for(p=0;p<q.length;p++)e=q[p],a=[],F=[],d=e.glyphMosaicItem,f=Math.round(d.rect.x/4),y=Math.round(d.rect.y/4),D=f+Math.round(d.rect.width/4),E=y+Math.round(d.rect.height/4),l=e.x+0+d.metrics.left,e=e.y+-17-d.metrics.top,l=new x.Point(l-4,e-4),e=new x.Point(l.x+d.rect.width,l.y+d.rect.height),
z=new x.Point(l.x,e.y),A=new x.Point(e.x,l.y),0!==r.angle&&(t=Math.cos(r.angle),w=Math.sin(r.angle),l.rotate(t,w),e.rotate(t,w),z.rotate(t,w),A.rotate(t,w)),d=J.createTextMaterialInfo(d,C),n=new O,a.push(k),a.push(u),a.push(g),a.push(c.i1616to32(32*l.x,32*l.y)),a.push(c.i8888to32(f,y,b,h)),v&&a.push.apply(a,m),a.push(k),a.push(u),a.push(g),a.push(c.i1616to32(32*A.x,32*A.y)),a.push(c.i8888to32(D,y,b,h)),v&&a.push.apply(a,m),a.push(k),a.push(u),a.push(g),a.push(c.i1616to32(32*z.x,32*z.y)),a.push(c.i8888to32(f,
E,b,h)),v&&a.push.apply(a,m),a.push(k),a.push(u),a.push(g),a.push(c.i1616to32(32*e.x,32*e.y)),a.push(c.i8888to32(D,E,b,h)),v&&a.push.apply(a,m),F.push(Q),n.update({geometry:a,visibility:F},4,[0,1,2,1,3,2]),f=new P,f.setData(K,N.WGLGeometryType.TEXT,n,d,0,0),B.push(f);R.TextProperties.pool.release(r);return B}});