// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.7/esri/copyright.txt for details.
//>>built
define("require exports dojo/has ../../../../core/screenUtils ../../../../core/libs/earcut/earcut ../../../../core/libs/libtess/libtess ./color ./enums ./lineMeshUtil ./MeshData ./number ./TileClipper ./Utils ./visualVariablesUtils".split(" "),function(M,N,oa,pa,qa,e,I,ra,qb,Ra,a,rb,Sa,sb){function Ta(p,n,c,r,k,e,q){r=c.slice(r,k);c=p.length/(q.length+1);e=qa(r,e,2);k=e.length;if(0>=k)return 0;for(var m=0;m<r.length;)p.push(a.i1616to32(r[m++],r[m++])),p.push.apply(p,q);for(p=0;p<k;)n.push(e[p++]+
c,e[p++]+c,e[p++]+c)}Object.defineProperty(N,"__esModule",{value:!0});var k=[],O=[],q,tb=function(){function a(){this._indexCounter=this._currentVertexIndex=0;this._triangleIndices=[-1,-1,-1];this.glu=new e.GluTesselator;this.glu.gluTessCallback(e.gluEnum.GLU_TESS_BEGIN,this._begincallback.bind(this));this.glu.gluTessCallback(e.gluEnum.GLU_TESS_VERTEX_DATA,this._vertexCallback.bind(this));this.glu.gluTessCallback(e.gluEnum.GLU_TESS_END,this._endcallback.bind(this));this.glu.gluTessCallback(e.gluEnum.GLU_TESS_COMBINE,
this._combinecallback.bind(this));this.glu.gluTessCallback(e.gluEnum.GLU_TESS_ERROR,this._errorcallback.bind(this));this.glu.gluTessCallback(e.gluEnum.GLU_TESS_EDGE_FLAG,this._edgeCallback.bind(this));this.glu.gluTessProperty(e.gluEnum.GLU_TESS_WINDING_RULE,e.windingRule.GLU_TESS_WINDING_ODD)}a.prototype.beginPolygon=function(a,c){this._triangleIndices[0]=-1;this._triangleIndices[1]=-1;this._triangleIndices[2]=-1;this._indexCounter=this._currentVertexIndex=0;this.glu.gluTessBeginPolygon(a);this._indices=
c};a.prototype.endPolygon=function(){this.glu.gluTessEndPolygon()};a.prototype.beginContour=function(){this.glu.gluTessBeginContour()};a.prototype.endContour=function(){this.glu.gluTessEndContour()};a.prototype.addVertex=function(a,c){this.glu.gluTessVertex(a,c)};a.prototype._vertexCallback=function(a,c){c[c.length]=a[0];c[c.length]=a[1];this._triangleIndices[this._currentVertexIndex]=-1;if(2<=this._currentVertexIndex){for(a=0;3>a;a++)-1===this._triangleIndices[a]&&(this._triangleIndices[a]=this._indexCounter++),
this._indices[this._indices.length]=this._triangleIndices[a];this._currentVertexIndex=0}else this._currentVertexIndex++};a.prototype._begincallback=function(a){this._triangleIndices[0]=-1;this._triangleIndices[1]=-1;this._triangleIndices[2]=-1;this._currentVertexIndex=0};a.prototype._endcallback=function(){this._currentVertexIndex=0};a.prototype._errorcallback=function(a){};a.prototype._combinecallback=function(a,c,e){return[a[0],a[1],a[2]]};a.prototype._edgeCallback=function(a){};return a}();M=oa("esri-featurelayer-webgl");
var Ua="libtess"===(M&&M.tesselator||"libtess"),t;N.createTextMesh=function(a,e,c,k,q,t,I){return null};N.createMesh=function(e,n,c,r,M,N,oa,m,f){switch(M){case ra.WGLGeometryType.MARKER:var p=new Ra,P,Q,Y,Z,Va=0,Wa=0,J,A,sa,ta,aa,K=n.heatmapInfo;if(K){var Xa=Math.round(n.heatmapInfo.radius);Q=P=0;Z=Y=Xa;J=[1,1,1,1];A=[0,0,0,0];ta=sa=Xa;aa=0}else{var ba=r.spriteMosaicItem;P=Math.round(ba.rect.x/4);Q=Math.round(ba.rect.y/4);Y=P+Math.round(ba.rect.width/4);Z=Q+Math.round(ba.rect.height/4);var Va=f.xoffset|
0,Wa=f.yoffset|0,qa=f.color?f.color:[0,0,0,0];J=Sa.isPictureSymbol(f)?[255,255,255,255]:I.copyAndPremultiply(qa);sa=Math.round(pa.pt2px(f.width||f.size));ta=Math.round(pa.pt2px(f.height||f.size));f.outline?(A=null!=f.outline.color?I.copyAndPremultiply(f.outline.color):[0,0,0,0],aa=null!=f.outline.width?Math.round(pa.pt2px(f.outline.width)):0):(A=[0,0,0,0],aa=0)}var b=[],ca=a.i8888to32(J[0],J[1],J[2],J[3]),da=a.i8888to32(A[0],A[1],A[2],A[3]),ea=a.i8888to32(sa,ta,aa,0),fa=a.numTo32(e),Ya=0,Za=0,$a=
0,ab=0,R=0,S=c.vvColor||c.vvOpacity||c.vvRotation||c.vvSizeMinMaxValue||c.vvSizeScaleStops||c.vvSizeFieldStops||c.vvSizeUnitValue;if(S){var x=n.vvFields,ua=x.rotation?n.getValue(m,x.rotation):0,va=x.opacity?n.getValue(m,x.opacity):0,wa=x.color?n.getValue(m,x.color):0,T=x.size&&!c.vvSizeScaleStops?n.getValue(m,x.size):0;c.vvSizeUnitValue&&(T=sb.getVisualVariableSizeValueRepresentationRatio(T,n.vvRanges.size.unitValue.valueRepresentation));isNaN(T)&&(T=1);isNaN(ua)&&(ua=1);isNaN(va)&&(va=1);isNaN(wa)&&
(wa=1);Ya=a.toUint32(T);Za=a.toUint32(va);$a=a.toUint32(ua);ab=a.toUint32(wa)}var ga=[Ya,ab,Za,$a];K&&(R=a.toUint32(n.heatmapInfo.getIntensity(m)));var B=m.centroid||m.geometry,C;switch(N){case "esriGeometryPoint":C=[[B.x,B.y]];break;case "esriGeometryMultipoint":C=B.points;break;case "esriGeometryPolyline":C=B.paths[0];break;case "esriGeometryPolygon":C=m.centroid?[[B.x,B.y]]:B.rings[0]}for(var y=0,D,xa=0,ya=0,E=Array(4*C.length),ha=0;ha<C.length;ha++){var bb=C[ha],cb=bb[0],db=bb[1],ia=a.i1616to32(cb+
xa+Va,db+ya+Wa),xa=xa+cb,ya=ya+db;b.push(ia);b.push(a.i8888to32(-32,-32,P,Q));b.push(fa);b.push(ca);b.push(da);b.push(ea);S?b.push.apply(b,ga):K&&b.push(R);b.push(ia);b.push(a.i8888to32(32,-32,Y,Q));b.push(fa);b.push(ca);b.push(da);b.push(ea);S?b.push.apply(b,ga):K&&b.push(R);b.push(ia);b.push(a.i8888to32(-32,32,P,Z));b.push(fa);b.push(ca);b.push(da);b.push(ea);S?b.push.apply(b,ga):K&&b.push(R);b.push(ia);b.push(a.i8888to32(32,32,Y,Z));b.push(fa);b.push(ca);b.push(da);b.push(ea);S?b.push.apply(b,
ga):K&&b.push(R);D=6*ha;E[D+0]=y+0;E[D+1]=y+1;E[D+2]=y+2;E[D+3]=y+1;E[D+4]=y+3;E[D+5]=y+2;y+=4}p.update({geometry:b},y,E);return p;case ra.WGLGeometryType.FILL:var za;a:{var ja=null!=r?r.spriteMosaicItem:null,Aa=m.geometry,eb=Sa.isPictureSymbol(f),fb;fb=eb?I.premultiplyAlphaUint32(I.white):f.color?I.premultiplyAlphaUint32(f.color):0;var ub=c.vvColor||c.vvOpacity,gb=new Ra,Ba=0,Ca=0,Da=0,Ea=0;if(ja)var hb=ja.rect,ib=hb.x,jb=hb.y,vb=ja.width,wb=ja.height,Ba=ib+1,Ca=jb+1,Da=ib+1+vb,Ea=jb+1+wb;var xb=
eb&&f.width&&f.height?a.i8888to32(a.nextHighestPowerOfTwo(f.width),a.nextHighestPowerOfTwo(f.height),0,0):a.i8888to32(a.nextHighestPowerOfTwo(Da-Ba),a.nextHighestPowerOfTwo(Ea-Ca),0,0),U=[a.numTo32(e),fb,a.i1616to32(Ba,Ca),a.i1616to32(Da,Ea),xb];if(ub){var ka=n.vvFields,Fa=ka.opacity?n.getValue(m,ka.opacity):0,Ga=ka.color?n.getValue(m,ka.color):0;isNaN(Fa)&&(Fa=1);isNaN(Ga)&&(Ga=1);U.push(a.toUint32(Ga),a.toUint32(Fa))}for(var z=!1,Ha=0,kb=Aa.rings;Ha<kb.length;Ha++){var d=kb[Ha],V=d.length;if(!(3>
V)){var W=d[0][0],X=d[0][1];if(-8>W||520<W||-8>X||520<X){z=!0;break}for(var g=1;g<V;++g)if(W+=d[g][0],X+=d[g][1],-8>W||520<W||-8>X||520<X){z=!0;break}if(z)break}}var L,l,h;if(z){q||(q=new rb.TileClipper(0,0,0,1,8),q.setExtent(512));q.reset(3);for(var Ia=0,lb=Aa.rings;Ia<lb.length;Ia++)if(d=lb[Ia],V=d.length,!(3>V)){l=d[0][0];h=d[0][1];q.moveTo(l,h);for(g=1;g<V;++g)l+=d[g][0],h+=d[g][1],q.lineTo(l,h);q.close()}L={rings:q.result(!Ua)};if(!L.rings||0===L.rings.length){za=null;break a}}else L=Aa;var F=
[],la=[],u,v;if(Ua){t||(t=new tb);t.beginPolygon(k,la);for(var Ja=0,mb=L.rings;Ja<mb.length;Ja++)if(d=mb[Ja],!(3>d.length)){t.beginContour();u=v=0;z?(l=d[0].x,h=d[0].y):(Ka=d[0],l=Ka[0],h=Ka[1]);var nb=[l,h,0];t.addVertex(nb,nb);for(g=1;g<d.length-1;g++){z?(l=d[g].x,h=d[g].y):(La=d[g],u=La[0],v=La[1],l+=u,h+=v);var ob=[l,h,0];t.addVertex(ob,ob)}t.endContour()}t.endPolygon();for(var ma=0;ma<k.length;ma+=2)F.push(a.i1616to32(k[ma],k[ma+1])),F.push.apply(F,U)}else{for(var G=0,w=0,Ma=void 0,Na=void 0,
Oa=0,pb=L.rings;Oa<pb.length;Oa++){var d=pb[Oa],H=w;z?(l=d[0].x,h=d[0].y):(Pa=d[0],l=Pa[0],h=Pa[1]);k[w++]=l;k[w++]=h;var na=0;u=v=0;for(g=1;g<d.length;++g)z?(Ma=d[g].x,Na=d[g].y,u=Ma-l,v=Na-h,na-=u*(h+h+v),l=Ma,h=Na):(Qa=d[g],u=Qa[0],v=Qa[1],na-=u*(h+h+v),l+=u,h+=v),k[w++]=l,k[w++]=h;0<na?(0<H-G&&(Ta(F,la,k,G,H,O,U),G=H),O.length=0):0>na?0<H-G?O.push(.5*(H-G)):w=H:w=H}0<w-G&&Ta(F,la,k,G,w,O,U)}k.length=O.length=0;gb.update({geometry:F},F.length/(U.length+1),la);za=gb;break a;var Ka,La,Pa,Qa}return za;
case ra.WGLGeometryType.LINE:return qb.createLineMeshData(e,n,c,r,oa,m,f)}return null}});