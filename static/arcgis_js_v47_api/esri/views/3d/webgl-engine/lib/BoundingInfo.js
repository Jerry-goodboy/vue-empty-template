// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.7/esri/copyright.txt for details.
//>>built
define(["require","exports","./gl-matrix","./Util"],function(y,z,x,l){var m=x.vec3d;return function(){function f(c,h,f,d){l.assert(1<=c.length);l.assert(0===f.length%h);l.assert(f.length>=c.length*h);l.assert(3===d.size||4===d.size);this.primitiveIndices=c;this.indices=f;this._position=d;this._numIndexPerPrimitive=h;var a=d.data,k=d.offsetIdx;d=d.strideIdx;var r=c.length,b=k+d*f[h*c[0]];this.bbMin=m.createFrom(a[b],a[b+1],a[b+2]);this.bbMax=m.create(this.bbMin);for(var g=0;g<r;++g)for(var n=h*c[g],
e=0;e<h;++e)b=k+d*f[n+e],this.bbMin[0]=Math.min(a[b],this.bbMin[0]),this.bbMax[0]=Math.max(a[b],this.bbMax[0]),++b,this.bbMin[1]=Math.min(a[b],this.bbMin[1]),this.bbMax[1]=Math.max(a[b],this.bbMax[1]),++b,this.bbMin[2]=Math.min(a[b],this.bbMin[2]),this.bbMax[2]=Math.max(a[b],this.bbMax[2]);this.center=m.create();this.bsRadius=0;m.lerp(this.bbMin,this.bbMax,.5,this.center);for(g=0;g<r;++g)for(n=h*c[g],e=0;e<h;++e){var b=k+d*f[n+e],p=a[b]-this.center[0],q=a[b+1]-this.center[1],b=a[b+2]-this.center[2];
this.bsRadius=Math.max(p*p+q*q+b*b,this.bsRadius)}this.bsRadius=Math.sqrt(this.bsRadius)}f.prototype.getCenter=function(){return this.center};f.prototype.getBSRadius=function(){return this.bsRadius};f.prototype.getBBMin=function(){return this.bbMin};f.prototype.getBBMax=function(){return this.bbMax};f.prototype.getPrimitiveIndices=function(){return this.primitiveIndices};f.prototype.getIndices=function(){return this.indices};f.prototype.getPosition=function(){return this._position};f.prototype.getChildren=
function(){if(this.children)return this.children;if(1<m.dist2(this.bbMin,this.bbMax)){for(var c=m.lerp(this.bbMin,this.bbMax,.5,m.create()),h=this.primitiveIndices.length,l=new Uint8Array(h),d=Array(8),a=0;8>a;++a)d[a]=0;for(var a=this._position,k=a.data,r=a.offsetIdx,b=a.strideIdx,a=0;a<h;++a){for(var g=0,n=this._numIndexPerPrimitive*this.primitiveIndices[a],e=r+b*this.indices[n],p=k[e],q=k[e+1],t=k[e+2],u=1;u<this._numIndexPerPrimitive;++u){var e=r+b*this.indices[n+u],v=k[e],w=k[e+1],e=k[e+2];v<
p&&(p=v);w<q&&(q=w);e<t&&(t=e)}p<c[0]&&(g|=1);q<c[1]&&(g|=2);t<c[2]&&(g|=4);l[a]=g;++d[g]}for(a=c=0;8>a;++a)0<d[a]&&++c;if(2>c)return;c=Array(8);for(a=0;8>a;++a)c[a]=0<d[a]?new Uint32Array(d[a]):void 0;for(a=0;8>a;++a)d[a]=0;for(a=0;a<h;++a)g=l[a],c[g][d[g]++]=this.primitiveIndices[a];this.children=Array(8);for(a=0;8>a;++a)void 0!==c[a]&&(this.children[a]=new f(c[a],this._numIndexPerPrimitive,this.indices,this._position))}return this.children};return f}()});