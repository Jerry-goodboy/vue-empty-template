// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.7/esri/copyright.txt for details.
//>>built
define(["require","exports","./gl-matrix"],function(Z,d,e){function A(a,b){if(!a)throw a=Error("dummy"),a.stack&&console.log(a.stack),new I(b);}function n(a,b,c){return a<b?b:a>c?c:a}function B(a){return a/180*Math.PI}function C(a){return 180*a/Math.PI}function J(a,b,c){e.mat4d.multiply(b,a,D);e.mat4d.inverse(D);for(a=0;8>a;++a)e.mat4d.multiplyVec4(D,S[a],g),e.vec3d.set3(g[0]/g[3],g[1]/g[3],g[2]/g[3],c[a])}function r(a,b,c,f){e.vec3d.subtract(a,b,E);e.vec3d.subtract(c,b,K);e.vec3d.cross(K,E,f);e.vec3d.normalize(f);
f[3]=-e.vec3d.dot(f,a)}function L(a,b,c,f){var k=6378137/Math.sqrt(1-d.ECCENTRICITY_SQUARED*Math.pow(Math.sin(a),2)),e=Math.cos(a);f[0]=(k+c)*Math.cos(b)*e;f[1]=(k*(1-d.ECCENTRICITY_SQUARED)+c)*Math.sin(a);f[2]=-(k+c)*Math.sin(b)*e}function M(a){for(var b in a)return b}function N(a,b){a[12]=b[0];a[13]=b[1];a[14]=b[2]}function O(a,b){void 0===b&&(b=0);for(var c=0,f=0;4>f;f++)c+=a[b+f]*T[f];return c}function U(a){return a-Math.floor(a)}Object.defineProperty(d,"__esModule",{value:!0});var D=e.mat4d.create(),
S=[e.vec4d.createFrom(-1,-1,-1,1),e.vec4d.createFrom(1,-1,-1,1),e.vec4d.createFrom(1,1,-1,1),e.vec4d.createFrom(-1,1,-1,1),e.vec4d.createFrom(-1,-1,1,1),e.vec4d.createFrom(1,-1,1,1),e.vec4d.createFrom(1,1,1,1),e.vec4d.createFrom(-1,1,1,1)],g=e.vec4d.create(),V=[e.vec3d.create(),e.vec3d.create(),e.vec3d.create(),e.vec3d.create(),e.vec3d.create(),e.vec3d.create(),e.vec3d.create(),e.vec3d.create()],E=e.vec3d.create(),K=e.vec3d.create(),P=e.vec3d.create(),p=e.vec3d.create(),h=e.vec3d.create(),l=e.vec3d.create(),
x=e.vec3d.create(),y=e.vec3d.create(),F=e.vec3d.create(),G=e.vec3d.create(),v=e.vec3d.create(),q=e.vec3d.create(),w=e.vec3d.create(),z=e.vec3d.create(),W=e.vec3d.createFrom(0,0,0),I=function(){function a(a){this.message=a}a.prototype.toString=function(){return"AssertException: "+this.message};return a}();d.AssertException=I;d.EARTH_RADIUS=6378137;d.METER2FEET=3.28084;d.ECCENTRICITY_SQUARED=.0066943799901414;d.VertexAttrConstants={POSITION:"position",NORMAL:"normal",NORMALCOMPRESSED:"normalCompressed",
UV0:"uv0",AUXPOS1:"auxpos1",AUXPOS2:"auxpos2",COLOR:"color",SYMBOLCOLOR:"symbolColor",SIZE:"size",REGION:"region",COMPONENTINDEX:"componentIndex"};d.assert=A;d.verify=function(a,b){a||(console.log("Verify failed: "+b),console.log(Error("dummy").stack))};d.isPowerOfTwo=function(a){return 0===(a&a-1)};d.lerp=function(a,b,c){return a+(b-a)*c};d.clamp=n;d.encodeInt16=function(a){return n(Math.round(32767*a),-32767,32767)};d.encodeNormal=function(a,b){var c=Math.abs(a[0]),f=Math.abs(a[1]),k=1/(c+f+Math.abs(a[2])),
c=c*k,f=f*k,k=Math.min(a[2]*k,0);b[0]=Q(a[0])*(c-k);b[1]=Q(a[1])*(f-k)};var Q="function"===typeof Math.sign?Math.sign:function(a){return+(0<a)-+(0>a)||0};d.fallbackIfUndefined=function(a,b){return void 0===a?b:a};d.hex2rgb=function(a){a=Math.floor(a);return[(a>>16&255)/255,(a>>8&255)/255,(a&255)/255]};d.rgb2hex=function(a){var b=n(Math.round(255*a[0]),0,255),c=n(Math.round(255*a[1]),0,255);a=n(Math.round(255*a[2]),0,255);return"0x"+((b<<16)+(c<<8)+a).toString(16)};d.dec2hex=function(a){a=a.toString(16);
return"00000000".substr(0,8-a.length)+a};d.deg2rad=B;d.rad2deg=C;d.azimuthElevationAngle2Direction=function(a,b){a=1.5*Math.PI-a;b=.5*Math.PI-b;return[Math.cos(a)*Math.sin(b),Math.cos(b),Math.sin(a)*Math.sin(b)]};d.rayPlane=function(a,b,c,f){var k=e.vec3d.dot(c,b);if(0===k)return!1;c=-(e.vec3d.dot(c,a)+c[3])/k;e.vec3d.add(a,e.vec3d.scale(b,c,f),f);return!0};d.raySphere=function(a,b,c,f,k){c=c||W;var d=e.vec3d.subtract(a,c,E);c=e.vec3d.dot(b,b);var m=2*e.vec3d.dot(b,d);f=e.vec3d.dot(d,d)-f*f;f=m*m-
4*c*f;if(0>f)return!1;d=Math.sqrt(f);f=(-m-d)/(2*c);c=(-m+d)/(2*c);if(0>f||c<f&&0<c)f=c;return 0<f?(e.vec3d.add(a,e.vec3d.scale(b,f,z),k),!0):!1};d.rayTriangle3D=function(a,b,c,f,k,d,m,t,g){void 0===g&&(g=e.vec3d.create());var u=f[m]-c[d],h=f[m+1]-c[d+1],l=f[m+2]-c[d+2];f=k[t]-c[d];m=k[t+1]-c[d+1];k=k[t+2]-c[d+2];var n=b[1]*k-m*b[2],q=b[2]*f-k*b[0],p=b[0]*m-f*b[1];t=u*n+h*q+l*p;if(-1E-5<t&&1E-5>t)return!1;t=1/t;var H=a[0]-c[d],r=a[1]-c[d+1];a=a[2]-c[d+2];g[1]=t*(H*n+r*q+a*p);if(0>g[1]||1<g[1])return!1;
c=r*l-h*a;a=a*u-l*H;u=H*h-u*r;g[2]=t*(b[0]*c+b[1]*a+b[2]*u);if(0>g[2]||1<g[1]+g[2])return!1;g[0]=t*(f*c+m*a+k*u);return!0};d.rayBoxTest=function(a,b,c,f){var d,e=(c[0]-a[0])/b[0],m=(f[0]-a[0])/b[0];e>m&&(d=e,e=m,m=d);var g=(c[1]-a[1])/b[1],h=(f[1]-a[1])/b[1];g>h&&(d=g,g=h,h=d);if(e>h||g>m)return!1;g>e&&(e=g);h<m&&(m=h);c=(c[2]-a[2])/b[2];a=(f[2]-a[2])/b[2];c>a&&(d=c,c=a,a=d);if(e>a||c>m)return!1;a<m&&(m=a);return 0>m?!1:!0};d.rayRay2D=function(a,b,c,f,d,g){void 0===g&&(g=e.vec2d.create());var k=(f[d]-
c[d])*(b[0]-a[0])-(f[0]-c[0])*(b[d]-a[d]);if(0===k)return!1;c=((f[0]-c[0])*(a[d]-c[d])-(f[d]-c[d])*(a[0]-c[0]))/k;g[0]=a[0]+c*(b[0]-a[0]);g[1]=a[d]+c*(b[d]-a[d]);return!0};d.matrix2frustum=J;d.matrix2frustumPlanes=function(a,b,c,f){void 0===f&&(f=c,c=V);J(a,b,c);r(c[4],c[0],c[3],f[0]);r(c[1],c[5],c[6],f[1]);r(c[4],c[5],c[1],f[2]);r(c[3],c[2],c[6],f[3]);r(c[0],c[1],c[2],f[4]);r(c[5],c[4],c[7],f[5])};d.point2plane=r;d.planeDistance=function(a,b){return b[0]*a[0]+b[1]*a[1]+b[2]*a[2]+b[3]};d.project=
function(a,b,c,f,d){d||(d=a);g[0]=a[0];g[1]=a[1];g[2]=a[2];g[3]=1;e.mat4d.multiplyVec4(b,g);2<d.length&&(d[2]=-g[2]);e.mat4d.multiplyVec4(c,g);A(0!==g[3]);d[0]=g[0]/g[3];d[1]=g[1]/g[3];d[2]=g[2]/g[3];d[0]=(.5*d[0]+.5)*f[2]+f[0];d[1]=(.5*d[1]+.5)*f[3]+f[1]};d.geodeticToGeocentricLatidude=function(a){return Math.atan((1-d.ECCENTRICITY_SQUARED)*Math.tan(a))};d.latLon2positionWGS84Ellipsoid=L;d.pos2latLon=function(a,b){var c=e.vec3d.length(a);b[0]=Math.asin(n(a[1]/c,-1,1));b[1]=(0>a[2]?1:-1)*Math.acos(n(a[0]/
(Math.cos(b[0])*c),-1,1));b[0]=C(b[0]);b[1]=C(b[1]);b[2]=c};d.pos2latLonWGS84Ellipsoid=function(a,b){var c=a[0],f=-a[2],e=a[1],g=Math.sqrt(Math.pow(6378137,2)*(1-d.ECCENTRICITY_SQUARED));a=Math.sqrt(Math.pow(c,2)+Math.pow(f,2));var m=Math.atan2(6378137*e,g*a),c=Math.atan2(f,c),f=Math.atan2(e+Math.pow(Math.sqrt((Math.pow(6378137,2)-Math.pow(g,2))/Math.pow(g,2)),2)*g*Math.pow(Math.sin(m),3),a-6378137*d.ECCENTRICITY_SQUARED*Math.pow(Math.cos(m),3));a=a/Math.cos(f)-6378137/Math.sqrt(1-d.ECCENTRICITY_SQUARED*
Math.pow(Math.sin(f),2))+d.EARTH_RADIUS;b[0]=f;b[1]=c;b[2]=a};d.computeGlobeTransformation=function(a,b,c){var d=B(a[0]);a=B(a[1]);L(d,a,b,P);e.mat4d.translate(c,P);e.mat4d.rotateY(c,.5*Math.PI+a);e.mat4d.rotateX(c,.5*Math.PI-d);return c};d.readUInt16=function(a,b){return a[b]+(a[b+1]<<8)};d.readUInt32=function(a,b){return a[b]+(a[b+1]<<8)+(a[b+2]<<16)+(a[b+3]<<24)};d.setIfDefined=function(a,b,c){void 0!==b[a]&&(c[a]=b[a])};d.array2object=function(a,b){var c={};if(void 0!==b)for(var d=0;d<a.length;d++){var e=
a[d];c[b(e)]=e}else for(b=0;b<a.length;b++)e=a[b],c[e]=e;return c};d.object2array=function(a){var b=[],c;for(c in a)b.push(a[c]);return b};d.mergeObjects=function(a,b,c){void 0===c&&(c={});if(c!==a)for(var d in a)c[d]=a[d];if(c!==b)for(var e in b)c[e]=b[e];return c};d.subtractObjects=function(a,b){var c={},d;for(d in a)void 0===b[d]&&(c[d]=a[d]);return c};d.intersectObjects=function(a,b){var c={},d;for(d in a)void 0!==b[d]&&(c[d]=a[d]);return c};d.getFirstObjectKey=M;d.getFirstObjectValue=function(a){return a[M(a)]};
d.objectEmpty=function(a){for(var b in a)return!1;return!0};d.arraysEqual=function(a,b){if(a.length!==b.length)return!1;for(var c=0,d=a.length;c<d;++c)if(a[c]!==b[c])return!1;return!0};var R=0;d.arrayRemove=function(a,b){for(var c=Math.max(0,R-5),d=Math.min(c+10,a.length),e=-1;c<d;++c)if(a[c]===b){e=c;break}if(-1===e&&(e=a.indexOf(b),-1===e))return null;a[e]=a[a.length-1];a.pop();R=e;return b};d.byteBuffer2base64image=function(a,b,c,d,e){var f=4*b;A(a.length===f*c,"buffer length must match image resolution");
var g=document.createElement("canvas");g.width=b;g.height=c;var k=g.getContext("2d");b=k.getImageData(0,0,b,c);for(var h=b.data,l=0;l<c;++l)for(var n=l*f,q=(c-1-l)*f,p=0;p<f;++p)h[n++]=a[q++];k.putImageData(b,0,0);return g.toDataURL(d,e)};d.cround=function(a){return Math.round(100*a)/100};d.logWithBase=function(a,b){return Math.log(a)/Math.log(b)};d.setMatrixTranslation=N;d.setMatrixTranslation3=function(a,b,c,d){a[12]=b;a[13]=c;a[14]=d};d.getMatrixTranslation=function(a,b){void 0===b&&(b=e.vec3d.create());
b[0]=a[12];b[1]=a[13];b[2]=a[14];return b};d.createTranslationMatrix=function(a,b){a=e.mat4d.identity(a);N(a,b);return a};d.isTranslationMatrix=function(a){return 1===a[0]&&0===a[1]&&0===a[2]&&0===a[3]&&0===a[4]&&1===a[5]&&0===a[6]&&0===a[7]&&0===a[8]&&0===a[9]&&1===a[10]&&0===a[11]&&1===a[15]};d.fovx2fovy=function(a,b,c){return 2*Math.atan(c*Math.tan(.5*a)/b)};d.fovy2fovx=function(a,b,c){return 2*Math.atan(b*Math.tan(.5*a)/c)};d.fovx2fovd=function(a,b,c){return 2*Math.atan(Math.sqrt(b*b+c*c)*Math.tan(.5*
a)/b)};d.fovy2fovd=function(a,b,c){return 2*Math.atan(Math.sqrt(b*b+c*c)*Math.tan(.5*a)/c)};d.fovd2fovx=function(a,b,c){return 2*Math.atan(b*Math.tan(.5*a)/Math.sqrt(b*b+c*c))};d.fovd2fovy=function(a,b,c){return 2*Math.atan(c*Math.tan(.5*a)/Math.sqrt(b*b+c*c))};d.nextHighestPowerOfTwo=function(a){--a;for(var b=1;32>b;b<<=1)a|=a>>b;return a+1};d.nextHighestPowerOfTen=function(a){return Math.pow(10,Math.ceil(Math.LOG10E*Math.log(a)))};d.lineLineDistanceSquared3D=function(a,b,c,d,g){p[0]=a[0]-c[0];p[1]=
a[1]-c[1];p[2]=a[2]-c[2];h[0]=d[0]-c[0];h[1]=d[1]-c[1];h[2]=d[2]-c[2];if(1E-4>Math.abs(h[0])&&1E-4>Math.abs(h[1])&&1E-4>Math.abs(h[2]))return g.success=!1,g;l[0]=b[0]-a[0];l[1]=b[1]-a[1];l[2]=b[2]-a[2];if(1E-4>Math.abs(l[0])&&1E-4>Math.abs(l[1])&&1E-4>Math.abs(l[2]))return g.success=!1,g;b=p[0]*h[0]+p[1]*h[1]+p[2]*h[2];d=h[0]*l[0]+h[1]*l[1]+h[2]*l[2];var f=p[0]*l[0]+p[1]*l[1]+p[2]*l[2],m=h[0]*h[0]+h[1]*h[1]+h[2]*h[2],k=(l[0]*l[0]+l[1]*l[1]+l[2]*l[2])*m-d*d;if(1E-4>Math.abs(k))return g.success=!1,
g;f=n((b*d-f*m)/k,0,1);b=n((b+d*f)/m,0,1);x[0]=a[0]+f*l[0];x[1]=a[1]+f*l[1];x[2]=a[2]+f*l[2];y[0]=c[0]+b*h[0];y[1]=c[1]+b*h[1];y[2]=c[2]+b*h[2];a=e.vec3d.dist2(x,y);g.success=!0;g.dist2=a;g.pa=x;g.pb=y;return g};d.pointLineSegmentDistanceSquared2D=function(a,b,c){q[0]=b[0]-a[0];q[1]=b[1]-a[1];q[2]=0;w[0]=c[0]-a[0];w[1]=c[1]-a[1];w[2]=0;z[0]=c[0];z[1]=c[1];z[2]=0;b=e.vec2d.dot(w,q);c=e.vec2d.dot(q,q);b=n(b/c,0,1);v[0]=q[0]*b;v[1]=q[1]*b;F[0]=a[0]+v[0];F[1]=a[1]+v[1];e.vec2d.subtract(z,F,G);a=e.vec2d.dot(G,
G);b=e.vec2d.dot(w,w);c=e.vec2d.dot(q,q);var d=e.vec2d.dot(v,v);if(d>b||d>c)a=Number.MAX_VALUE;return a};d.packFloatRGBA=function(a,b,c){void 0===c&&(c=0);a=n(a,0,X);for(var d=0;4>d;d++)b[c+d]=Math.floor(256*U(a*Y[d]))};d.unpackFloatRGBA=O;var Y=[1,256,65536,16777216],T=[1/256,1/65536,1/16777216,1/4294967296],X=O(new Uint8ClampedArray([255,255,255,255]))});