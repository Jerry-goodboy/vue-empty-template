// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.7/esri/copyright.txt for details.
//>>built
require({cache:{"url:esri/views/3d/webgl-engine/materials/internal/offscreen.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vsOffscreenRenderer"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  attribute vec2 $position;\r\n  varying vec2 vtc;\r\n\r\n  void main(void) {\r\n    gl_Position \x3d vec4($position.xy, 0.0, 1.0);\r\n    vtc \x3d $position.xy * 0.5 + 0.5;\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsOffscreenRenderer"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n  uniform sampler2D tex;\r\n  varying vec2 vtc;\r\n\r\n  void main() {\r\n    vec4 texColor \x3d texture2D(tex, vtc);\r\n    gl_FragColor \x3d texColor;\r\n  }\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n'}});
define("require exports dojo/text!../materials/internal/offscreen.xml ./DefaultVertexAttributeLocations ./glUtil3D ./Util ../../../webgl/FramebufferObject ../../../webgl/Program ../../../webgl/Texture ../../../webgl/Util".split(" "),function(v,w,k,l,m,n,p,q,e,r){var g={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0},t={target:3553,pixelFormat:6408,dataType:32819,samplingMode:9729,wrapMode:33071,width:0,height:0},h=[0,0,0,0],u=[0,0,0,1];return function(){function a(b,
a){this._intermediateTexture=this._hudVisibilityTexture=null;this._enabled=!1;this.height=this.width=0;this._programRep=b;this._rctx=a;this.height=this.width=null}a.prototype.enable=function(){if(!this.getEnableState()){var b=this._rctx;this._enabled=!0;this.framebuffer=p.createWithAttachments(b,g,{colorTarget:0,depthStencilTarget:b.capabilities.depthTexture?4:3});this.quadVAO=m.createQuadVAO(b)}};a.prototype.disable=function(){this.getEnableState()&&(this._enabled=!1,this.framebuffer.dispose(),this.quadVAO.dispose(!0),
this._depthStencilTextureCached=this.quadVAO=this.framebuffer=null)};a.prototype.setEnableState=function(b){b?this.enable():this.disable()};a.prototype.getEnableState=function(){return this._enabled};a.prototype.getColorTexture=function(){return this.framebuffer.colorTexture};a.prototype.getDepthTexture=function(){return a.supportsDepthTexture(this._rctx)?this.framebuffer.depthStencilTexture||this._depthStencilTextureCached:null};a.prototype.getHUDVisibilityTexture=function(){return this._hudVisibilityTexture};
a.supportsDepthTexture=function(b){return b.capabilities.depthTexture};a.prototype.initializeFrame=function(b){n.assert(this.getEnableState());var a=this._rctx,c=a.gl;b=b.fullViewport;this.width=b[2];this.height=b[3];this.framebuffer.resize(this.width,this.height);a.bindFramebuffer(this.framebuffer);a.setClearStencil(0);a.setClearColor(0,0,0,1);a.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT|c.STENCIL_BUFFER_BIT)};a.prototype.renderSeparateColor=function(b,a,c){void 0===c&&(c=h);var f=this._rctx,d=
f.gl;b.resize(this.width,this.height);var e=this.framebuffer.detachColorTexture();this.framebuffer.attachColorTexture(b);f.bindFramebuffer(this.framebuffer);f.setClearColor(c[0],c[1],c[2],Math.max(1E-13,c[3]));f.clear(d.COLOR_BUFFER_BIT);a();d.flush();this.framebuffer.detachColorTexture();this.framebuffer.attachColorTexture(e)};a.prototype.renderSeparateAndComposite=function(b,a,c){void 0===a&&(a=h);void 0===c&&(c="none");this._intermediateTexture||(this._intermediateTexture=new e(this._rctx,g));
this.renderSeparateColor(this._intermediateTexture,b);this.composite(this._intermediateTexture,this.framebuffer,c)};a.prototype.renderHUDVisibility=function(a){this._hudVisibilityTexture||(this._hudVisibilityTexture=new e(this._rctx,t));this.renderSeparateColor(this._hudVisibilityTexture,a,u)};a.prototype.bindFramebuffer=function(){this._rctx.bindFramebuffer(this.framebuffer)};a.prototype.getFramebuffer=function(){return this.framebuffer};a.prototype.detachDepthTextureFromBuffer=function(){this._depthStencilTextureCached=
this.framebuffer.depthStencilTexture;this.framebuffer.detachDepthStencilTexture()};a.prototype.restoreDepthTextureToBuffer=function(){this.framebuffer.attachDepthStencilTexture(this._depthStencilTextureCached);this._depthStencilTextureCached=null};a.prototype.composite=function(a,d,c){void 0===a&&(a=this.framebuffer.colorTexture);void 0===d&&(d=null);void 0===c&&(c="none");var b=this._rctx,e=this._programRep.get("offscreenProgram");b.bindFramebuffer(d);b.setDepthTestEnabled(!1);b.bindProgram(e);e.setUniform1i("tex",
1);b.bindTexture(a,1);switch(c){case "none":b.setBlendingEnabled(!1);break;case "alpha":b.setBlendingEnabled(!0);b.setBlendFunction(770,771);break;case "premultiplied-alpha":b.setBlendingEnabled(!0),b.setBlendFunction(1,771)}b.bindVAO(this.quadVAO);b.drawArrays(5,0,r.vertexCount(this.quadVAO,"geometry"));b.setDepthTestEnabled(!0);b.setBlendingEnabled(!1)};a.loadShaders=function(a,d,c){a._parse(k);a=new q(c,a.vsOffscreenRenderer,a.fsOffscreenRenderer,l.Default3D);d.add("offscreenProgram",a)};return a}()});