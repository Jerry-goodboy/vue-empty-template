// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.7/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../core/arrayUtils ../../../lib/glMatrix ../../../support/mathUtils ../../../support/buffer/typedArrayUtil".split(" "),function(W,x,P,e,F,Q){function R(a,t){var f=Math.acos(a.cosAngle),b=B.fwd,d=B.ortho;e.vec3d.normalize(e.vec3d.direction(a.position0,a.position1,b));a=0<e.vec3d.dot(e.vec3d.cross(a.faceNormal0,a.faceNormal1,d),b)?-1:1;return f*a>t}function S(a){var e=a.faces.length/3,f=a.faces;a=a.neighbors;for(var b=0,d=0;d<e;d++)var m=a[3*d+0],h=a[3*d+1],g=a[3*
d+2],k=f[3*d+0],l=f[3*d+1],p=f[3*d+2],b=b+(-1===m||k<l?1:0),b=b+(-1===h||l<p?1:0),b=b+(-1===g||p<k?1:0);for(var b=new Uint32Array(4*b),c=0,d=0;d<e;d++){m=a[3*d+0];h=a[3*d+1];g=a[3*d+2];k=f[3*d+0];l=f[3*d+1];p=f[3*d+2];if(-1===m||k<l)b[c++]=k,b[c++]=l,b[c++]=d,b[c++]=m;if(-1===h||l<p)b[c++]=l,b[c++]=p,b[c++]=d,b[c++]=h;if(-1===g||p<k)b[c++]=p,b[c++]=k,b[c++]=d,b[c++]=g}return b}function T(a){var t=a.faces.length/3,f=a.vertices.position;a=a.faces;for(var b=u.v0,d=u.v1,m=u.v2,h=new Float32Array(3*t),
g=0;g<t;g++){var k=a[3*g+1],l=a[3*g+2];f.getVec(a[3*g+0],b);f.getVec(k,d);f.getVec(l,m);e.vec3d.subtract(d,b);e.vec3d.subtract(m,b);e.vec3d.normalize(e.vec3d.cross(d,m,b));h[3*g+0]=b[0];h[3*g+1]=b[1];h[3*g+2]=b[2]}return h}Object.defineProperty(x,"__esModule",{value:!0});x.extractEdges=function(a,t,f,b){void 0===b&&(b=U);var d=a.vertices.position,m=a.vertices.componentIndex,h=a.vertices.lineWidth,g=a.vertices.type,k=a.vertices.extensions,l=F.deg2rad(b.anglePlanar);b=F.deg2rad(b.angleSignificantEdge);
b=Math.cos(b);var p=Math.cos(l),c=B.edge,u=c.position0,C=c.position1,y=c.faceNormal0,z=c.faceNormal1,q=T(a),v=S(a);a=v.length/4;var x=t.allocate(a),G=0,H=f.allocate(a),I=0,J=0,K=0,L=P.range(0,a),A=new Float32Array(a);Q.forEach(A,function(b,a,c){d.getVec(v[4*a+0],u);d.getVec(v[4*a+1],C);c[a]=e.vec3d.dist(u,C)});L.sort(function(a,b){return A[b]-A[a]});for(var M=[],N=[],D=0;D<a;D++){var n=L[D],E=A[n],r=v[4*n+0],V=v[4*n+1],w=v[4*n+2],n=v[4*n+3],O=4294967295===n;d.getVec(r,u);d.getVec(V,C);if(O)e.vec3d.set3(q[3*
w+0],q[3*w+1],q[3*w+2],y),e.vec3d.set(y,z),c.componentIndex=m.get(r),c.cosAngle=e.vec3d.dot(y,z),c.lineWidth=h.get(r),c.type=g.get(r),c.extensions=k.get(r);else if(e.vec3d.set3(q[3*w+0],q[3*w+1],q[3*w+2],y),e.vec3d.set3(q[3*n+0],q[3*n+1],q[3*n+2],z),c.componentIndex=m.get(r),c.cosAngle=e.vec3d.dot(y,z),c.lineWidth=h.get(r),c.type=g.get(r),c.extensions=k.get(r),c.cosAngle>p)continue;J+=E;K++;O||c.cosAngle<b?(t.write(x,G++,c),M.push(E)):R(c,l)&&(f.write(H,I++,c),N.push(E))}return{edge:{instancesData:t.trim(x,
G),lodInfo:{lengths:M.reverse()}},silhouette:{instancesData:f.trim(H,I),lodInfo:{lengths:N.reverse()}},averageEdgeLength:J/K}};var B={edge:{position0:e.vec3d.create(),position1:e.vec3d.create(),faceNormal0:e.vec3d.create(),faceNormal1:e.vec3d.create(),componentIndex:0,cosAngle:0,lineWidth:0,type:0,extensions:0},ortho:e.vec3d.create(),fwd:e.vec3d.create()},u={v0:e.vec3d.create(),v1:e.vec3d.create(),v2:e.vec3d.create()},U={anglePlanar:4,angleSignificantEdge:35}});