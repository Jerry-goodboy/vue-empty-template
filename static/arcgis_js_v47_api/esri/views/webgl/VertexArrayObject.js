// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.7/esri/copyright.txt for details.
//>>built
define(["require","exports"],function(r,t){return function(){function b(c,q,e,g,d){this._locations=this._layout=this._glName=this._context=null;this._indexBuffer=this._buffers=void 0;this._initialized=!1;this._context=c;this._layout=e;this._buffers=g;this._locations=q;d&&(this._indexBuffer=d);this._id=b._nextId++}Object.defineProperty(b.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"glName",{get:function(){return this._glName},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"vertexBuffers",{get:function(){return this._buffers},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"indexBuffer",{get:function(){return this._indexBuffer},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"size",{get:function(){var c=this;return Object.keys(this._buffers).reduce(function(b,e){return b+c._buffers[e].size},this._indexBuffer?this._indexBuffer.size:0)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"layout",{get:function(){return this._layout},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"locations",{get:function(){return this._locations},enumerable:!0,configurable:!0});b.prototype.dispose=function(c){void 0===c&&(c=!0);if(this._context){var b=this._context.capabilities.vao;b&&this._glName&&(b.deleteVertexArray(this._glName),this._glName=null);this._context.getBoundVAO()===this&&this._context.bindVAO(null);if(c){for(var e in this._buffers)this._buffers[e].dispose(),delete this._buffers[e];
this._indexBuffer&&(this._indexBuffer.dispose(),this._indexBuffer=null)}this._context=null}};b.prototype.initialize=function(){if(!this._initialized){var c=this._context.capabilities.vao;if(c){var b=c.createVertexArray();c.bindVertexArray(b);this._bindLayout();c.bindVertexArray(null);this._glName=b}this._initialized=!0}};b.prototype.bind=function(){this.initialize();var c=this._context.capabilities.vao;c?c.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())};b.prototype._bindLayout=
function(){var c=this._buffers,b=!!this._context.capabilities.vao,e=this._layout,g=this._indexBuffer;c||console.error("Vertex buffer dictionary is empty!");var d=this._context.gl,a,k,l=0,h;for(h in c)for((a=c[h])||console.error("Vertex buffer is uninitialized!"),(k=e[h])||console.error("Vertex element descriptor is empty!"),this._context.bindBuffer(a),l=0;l<k.length;++l){a=k[l];var f=this._locations[a.name],m=a.baseInstance?a.baseInstance*a.stride:0;void 0===f&&console.error("There is no location for vertex attribute '"+
a.name+"' defined.");a.baseInstance&&!a.divisor&&console.error("Vertex attribute '"+a.name+"' uses baseInstanceOffset without divisor.");if(4>=a.count){if(d.enableVertexAttribArray(f),d.vertexAttribPointer(f,a.count,a.type,a.normalized,a.stride,a.offset+m),a.divisor&&0<a.divisor){var p=this._context.capabilities.instancing;p&&p.vertexAttribDivisor(f,a.divisor)}}else if(16===a.count&&5126===a.type)for(var n=0;4>n;n++)d.enableVertexAttribArray(f+n),d.vertexAttribPointer(f+n,4,a.type,a.normalized,a.stride,
a.offset+16*n+m),a.divisor&&0<a.divisor&&(p=this._context.capabilities.instancing)&&p.vertexAttribDivisor(f+n,a.divisor);else console.error("Unsupported vertex attribute element count: "+a.count)}g&&(b?d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,g.glName):this._context.bindBuffer(g))};b.prototype.unbind=function(){this.initialize();var c=this._context.capabilities.vao;c?c.bindVertexArray(null):this._unbindLayout()};b.prototype._unbindLayout=function(){var c=this._buffers,b=this._layout,e=this._locations,
g=this._context;c||console.error("Vertex buffer dictionary is empty!");var d=g.gl,a,k,l,h=0,f=0,m;for(m in c){(a=c[m])||console.error("Vertex buffer is uninitialized!");k=b[m];h=0;for(f=k.length;h<f;++h)l=k[h],d.disableVertexAttribArray(e[l.name]);g.unbindBuffer(a.bufferType)}(c=this._indexBuffer)&&g.unbindBuffer(c.bufferType)};b._nextId=0;return b}()});